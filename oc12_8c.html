<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FEMU: ocssd/oc12.c 文件参考</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FEMU
   &#160;<span id="projectnumber">原版 master 7e238cc</span>
   </div>
   <div id="projectbrief">FEMU: Accurate, Scalable and Extensible NVMe SSD Emulator (FAST&#39;18)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'搜索');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('oc12_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">函数</a>  </div>
  <div class="headertitle">
<div class="title">oc12.c 文件参考</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="oc12_8h_source.html">./oc12.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
oc12.c 的引用(Include)关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c__incl.png" border="0" usemap="#ocssd_2oc12_8c" alt=""/></div>
<map name="ocssd_2oc12_8c" id="ocssd_2oc12_8c">
<area shape="rect" title=" " alt="" coords="883,5,989,32"/>
<area shape="rect" href="oc12_8h.html" title=" " alt="" coords="899,80,973,107"/>
<area shape="rect" href="nvme_8h.html" title=" " alt="" coords="895,155,977,181"/>
<area shape="rect" title=" " alt="" coords="5,229,120,256"/>
<area shape="rect" title=" " alt="" coords="145,229,247,256"/>
<area shape="rect" title=" " alt="" coords="272,229,379,256"/>
<area shape="rect" title=" " alt="" coords="403,229,514,256"/>
<area shape="rect" title=" " alt="" coords="539,229,651,256"/>
<area shape="rect" title=" " alt="" coords="675,229,779,256"/>
<area shape="rect" title=" " alt="" coords="803,229,933,256"/>
<area shape="rect" title=" " alt="" coords="957,229,1053,256"/>
<area shape="rect" title=" " alt="" coords="1078,229,1197,256"/>
<area shape="rect" href="dram_8h.html" title=" " alt="" coords="1221,229,1347,256"/>
<area shape="rect" href="rte__ring_8h.html" title=" " alt="" coords="1372,229,1479,256"/>
<area shape="rect" href="pqueue_8h.html" title="Priority Queue function declarations" alt="" coords="1503,229,1609,256"/>
<area shape="rect" href="nand_8h.html" title=" " alt="" coords="1633,229,1735,256"/>
<area shape="rect" href="timing_8h.html" title=" " alt="" coords="1760,229,1928,256"/>
<area shape="rect" title=" " alt="" coords="1134,304,1205,331"/>
<area shape="rect" title=" " alt="" coords="1229,304,1296,331"/>
<area shape="rect" title=" " alt="" coords="1321,304,1421,331"/>
<area shape="rect" title=" " alt="" coords="1445,304,1513,331"/>
<area shape="rect" title=" " alt="" coords="1537,304,1639,331"/>
<area shape="rect" href="rte__atomic__x86_8h.html" title=" " alt="" coords="1663,304,1798,331"/>
<area shape="rect" href="rte__branch__prediction_8h.html" title=" " alt="" coords="1822,304,1997,331"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
函数</h2></td></tr>
<tr class="memitem:a3bfb4ee5498ee9493ea2965fb44074dc"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc">qemu_fls</a> (int i)</td></tr>
<tr class="separator:a3bfb4ee5498ee9493ea2965fb44074dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a925c68486d59404254ab3b2d34fed9df"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a925c68486d59404254ab3b2d34fed9df">is_oc12_admin_cmd</a> (uint8_t opcode)</td></tr>
<tr class="separator:a925c68486d59404254ab3b2d34fed9df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36ce2e77da3b587fd610f820a2613ca1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a36ce2e77da3b587fd610f820a2613ca1">oc12_tbl_initialize</a> (<a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns)</td></tr>
<tr class="separator:a36ce2e77da3b587fd610f820a2613ca1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a968e2bafefcfab11d1e90df7bc2284a8"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8">ppa2secidx</a> (<a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln, uint64_t <a class="el" href="structppa.html">ppa</a>)</td></tr>
<tr class="separator:a968e2bafefcfab11d1e90df7bc2284a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a3ff44ce36ff8f6abba64c35bc5dc79"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a9a3ff44ce36ff8f6abba64c35bc5dc79">oc12_write_oob_meta</a> (<a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln, uint64_t <a class="el" href="structppa.html">ppa</a>, void *meta)</td></tr>
<tr class="separator:a9a3ff44ce36ff8f6abba64c35bc5dc79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad73121a1527886888f077d49b5e599cd"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#ad73121a1527886888f077d49b5e599cd">oc12_read_oob_meta</a> (<a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln, uint64_t <a class="el" href="structppa.html">ppa</a>, void *meta)</td></tr>
<tr class="separator:ad73121a1527886888f077d49b5e599cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5be918e6cb93b49cf43fcc2c6a36d94"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94">oc12_meta_state_get</a> (<a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln, uint64_t <a class="el" href="structppa.html">ppa</a>, uint32_t *<a class="el" href="oc12_8h.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a>)</td></tr>
<tr class="separator:ae5be918e6cb93b49cf43fcc2c6a36d94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a513d4b55522984724a7586103d0dccde"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a513d4b55522984724a7586103d0dccde">oc12_meta_blk_set_erased</a> (<a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns, <a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln, uint64_t *psl, int nr_ppas)</td></tr>
<tr class="separator:a513d4b55522984724a7586103d0dccde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca64e4af4809cbee3d39390041608175"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#aca64e4af4809cbee3d39390041608175">oc12_meta_state_set_written</a> (<a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln, uint64_t <a class="el" href="structppa.html">ppa</a>)</td></tr>
<tr class="separator:aca64e4af4809cbee3d39390041608175"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c8f07c03f101ab31074a64d1d430615"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a8c8f07c03f101ab31074a64d1d430615">oc12_meta_index</a> (<a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln, void *meta, uint32_t index)</td></tr>
<tr class="separator:a8c8f07c03f101ab31074a64d1d430615"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a834f283bef0c838d4b075ba5cc5405b1"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a834f283bef0c838d4b075ba5cc5405b1">oc12_rw_check_req</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd, <a class="el" href="structNvmeRequest.html">NvmeRequest</a> *req, uint64_t *psl, uint32_t nr_pages, uint32_t nlb, uint64_t data_size, uint64_t meta_size)</td></tr>
<tr class="separator:a834f283bef0c838d4b075ba5cc5405b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad73b76922bf7b9ecd50de33ff112412a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a">oc12_read_ppa_list</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structOc12RwCmd.html">Oc12RwCmd</a> *cmd, uint64_t *ppa_list)</td></tr>
<tr class="separator:ad73b76922bf7b9ecd50de33ff112412a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c5fa0dc26c1d7334be3de1917e950f4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a7c5fa0dc26c1d7334be3de1917e950f4">parse_ppa_list</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd, <a class="el" href="structNvmeRequest.html">NvmeRequest</a> *req, <a class="el" href="structAddrBucket.html">AddrBucket</a> *bucket, int *nr)</td></tr>
<tr class="separator:a7c5fa0dc26c1d7334be3de1917e950f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf02ace1750d8b7b40286e2c3fe33a23"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23">oc12_advance_status</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd, <a class="el" href="structNvmeRequest.html">NvmeRequest</a> *req)</td></tr>
<tr class="separator:aaf02ace1750d8b7b40286e2c3fe33a23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e3ff8c5923a54ae4b9167627877b7ba"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba">oc12_read</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd, <a class="el" href="structNvmeRequest.html">NvmeRequest</a> *req)</td></tr>
<tr class="separator:a7e3ff8c5923a54ae4b9167627877b7ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8b73b03b7edcdc1740a24b053ce72a5"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5">oc12_write</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd, <a class="el" href="structNvmeRequest.html">NvmeRequest</a> *req)</td></tr>
<tr class="separator:af8b73b03b7edcdc1740a24b053ce72a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee96b1d201c8c59efdcf0ca09c94ae69"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#aee96b1d201c8c59efdcf0ca09c94ae69">oc12_tbl_size</a> (<a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns)</td></tr>
<tr class="separator:aee96b1d201c8c59efdcf0ca09c94ae69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a126a85634fc530e22284c185df8f5f81"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a126a85634fc530e22284c185df8f5f81">oc12_identity</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd)</td></tr>
<tr class="separator:a126a85634fc530e22284c185df8f5f81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6edf286a27463261b9a975ee1eeefcc8"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a6edf286a27463261b9a975ee1eeefcc8">oc12_get_l2p_tbl</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd)</td></tr>
<tr class="separator:a6edf286a27463261b9a975ee1eeefcc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ad0ccde984b0ad5434da3622acc0389"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a9ad0ccde984b0ad5434da3622acc0389">oc12_bbt_get</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd)</td></tr>
<tr class="separator:a9ad0ccde984b0ad5434da3622acc0389"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aada1f75e02b085c6a43438e5ab1c81e0"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#aada1f75e02b085c6a43438e5ab1c81e0">oc12_bbt_set</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd)</td></tr>
<tr class="separator:aada1f75e02b085c6a43438e5ab1c81e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c3bc08fae8d78b595c291eee88526ad"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a9c3bc08fae8d78b595c291eee88526ad">oc12_read_tbls</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n)</td></tr>
<tr class="separator:a9c3bc08fae8d78b595c291eee88526ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68620169de187b09e15ef18b52eb72c6"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a68620169de187b09e15ef18b52eb72c6">oc12_admin_cmd</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd)</td></tr>
<tr class="separator:a68620169de187b09e15ef18b52eb72c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab1abde67fc0b44326b1772846549abf"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf">oc12_erase_async</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd, <a class="el" href="structNvmeRequest.html">NvmeRequest</a> *req)</td></tr>
<tr class="separator:aab1abde67fc0b44326b1772846549abf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22cb229f7099e5695f0525b8b74ffa37"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a22cb229f7099e5695f0525b8b74ffa37">oc12_init_id_ctrl</a> (<a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln)</td></tr>
<tr class="separator:a22cb229f7099e5695f0525b8b74ffa37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa22cd7b8b8e5064da4267752f5f47016"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#aa22cd7b8b8e5064da4267752f5f47016">oc12_init_meta</a> (<a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln)</td></tr>
<tr class="separator:aa22cd7b8b8e5064da4267752f5f47016"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d17602b61b416c29c19265374c0801b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a3d17602b61b416c29c19265374c0801b">oc12_init_bbtbl</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns)</td></tr>
<tr class="separator:a3d17602b61b416c29c19265374c0801b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42a412e9ba005df6611a73cfbb61ed85"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a42a412e9ba005df6611a73cfbb61ed85">oc12_release_locks</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n)</td></tr>
<tr class="separator:a42a412e9ba005df6611a73cfbb61ed85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e77c275cce3ddf13e9092d72285d6f5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a0e77c275cce3ddf13e9092d72285d6f5">oc12_init_misc</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n)</td></tr>
<tr class="separator:a0e77c275cce3ddf13e9092d72285d6f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59f1fe491b2d6a603c05c6488eba019a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a59f1fe491b2d6a603c05c6488eba019a">oc12_init_params</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n)</td></tr>
<tr class="separator:a59f1fe491b2d6a603c05c6488eba019a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08d50fc7f025a0a40c4a68a76fd5a088"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088">oc12_init_more</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n)</td></tr>
<tr class="separator:a08d50fc7f025a0a40c4a68a76fd5a088"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb2f63023ff079bd918f3e0a2fc99c0a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#adb2f63023ff079bd918f3e0a2fc99c0a">oc12_exit</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n)</td></tr>
<tr class="separator:adb2f63023ff079bd918f3e0a2fc99c0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62b547738c301cdf347f2ce68659c93d"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a62b547738c301cdf347f2ce68659c93d">oc12_nvme_rw</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd, <a class="el" href="structNvmeRequest.html">NvmeRequest</a> *req)</td></tr>
<tr class="separator:a62b547738c301cdf347f2ce68659c93d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c41a58559ee2c92463ac4f25dab0a08"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08">oc12_io_cmd</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, <a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *ns, <a class="el" href="structNvmeCmd.html">NvmeCmd</a> *cmd, <a class="el" href="structNvmeRequest.html">NvmeRequest</a> *req)</td></tr>
<tr class="separator:a3c41a58559ee2c92463ac4f25dab0a08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef55b0e79dd4659d66fc1d7d83b3a88a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#aef55b0e79dd4659d66fc1d7d83b3a88a">oc12_set_ctrl_str</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n)</td></tr>
<tr class="separator:aef55b0e79dd4659d66fc1d7d83b3a88a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0caef7cdff7d502bdf678c7e8c57e35e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e">oc12_init</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n, Error **errp)</td></tr>
<tr class="separator:a0caef7cdff7d502bdf678c7e8c57e35e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a623f6939cbe95d9de1eab8847f6ddba0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0">nvme_register_ocssd12</a> (<a class="el" href="structFemuCtrl.html">FemuCtrl</a> *n)</td></tr>
<tr class="separator:a623f6939cbe95d9de1eab8847f6ddba0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">函数说明</h2>
<a id="a925c68486d59404254ab3b2d34fed9df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a925c68486d59404254ab3b2d34fed9df">&#9670;&nbsp;</a></span>is_oc12_admin_cmd()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool is_oc12_admin_cmd </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>opcode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <span class="keywordflow">return</span> (opcode == <a class="code" href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411a5f9e854fc81b79c50335c61b5ab33d32">OC12_ADM_CMD_IDENTITY</a> ||</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;            opcode == <a class="code" href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411ad3e1914c959d0d1da19199c376b3e5a8">OC12_ADM_CMD_GET_L2P_TBL</a> ||</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;            opcode == <a class="code" href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411ad8bcdb8fdb03281ba3d0859cc42d0092">OC12_ADM_CMD_GET_BB_TBL</a> ||</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            opcode == <a class="code" href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411a0aa62d870174142f5c126b872882215b">OC12_ADM_CMD_SET_BB_TBL</a>);</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a623f6939cbe95d9de1eab8847f6ddba0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a623f6939cbe95d9de1eab8847f6ddba0">&#9670;&nbsp;</a></span>nvme_register_ocssd12()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nvme_register_ocssd12 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;{</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    n-&gt;<a class="code" href="structFemuCtrl.html#a2b07accc41de60cd0c6de43adde355ad">ext_ops</a> = (<a class="code" href="nvme_8h.html#a5d9fde4912328e2ecf4f80e41e1da013">FemuExtCtrlOps</a>) {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        .<a class="code" href="structFemuExtCtrlOps.html#a5a0b55a8db93619bd96e347ed4c7a930">state</a>            = NULL,</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        .init             = <a class="code" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e">oc12_init</a>,</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        .exit             = <a class="code" href="oc12_8c.html#adb2f63023ff079bd918f3e0a2fc99c0a">oc12_exit</a>,</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        .rw_check_req     = NULL,</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        .admin_cmd        = <a class="code" href="oc12_8c.html#a68620169de187b09e15ef18b52eb72c6">oc12_admin_cmd</a>,</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        .io_cmd           = <a class="code" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08">oc12_io_cmd</a>,</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        .get_log          = NULL,</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    };</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a623f6939cbe95d9de1eab8847f6ddba0_cgraph.png" border="0" usemap="#oc12_8c_a623f6939cbe95d9de1eab8847f6ddba0_cgraph" alt=""/></div>
<map name="oc12_8c_a623f6939cbe95d9de1eab8847f6ddba0_cgraph" id="oc12_8c_a623f6939cbe95d9de1eab8847f6ddba0_cgraph">
<area shape="rect" title=" " alt="" coords="5,693,181,720"/>
<area shape="rect" href="oc12_8c.html#a68620169de187b09e15ef18b52eb72c6" title=" " alt="" coords="229,668,365,695"/>
<area shape="rect" href="oc12_8c.html#adb2f63023ff079bd918f3e0a2fc99c0a" title=" " alt="" coords="255,744,340,771"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="257,908,338,935"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="435,360,541,387"/>
<area shape="rect" href="oc12_8c.html#a9ad0ccde984b0ad5434da3622acc0389" title=" " alt="" coords="433,668,543,695"/>
<area shape="rect" href="oc12_8c.html#aada1f75e02b085c6a43438e5ab1c81e0" title=" " alt="" coords="434,567,542,593"/>
<area shape="rect" href="oc12_8c.html#a6edf286a27463261b9a975ee1eeefcc8" title=" " alt="" coords="422,719,554,745"/>
<area shape="rect" href="oc12_8c.html#a126a85634fc530e22284c185df8f5f81" title=" " alt="" coords="433,617,543,644"/>
<area shape="rect" href="dma_8c.html#a83e01cb3ebf3721ca1fd024940ed6aa6" title=" " alt="" coords="633,655,747,681"/>
<area shape="rect" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493" title=" " alt="" coords="855,629,978,656"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="1105,579,1236,605"/>
<area shape="rect" href="dma_8c.html#adef0f21bc237d992b4ae8b29258645a8" title=" " alt="" coords="631,579,749,605"/>
<area shape="rect" href="oc12_8c.html#a42a412e9ba005df6611a73cfbb61ed85" title=" " alt="" coords="413,769,563,796"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="427,908,549,935"/>
<area shape="rect" href="oc12_8c.html#aef55b0e79dd4659d66fc1d7d83b3a88a" title=" " alt="" coords="422,1060,554,1087"/>
<area shape="rect" href="nand_8c.html#abf5d19b68122bdd6e7769c2d86d12e12" title=" " alt="" coords="630,756,750,783"/>
<area shape="rect" href="oc12_8c.html#a3d17602b61b416c29c19265374c0801b" title=" " alt="" coords="629,807,751,833"/>
<area shape="rect" href="oc12_8c.html#a22cb229f7099e5695f0525b8b74ffa37" title=" " alt="" coords="626,857,754,884"/>
<area shape="rect" href="oc12_8c.html#aa22cd7b8b8e5064da4267752f5f47016" title=" " alt="" coords="629,908,751,935"/>
<area shape="rect" href="oc12_8c.html#a0e77c275cce3ddf13e9092d72285d6f5" title=" " alt="" coords="631,959,749,985"/>
<area shape="rect" href="oc12_8c.html#a59f1fe491b2d6a603c05c6488eba019a" title=" " alt="" coords="621,1009,759,1036"/>
<area shape="rect" href="oc12_8c.html#a9c3bc08fae8d78b595c291eee88526ad" title=" " alt="" coords="630,1111,750,1137"/>
<area shape="rect" href="oc12_8c.html#aee96b1d201c8c59efdcf0ca09c94ae69" title=" " alt="" coords="861,1085,972,1112"/>
<area shape="rect" href="oc12_8c.html#a36ce2e77da3b587fd610f820a2613ca1" title=" " alt="" coords="620,705,760,732"/>
<area shape="rect" href="nand_8c.html#ac06b76cb4e1499cd0f5086d231a92bf2" title=" " alt="" coords="834,731,999,757"/>
<area shape="rect" href="nand_8c.html#a37e87937b3211fc7dbe4b940ba9b6797" title=" " alt="" coords="832,781,1001,808"/>
<area shape="rect" href="nand_8c.html#a7710f745cac37cb6e8bce3f23563ae3f" title=" " alt="" coords="837,832,997,859"/>
<area shape="rect" href="nand_8c.html#a8cb0a9f52feff4b7ff071d57c217cf86" title=" " alt="" coords="838,680,995,707"/>
<area shape="rect" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc" title=" " alt="" coords="876,883,957,909"/>
<area shape="rect" href="timing_8c.html#aa8618254a23869568da186caca33e37b" title=" " alt="" coords="868,959,965,985"/>
<area shape="rect" href="nvme-util_8c.html#a9e84e8328646dcb1f24be9c79018e6a0" title=" " alt="" coords="611,1161,769,1188"/>
<area shape="rect" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf" title=" " alt="" coords="619,196,761,223"/>
<area shape="rect" href="oc12_8c.html#a62b547738c301cdf347f2ce68659c93d" title=" " alt="" coords="630,411,750,437"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="645,272,735,299"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="643,360,737,387"/>
<area shape="rect" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23" title=" " alt="" coords="835,157,998,184"/>
<area shape="rect" href="oc12_8c.html#a513d4b55522984724a7586103d0dccde" title=" " alt="" coords="817,5,1016,32"/>
<area shape="rect" href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a" title=" " alt="" coords="843,208,990,235"/>
<area shape="rect" href="timing_8c.html#a1e23cd59a19d5524e59e8a130a0318ca" title=" " alt="" coords="1064,157,1277,184"/>
<area shape="rect" href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e" title=" " alt="" coords="1076,208,1265,235"/>
<area shape="rect" href="oc12_8c.html#a7c5fa0dc26c1d7334be3de1917e950f4" title=" " alt="" coords="1113,107,1229,133"/>
<area shape="rect" href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94" title=" " alt="" coords="1089,31,1252,57"/>
<area shape="rect" href="dram_8c.html#a1ccbcf0c92b7b084afc9890f3a7e5799" title=" " alt="" coords="867,411,966,437"/>
<area shape="rect" href="dma_8c.html#a08f51254313a657c3826f77e6bd9a1b8" title=" " alt="" coords="849,259,984,285"/>
<area shape="rect" href="oc12_8c.html#a8c8f07c03f101ab31074a64d1d430615" title=" " alt="" coords="848,309,985,336"/>
<area shape="rect" href="oc12_8c.html#ad73121a1527886888f077d49b5e599cd" title=" " alt="" coords="836,56,997,83"/>
<area shape="rect" href="oc12_8c.html#a834f283bef0c838d4b075ba5cc5405b1" title=" " alt="" coords="842,360,991,387"/>
<area shape="rect" href="oc12_8c.html#aca64e4af4809cbee3d39390041608175" title=" " alt="" coords="836,462,997,503"/>
<area shape="rect" href="oc12_8c.html#a9a3ff44ce36ff8f6abba64c35bc5dc79" title=" " alt="" coords="834,528,999,555"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a623f6939cbe95d9de1eab8847f6ddba0_icgraph.png" border="0" usemap="#oc12_8c_a623f6939cbe95d9de1eab8847f6ddba0_icgraph" alt=""/></div>
<map name="oc12_8c_a623f6939cbe95d9de1eab8847f6ddba0_icgraph" id="oc12_8c_a623f6939cbe95d9de1eab8847f6ddba0_icgraph">
<area shape="rect" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a68620169de187b09e15ef18b52eb72c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68620169de187b09e15ef18b52eb72c6">&#9670;&nbsp;</a></span>oc12_admin_cmd()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_admin_cmd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;{</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">switch</span> (cmd-&gt;<a class="code" href="structNvmeCmd.html#a2751bc2a772082d3af81124a1d120a0c">opcode</a>) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411a5f9e854fc81b79c50335c61b5ab33d32">OC12_ADM_CMD_IDENTITY</a>:</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;oc12_cmd_identity\n&quot;</span>);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="oc12_8c.html#a126a85634fc530e22284c185df8f5f81">oc12_identity</a>(n, cmd);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411ad3e1914c959d0d1da19199c376b3e5a8">OC12_ADM_CMD_GET_L2P_TBL</a>:</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;oc12_get_l2p_tbl\n&quot;</span>);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="oc12_8c.html#a6edf286a27463261b9a975ee1eeefcc8">oc12_get_l2p_tbl</a>(n, cmd);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411ad8bcdb8fdb03281ba3d0859cc42d0092">OC12_ADM_CMD_GET_BB_TBL</a>:</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;oc12_get_bb_tbl\n&quot;</span>);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="oc12_8c.html#a9ad0ccde984b0ad5434da3622acc0389">oc12_bbt_get</a>(n, cmd);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411a0aa62d870174142f5c126b872882215b">OC12_ADM_CMD_SET_BB_TBL</a>:</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;oc12_set_bb_tbl\n&quot;</span>);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="oc12_8c.html#aada1f75e02b085c6a43438e5ab1c81e0">oc12_bbt_set</a>(n, cmd);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a778b8f53d6725ef86c455e2e55d46ce7">NVME_INVALID_OPCODE</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a68620169de187b09e15ef18b52eb72c6_cgraph.png" border="0" usemap="#oc12_8c_a68620169de187b09e15ef18b52eb72c6_cgraph" alt=""/></div>
<map name="oc12_8c_a68620169de187b09e15ef18b52eb72c6_cgraph" id="oc12_8c_a68620169de187b09e15ef18b52eb72c6_cgraph">
<area shape="rect" title=" " alt="" coords="5,81,141,108"/>
<area shape="rect" href="oc12_8c.html#a9ad0ccde984b0ad5434da3622acc0389" title=" " alt="" coords="201,5,310,32"/>
<area shape="rect" href="oc12_8c.html#aada1f75e02b085c6a43438e5ab1c81e0" title=" " alt="" coords="201,157,309,184"/>
<area shape="rect" href="oc12_8c.html#a6edf286a27463261b9a975ee1eeefcc8" title=" " alt="" coords="189,56,321,83"/>
<area shape="rect" href="oc12_8c.html#a126a85634fc530e22284c185df8f5f81" title=" " alt="" coords="200,107,311,133"/>
<area shape="rect" href="dma_8c.html#a83e01cb3ebf3721ca1fd024940ed6aa6" title=" " alt="" coords="371,69,486,96"/>
<area shape="rect" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493" title=" " alt="" coords="536,107,659,133"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="707,107,837,133"/>
<area shape="rect" href="dma_8c.html#adef0f21bc237d992b4ae8b29258645a8" title=" " alt="" coords="369,132,488,159"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a68620169de187b09e15ef18b52eb72c6_icgraph.png" border="0" usemap="#oc12_8c_a68620169de187b09e15ef18b52eb72c6_icgraph" alt=""/></div>
<map name="oc12_8c_a68620169de187b09e15ef18b52eb72c6_icgraph" id="oc12_8c_a68620169de187b09e15ef18b52eb72c6_icgraph">
<area shape="rect" title=" " alt="" coords="799,5,935,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="aaf02ace1750d8b7b40286e2c3fe33a23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf02ace1750d8b7b40286e2c3fe33a23">&#9670;&nbsp;</a></span>oc12_advance_status()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_advance_status </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeRequest.html">NvmeRequest</a> *&#160;</td>
          <td class="paramname"><em>req</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;{</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *ocrw = (<a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *)cmd;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    uint8_t opcode = ocrw-&gt;<a class="code" href="structOc12RwCmd.html#a0489f3cd5053aaea3eb7fd83d9958122">opcode</a>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordtype">int</span> ch, lun, lunid;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    int64_t io_done_ts = 0;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    int64_t total_time_need_to_emulate = 0;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    int64_t cur_time_need_to_emulate;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="structOc12IdGroup.html">Oc12IdGroup</a> *c = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>.<a class="code" href="structOc12IdCtrl.html#adc341b399768a73cfc579fd4862747af">groups</a>[0];</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordtype">int</span> max_sec_per_rq = ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a7a9dd0f60d13cd9027ee190ee1e98ef9">max_sec_per_rq</a>;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    uint8_t page_type;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    int64_t now = req-&gt;<a class="code" href="structNvmeRequest.html#ad267c178ee13ebb285604043925b5e78">stime</a>;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    uint64_t <a class="code" href="structppa.html">ppa</a>;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">/* Erase */</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> (opcode == <a class="code" href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a520122b673211f2705a64edebc5f4d61">OC12_CMD_ERASE</a>) {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="structppa.html">ppa</a> = req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        lun = <a class="code" href="nand_8h.html#a61ca2e3531ba78a2d7f62cb9c077dbec">PPA_LUN</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        ch = <a class="code" href="nand_8h.html#adfbaba29b1f26d638ba0358de7aec107">PPA_CH</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        lunid = ch * c-&gt;<a class="code" href="structOc12IdGroup.html#a6a3f7995780567cae58de14a9596cee2">num_ch</a> + lun;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        req-&gt;<a class="code" href="structNvmeRequest.html#a135bf3cba23f12bad28c20805a8f5d93">expire_time</a> = <a class="code" href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e">advance_chip_timestamp</a>(n, lunid, now, opcode, 0);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordtype">int</span> secs_idx = -1;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordtype">int</span> si = 0;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordtype">int</span> nb_secs_to_write = 0;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="structAddrBucket.html">AddrBucket</a> addr_bucket[max_sec_per_rq];</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <a class="code" href="oc12_8c.html#a7c5fa0dc26c1d7334be3de1917e950f4">parse_ppa_list</a>(n, ns, cmd, req, addr_bucket, &amp;secs_idx);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">/* Read &amp; Write */</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    assert(opcode == <a class="code" href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a8cfd84b1039b373a3cf3d86de795803f">OC12_CMD_READ</a> || opcode == <a class="code" href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a0db13c046f3cdc7a4a59f1f3456c95c6">OC12_CMD_WRITE</a>);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    assert(secs_idx &gt; 0);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; secs_idx; i++) {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <a class="code" href="structppa.html">ppa</a> = ((uint64_t *)(req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>))[si];</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        nb_secs_to_write = addr_bucket[i].<a class="code" href="structAddrBucket.html#a61e6c99a9e481a5f5f5fd3916a933c9e">cnt</a>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        si += nb_secs_to_write;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        ch = addr_bucket[i].<a class="code" href="structAddrBucket.html#a20d14f13630952d9600c045a6d9ce329">ch</a>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        lun = addr_bucket[i].<a class="code" href="structAddrBucket.html#a8ad87aa0dffdeb38c21341e2e869a957">lun</a>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        page_type = addr_bucket[i].<a class="code" href="structAddrBucket.html#a6067622337a90fb397b788a17d540af4">page_type</a>;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        lunid = ch * c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a> + lun;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        io_done_ts = 0;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        assert(ch &lt; c-&gt;num_ch &amp;&amp; lun &lt; c-&gt;num_lun);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        int64_t chnl_end_ts, chip_end_ts;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">if</span> (req-&gt;<a class="code" href="structNvmeRequest.html#a6f04006cddb851afcc919412c6e90b60">is_write</a>) {</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="comment">/* Write data needs to be transferred through the channel first */</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            chnl_end_ts = <a class="code" href="timing_8c.html#a1e23cd59a19d5524e59e8a130a0318ca">advance_channel_timestamp</a>(n, ch, now, opcode);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="comment">/* Then issue NAND Program to the target flash chip */</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            io_done_ts = <a class="code" href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e">advance_chip_timestamp</a>(n, lunid, chnl_end_ts, opcode, page_type);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            chip_end_ts = <a class="code" href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e">advance_chip_timestamp</a>(n, lunid, now, opcode, page_type);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            io_done_ts = <a class="code" href="timing_8c.html#a1e23cd59a19d5524e59e8a130a0318ca">advance_channel_timestamp</a>(n, ch, chip_end_ts, opcode);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="comment">/* Coperd: the time need to emulate is (io_done_ts - now) */</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        cur_time_need_to_emulate = io_done_ts - now;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordflow">if</span> (cur_time_need_to_emulate &gt; total_time_need_to_emulate) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            total_time_need_to_emulate = cur_time_need_to_emulate;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    req-&gt;<a class="code" href="structNvmeRequest.html#a135bf3cba23f12bad28c20805a8f5d93">expire_time</a> = now + total_time_need_to_emulate;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aaf02ace1750d8b7b40286e2c3fe33a23_cgraph.png" border="0" usemap="#oc12_8c_aaf02ace1750d8b7b40286e2c3fe33a23_cgraph" alt=""/></div>
<map name="oc12_8c_aaf02ace1750d8b7b40286e2c3fe33a23_cgraph" id="oc12_8c_aaf02ace1750d8b7b40286e2c3fe33a23_cgraph">
<area shape="rect" title=" " alt="" coords="5,69,168,96"/>
<area shape="rect" href="timing_8c.html#a1e23cd59a19d5524e59e8a130a0318ca" title=" " alt="" coords="216,19,429,45"/>
<area shape="rect" href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e" title=" " alt="" coords="228,69,417,96"/>
<area shape="rect" href="oc12_8c.html#a7c5fa0dc26c1d7334be3de1917e950f4" title=" " alt="" coords="265,132,381,159"/>
<area shape="rect" href="nand_8h.html#a8114ba8a535f9a3dba0f920bd8a3ade3" title=" " alt="" coords="482,5,650,32"/>
<area shape="rect" href="nand_8h.html#a1df10f9cc5736ecc33431a60f6191356" title=" " alt="" coords="479,56,653,83"/>
<area shape="rect" href="nand_8h.html#ab8913f0fbdd3cb447393cef3754be7c4" title=" " alt="" coords="477,107,655,133"/>
<area shape="rect" href="nand_8h.html#aea24174b997828eb73fe8f0e7c83209e" title=" " alt="" coords="507,157,625,184"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aaf02ace1750d8b7b40286e2c3fe33a23_icgraph.png" border="0" usemap="#oc12_8c_aaf02ace1750d8b7b40286e2c3fe33a23_icgraph" alt=""/></div>
<map name="oc12_8c_aaf02ace1750d8b7b40286e2c3fe33a23_icgraph" id="oc12_8c_aaf02ace1750d8b7b40286e2c3fe33a23_icgraph">
<area shape="rect" title=" " alt="" coords="1143,56,1305,83"/>
<area shape="rect" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf" title=" " alt="" coords="953,5,1095,32"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="979,56,1069,83"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="977,107,1071,133"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,56,905,83"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,56,751,83"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,56,527,83"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,56,284,83"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,56,129,83"/>
</map>
</div>

</div>
</div>
<a id="a9ad0ccde984b0ad5434da3622acc0389"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ad0ccde984b0ad5434da3622acc0389">&#9670;&nbsp;</a></span>oc12_bbt_get()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_bbt_get </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;{</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <a class="code" href="structNvmeNamespace.html">NvmeNamespace</a> *ns;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <a class="code" href="structOc12IdGroup.html">Oc12IdGroup</a> *c = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>.<a class="code" href="structOc12IdCtrl.html#adc341b399768a73cfc579fd4862747af">groups</a>[0];</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="structOc12BbtGet.html">Oc12BbtGet</a> *bbt_cmd = (<a class="code" href="structOc12BbtGet.html">Oc12BbtGet</a>*)cmd;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    uint32_t nsid = le32_to_cpu(bbt_cmd-&gt;<a class="code" href="structOc12BbtGet.html#a5d030b8c1ecd315d53025c3286032d30">nsid</a>);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    uint64_t prp1 = le64_to_cpu(bbt_cmd-&gt;<a class="code" href="structOc12BbtGet.html#a6815a8aa7f39ac3c2a04dac59e4963f9">prp1</a>);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    uint64_t prp2 = le64_to_cpu(bbt_cmd-&gt;<a class="code" href="structOc12BbtGet.html#af1326dca27ade98f861c132d43f2eda0">prp2</a>);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    uint64_t <a class="code" href="structppa.html">ppa</a> = le64_to_cpu(bbt_cmd-&gt;<a class="code" href="structOc12BbtGet.html#a186a1b618ba8bc55d3ebccd43f04bc60">spba</a>);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordtype">int</span> blks_per_lun = c-&gt;<a class="code" href="structOc12IdGroup.html#ad4de9a793ea8301bcadc677d9524a6af">num_blk</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordtype">int</span> lun, ch, lunid;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="structOc12Bbt.html">Oc12Bbt</a> *bbt;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordtype">int</span> ret = <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a3268f6be90861f0c2270d86a44d5b09c">NVME_SUCCESS</a>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">if</span> (nsid == 0 || nsid &gt; n-&gt;<a class="code" href="structFemuCtrl.html#a8bd3f2107e1a59779f7d6a669e29b5af">num_namespaces</a>) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a4c080463e158441c5b7b4000da2ed3e4">NVME_INVALID_NSID</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    ns = &amp;n-&gt;<a class="code" href="structFemuCtrl.html#a98ca6ff3bc65ccc7f98a589e018b7d71">namespaces</a>[nsid - 1];</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    ch = (<a class="code" href="structppa.html">ppa</a> &amp; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ade7c31f1d074dbbecce98d67d1219ec4">ch_mask</a>) &gt;&gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ae474e1c6b5b4bc9db7e1933b8d1bbacc">ch_offset</a>;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    lun = (<a class="code" href="structppa.html">ppa</a> &amp; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af0528b7d3f8355056e2e3c1263bbf847">lun_mask</a>) &gt;&gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a4d8bb807dc7938223baaab7656c8e787">lun_offset</a>;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    lunid = ch * c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a> + lun;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    bbt = ns-&gt;<a class="code" href="structNvmeNamespace.html#a95506f6c42f0b9bb0ef45bbc9d6a49be">bbtbl</a>[lunid];</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dma_8c.html#a83e01cb3ebf3721ca1fd024940ed6aa6">dma_read_prp</a>(n, (uint8_t*)bbt, <span class="keyword">sizeof</span>(<a class="code" href="structOc12Bbt.html">Oc12Bbt</a>) + blks_per_lun,</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                          prp1, prp2)) {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a9ad0ccde984b0ad5434da3622acc0389_cgraph.png" border="0" usemap="#oc12_8c_a9ad0ccde984b0ad5434da3622acc0389_cgraph" alt=""/></div>
<map name="oc12_8c_a9ad0ccde984b0ad5434da3622acc0389_cgraph" id="oc12_8c_a9ad0ccde984b0ad5434da3622acc0389_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,115,32"/>
<area shape="rect" href="dma_8c.html#a83e01cb3ebf3721ca1fd024940ed6aa6" title=" " alt="" coords="163,5,277,32"/>
<area shape="rect" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493" title=" " alt="" coords="325,5,448,32"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="496,5,627,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a9ad0ccde984b0ad5434da3622acc0389_icgraph.png" border="0" usemap="#oc12_8c_a9ad0ccde984b0ad5434da3622acc0389_icgraph" alt=""/></div>
<map name="oc12_8c_a9ad0ccde984b0ad5434da3622acc0389_icgraph" id="oc12_8c_a9ad0ccde984b0ad5434da3622acc0389_icgraph">
<area shape="rect" title=" " alt="" coords="983,5,1092,32"/>
<area shape="rect" href="oc12_8c.html#a68620169de187b09e15ef18b52eb72c6" title=" " alt="" coords="799,5,935,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="aada1f75e02b085c6a43438e5ab1c81e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aada1f75e02b085c6a43438e5ab1c81e0">&#9670;&nbsp;</a></span>oc12_bbt_set()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_bbt_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;{</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <a class="code" href="structNvmeNamespace.html">NvmeNamespace</a> *ns;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <a class="code" href="structOc12IdGroup.html">Oc12IdGroup</a> *c = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>.<a class="code" href="structOc12IdCtrl.html#adc341b399768a73cfc579fd4862747af">groups</a>[0];</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <a class="code" href="structOc12BbtSet.html">Oc12BbtSet</a> *bbt_cmd = (<a class="code" href="structOc12BbtSet.html">Oc12BbtSet</a> *)cmd;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160; </div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    uint32_t nsid = le32_to_cpu(bbt_cmd-&gt;<a class="code" href="structOc12BbtSet.html#a1312aaa0b5e48450701addb06dd43a83">nsid</a>);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    uint64_t prp2 = le64_to_cpu(bbt_cmd-&gt;<a class="code" href="structOc12BbtSet.html#aec594183763aa14fd735ad04dbe63830">prp2</a>);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    uint32_t nlb  = le16_to_cpu(bbt_cmd-&gt;<a class="code" href="structOc12BbtSet.html#adcd963607738b6b16dcc474a9ea6ba77">nlb</a>) + 1;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    uint64_t spba = le64_to_cpu(bbt_cmd-&gt;<a class="code" href="structOc12BbtSet.html#a09a420ca0359bea94fa880b9e6dfe577">spba</a>);</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    uint8_t value = bbt_cmd-&gt;<a class="code" href="structOc12BbtSet.html#a31425c5146736dfb7d4da2adee768805">value</a>;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    uint64_t ppas[ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a7a9dd0f60d13cd9027ee190ee1e98ef9">max_sec_per_rq</a>];</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordtype">int</span> ch, lun, lunid, blk;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">if</span> (nsid == 0 || nsid &gt; n-&gt;<a class="code" href="structFemuCtrl.html#a8bd3f2107e1a59779f7d6a669e29b5af">num_namespaces</a>) {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a4c080463e158441c5b7b4000da2ed3e4">NVME_INVALID_NSID</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    ns = &amp;n-&gt;<a class="code" href="structFemuCtrl.html#a98ca6ff3bc65ccc7f98a589e018b7d71">namespaces</a>[nsid - 1];</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span> (nlb == 1) {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        ppas[0] = spba;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        ch = (ppas[0] &amp; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ade7c31f1d074dbbecce98d67d1219ec4">ch_mask</a>) &gt;&gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ae474e1c6b5b4bc9db7e1933b8d1bbacc">ch_offset</a>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        lun = (ppas[0] &amp; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af0528b7d3f8355056e2e3c1263bbf847">lun_mask</a>) &gt;&gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a4d8bb807dc7938223baaab7656c8e787">lun_offset</a>;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        blk = (ppas[0] &amp; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ae039cd10c2f3514fbce779e08d4f2a63">blk_mask</a>) &gt;&gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ac8f3101533f75b6616ef523aedb61bb0">blk_offset</a>;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        lunid = ch * c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a> + lun;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        ns-&gt;<a class="code" href="structNvmeNamespace.html#a95506f6c42f0b9bb0ef45bbc9d6a49be">bbtbl</a>[lunid]-&gt;<a class="code" href="structOc12Bbt.html#a1e7e14a98fb0cc8e5ecb13b1ec6cac08">blk</a>[blk] = value;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="dma_8c.html#adef0f21bc237d992b4ae8b29258645a8">dma_write_prp</a>(n, (uint8_t *)ppas, nlb * 8, spba, prp2)) {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlb; i++) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            ch = (ppas[i] &amp; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ade7c31f1d074dbbecce98d67d1219ec4">ch_mask</a>) &gt;&gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ae474e1c6b5b4bc9db7e1933b8d1bbacc">ch_offset</a>;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            lun = (ppas[i] &amp; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af0528b7d3f8355056e2e3c1263bbf847">lun_mask</a>) &gt;&gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a4d8bb807dc7938223baaab7656c8e787">lun_offset</a>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            blk = (ppas[i] &amp; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ae039cd10c2f3514fbce779e08d4f2a63">blk_mask</a>) &gt;&gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ac8f3101533f75b6616ef523aedb61bb0">blk_offset</a>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            lunid = ch * c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a> + lun;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            ns-&gt;<a class="code" href="structNvmeNamespace.html#a95506f6c42f0b9bb0ef45bbc9d6a49be">bbtbl</a>[lunid]-&gt;<a class="code" href="structOc12Bbt.html#a1e7e14a98fb0cc8e5ecb13b1ec6cac08">blk</a>[blk] = value;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160; </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a3268f6be90861f0c2270d86a44d5b09c">NVME_SUCCESS</a>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aada1f75e02b085c6a43438e5ab1c81e0_cgraph.png" border="0" usemap="#oc12_8c_aada1f75e02b085c6a43438e5ab1c81e0_cgraph" alt=""/></div>
<map name="oc12_8c_aada1f75e02b085c6a43438e5ab1c81e0_cgraph" id="oc12_8c_aada1f75e02b085c6a43438e5ab1c81e0_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,113,32"/>
<area shape="rect" href="dma_8c.html#adef0f21bc237d992b4ae8b29258645a8" title=" " alt="" coords="161,5,280,32"/>
<area shape="rect" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493" title=" " alt="" coords="328,5,451,32"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="499,5,629,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aada1f75e02b085c6a43438e5ab1c81e0_icgraph.png" border="0" usemap="#oc12_8c_aada1f75e02b085c6a43438e5ab1c81e0_icgraph" alt=""/></div>
<map name="oc12_8c_aada1f75e02b085c6a43438e5ab1c81e0_icgraph" id="oc12_8c_aada1f75e02b085c6a43438e5ab1c81e0_icgraph">
<area shape="rect" title=" " alt="" coords="983,5,1091,32"/>
<area shape="rect" href="oc12_8c.html#a68620169de187b09e15ef18b52eb72c6" title=" " alt="" coords="799,5,935,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="aab1abde67fc0b44326b1772846549abf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab1abde67fc0b44326b1772846549abf">&#9670;&nbsp;</a></span>oc12_erase_async()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_erase_async </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeRequest.html">NvmeRequest</a> *&#160;</td>
          <td class="paramname"><em>req</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;{</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *dm = (<a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *)cmd;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    uint32_t nlb = le16_to_cpu(dm-&gt;<a class="code" href="structOc12RwCmd.html#ab43b0d732b299b53629be5e0120f2930">nlb</a>) + 1;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    uint64_t psl[ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a7a9dd0f60d13cd9027ee190ee1e98ef9">max_sec_per_rq</a>];</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <a class="code" href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a">oc12_read_ppa_list</a>(n, dm, psl);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <a class="code" href="oc12_8c.html#a513d4b55522984724a7586103d0dccde">oc12_meta_blk_set_erased</a>(ns, ln, psl, nlb);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23">oc12_advance_status</a>(n, ns, cmd, req);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a3268f6be90861f0c2270d86a44d5b09c">NVME_SUCCESS</a>;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aab1abde67fc0b44326b1772846549abf_cgraph.png" border="0" usemap="#oc12_8c_aab1abde67fc0b44326b1772846549abf_cgraph" alt=""/></div>
<map name="oc12_8c_aab1abde67fc0b44326b1772846549abf_cgraph" id="oc12_8c_aab1abde67fc0b44326b1772846549abf_cgraph">
<area shape="rect" title=" " alt="" coords="5,189,147,216"/>
<area shape="rect" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23" title=" " alt="" coords="213,127,375,153"/>
<area shape="rect" href="oc12_8c.html#a513d4b55522984724a7586103d0dccde" title=" " alt="" coords="195,189,393,216"/>
<area shape="rect" href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a" title=" " alt="" coords="221,265,367,292"/>
<area shape="rect" href="timing_8c.html#a1e23cd59a19d5524e59e8a130a0318ca" title=" " alt="" coords="441,31,655,57"/>
<area shape="rect" href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e" title=" " alt="" coords="453,81,643,108"/>
<area shape="rect" href="oc12_8c.html#a7c5fa0dc26c1d7334be3de1917e950f4" title=" " alt="" coords="490,132,606,159"/>
<area shape="rect" href="nand_8h.html#a8114ba8a535f9a3dba0f920bd8a3ade3" title=" " alt="" coords="707,5,875,32"/>
<area shape="rect" href="nand_8h.html#a1df10f9cc5736ecc33431a60f6191356" title=" " alt="" coords="705,56,878,83"/>
<area shape="rect" href="nand_8h.html#ab8913f0fbdd3cb447393cef3754be7c4" title=" " alt="" coords="703,107,880,133"/>
<area shape="rect" href="nand_8h.html#aea24174b997828eb73fe8f0e7c83209e" title=" " alt="" coords="732,157,851,184"/>
<area shape="rect" href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94" title=" " alt="" coords="467,183,629,209"/>
<area shape="rect" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8" title=" " alt="" coords="743,233,839,260"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="483,284,613,311"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aab1abde67fc0b44326b1772846549abf_icgraph.png" border="0" usemap="#oc12_8c_aab1abde67fc0b44326b1772846549abf_icgraph" alt=""/></div>
<map name="oc12_8c_aab1abde67fc0b44326b1772846549abf_icgraph" id="oc12_8c_aab1abde67fc0b44326b1772846549abf_icgraph">
<area shape="rect" title=" " alt="" coords="953,5,1095,32"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,5,905,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="adb2f63023ff079bd918f3e0a2fc99c0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb2f63023ff079bd918f3e0a2fc99c0a">&#9670;&nbsp;</a></span>oc12_exit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void oc12_exit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;{</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <a class="code" href="oc12_8c.html#a42a412e9ba005df6611a73cfbb61ed85">oc12_release_locks</a>(n);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_adb2f63023ff079bd918f3e0a2fc99c0a_cgraph.png" border="0" usemap="#oc12_8c_adb2f63023ff079bd918f3e0a2fc99c0a_cgraph" alt=""/></div>
<map name="oc12_8c_adb2f63023ff079bd918f3e0a2fc99c0a_cgraph" id="oc12_8c_adb2f63023ff079bd918f3e0a2fc99c0a_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,91,32"/>
<area shape="rect" href="oc12_8c.html#a42a412e9ba005df6611a73cfbb61ed85" title=" " alt="" coords="139,5,288,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_adb2f63023ff079bd918f3e0a2fc99c0a_icgraph.png" border="0" usemap="#oc12_8c_adb2f63023ff079bd918f3e0a2fc99c0a_icgraph" alt=""/></div>
<map name="oc12_8c_adb2f63023ff079bd918f3e0a2fc99c0a_icgraph" id="oc12_8c_adb2f63023ff079bd918f3e0a2fc99c0a_icgraph">
<area shape="rect" title=" " alt="" coords="799,5,884,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a6edf286a27463261b9a975ee1eeefcc8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6edf286a27463261b9a975ee1eeefcc8">&#9670;&nbsp;</a></span>oc12_get_l2p_tbl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_get_l2p_tbl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;{</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <a class="code" href="structNvmeNamespace.html">NvmeNamespace</a> *ns;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="structOc12GetL2PTbl.html">Oc12GetL2PTbl</a> *gtbl = (<a class="code" href="structOc12GetL2PTbl.html">Oc12GetL2PTbl</a>*)cmd;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    uint64_t slba = le64_to_cpu(gtbl-&gt;<a class="code" href="structOc12GetL2PTbl.html#a8bdab00db0890306bf991124b890290e">slba</a>);</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    uint32_t nlb = le32_to_cpu(gtbl-&gt;<a class="code" href="structOc12GetL2PTbl.html#ad22a0ce2375f771970212ed240433cc3">nlb</a>);</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    uint64_t prp1 = le64_to_cpu(gtbl-&gt;<a class="code" href="structOc12GetL2PTbl.html#a6ecce1c7263673a58df566158357196c">prp1</a>);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    uint64_t prp2 = le64_to_cpu(gtbl-&gt;<a class="code" href="structOc12GetL2PTbl.html#a0778e8198dabca70c15f47bc5616082b">prp2</a>);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    uint32_t nsid = le32_to_cpu(gtbl-&gt;<a class="code" href="structOc12GetL2PTbl.html#a45e8a56cc4704da9bb9f677afa9debc4">nsid</a>);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    uint64_t xfer_len = nlb * <span class="keyword">sizeof</span>(*(ns-&gt;<a class="code" href="structNvmeNamespace.html#a0e6565e5bda500bf95530011731823c2">tbl</a>));</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> (nsid == 0 || nsid &gt; n-&gt;<a class="code" href="structFemuCtrl.html#a8bd3f2107e1a59779f7d6a669e29b5af">num_namespaces</a>) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a4c080463e158441c5b7b4000da2ed3e4">NVME_INVALID_NSID</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    ns = &amp;n-&gt;<a class="code" href="structFemuCtrl.html#a98ca6ff3bc65ccc7f98a589e018b7d71">namespaces</a>[nsid - 1];</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">if</span> (slba &gt;= ns-&gt;tbl_entries) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">if</span> ((slba + nlb) &gt; ns-&gt;tbl_entries) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dma_8c.html#a83e01cb3ebf3721ca1fd024940ed6aa6">dma_read_prp</a>(n, (uint8_t *)&amp;ns-&gt;tbl[slba], xfer_len, prp1, prp2)) {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a3268f6be90861f0c2270d86a44d5b09c">NVME_SUCCESS</a>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a6edf286a27463261b9a975ee1eeefcc8_cgraph.png" border="0" usemap="#oc12_8c_a6edf286a27463261b9a975ee1eeefcc8_cgraph" alt=""/></div>
<map name="oc12_8c_a6edf286a27463261b9a975ee1eeefcc8_cgraph" id="oc12_8c_a6edf286a27463261b9a975ee1eeefcc8_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,137,32"/>
<area shape="rect" href="dma_8c.html#a83e01cb3ebf3721ca1fd024940ed6aa6" title=" " alt="" coords="185,5,300,32"/>
<area shape="rect" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493" title=" " alt="" coords="348,5,471,32"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="519,5,649,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a6edf286a27463261b9a975ee1eeefcc8_icgraph.png" border="0" usemap="#oc12_8c_a6edf286a27463261b9a975ee1eeefcc8_icgraph" alt=""/></div>
<map name="oc12_8c_a6edf286a27463261b9a975ee1eeefcc8_icgraph" id="oc12_8c_a6edf286a27463261b9a975ee1eeefcc8_icgraph">
<area shape="rect" title=" " alt="" coords="983,5,1115,32"/>
<area shape="rect" href="oc12_8c.html#a68620169de187b09e15ef18b52eb72c6" title=" " alt="" coords="799,5,935,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a126a85634fc530e22284c185df8f5f81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a126a85634fc530e22284c185df8f5f81">&#9670;&nbsp;</a></span>oc12_identity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_identity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;{</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <a class="code" href="structNvmeIdentity.html">NvmeIdentify</a> *c = (<a class="code" href="structNvmeIdentity.html">NvmeIdentify</a> *)cmd;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    uint32_t nsid = le32_to_cpu(c-&gt;<a class="code" href="structNvmeIdentity.html#a00384fddea98b5e53fde34ddc53260be">nsid</a>);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    uint64_t prp1 = le64_to_cpu(c-&gt;<a class="code" href="structNvmeIdentity.html#a984de8dea6f880cd774b5c9883fcf12d">prp1</a>);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    uint64_t prp2 = le64_to_cpu(c-&gt;<a class="code" href="structNvmeIdentity.html#af864ba765f00bea6fb319733be440384">prp2</a>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">if</span> (nsid == 0 || nsid &gt; n-&gt;<a class="code" href="structFemuCtrl.html#a8bd3f2107e1a59779f7d6a669e29b5af">num_namespaces</a>) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a4c080463e158441c5b7b4000da2ed3e4">NVME_INVALID_NSID</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="dma_8c.html#a83e01cb3ebf3721ca1fd024940ed6aa6">dma_read_prp</a>(n, (uint8_t *)&amp;n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>,</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                             <span class="keyword">sizeof</span>(<a class="code" href="structOc12IdCtrl.html">Oc12IdCtrl</a>), prp1, prp2);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a126a85634fc530e22284c185df8f5f81_cgraph.png" border="0" usemap="#oc12_8c_a126a85634fc530e22284c185df8f5f81_cgraph" alt=""/></div>
<map name="oc12_8c_a126a85634fc530e22284c185df8f5f81_cgraph" id="oc12_8c_a126a85634fc530e22284c185df8f5f81_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,116,32"/>
<area shape="rect" href="dma_8c.html#a83e01cb3ebf3721ca1fd024940ed6aa6" title=" " alt="" coords="164,5,279,32"/>
<area shape="rect" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493" title=" " alt="" coords="327,5,449,32"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="497,5,628,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a126a85634fc530e22284c185df8f5f81_icgraph.png" border="0" usemap="#oc12_8c_a126a85634fc530e22284c185df8f5f81_icgraph" alt=""/></div>
<map name="oc12_8c_a126a85634fc530e22284c185df8f5f81_icgraph" id="oc12_8c_a126a85634fc530e22284c185df8f5f81_icgraph">
<area shape="rect" title=" " alt="" coords="983,5,1093,32"/>
<area shape="rect" href="oc12_8c.html#a68620169de187b09e15ef18b52eb72c6" title=" " alt="" coords="799,5,935,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a0caef7cdff7d502bdf678c7e8c57e35e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0caef7cdff7d502bdf678c7e8c57e35e">&#9670;&nbsp;</a></span>oc12_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void oc12_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Error **&#160;</td>
          <td class="paramname"><em>errp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;{</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <a class="code" href="nvme_8h.html#aa10d8964216c470eeb0846d68305dc86">NVME_CAP_SET_OC</a>(n-&gt;<a class="code" href="structFemuCtrl.html#ae419c3a209fe0ffb9f6e04bc6ff3cd7e">bar</a>.<a class="code" href="structNvmeBar.html#ad5910458ce9220c367e14c8482117018">cap</a>, 1);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <a class="code" href="oc12_8c.html#aef55b0e79dd4659d66fc1d7d83b3a88a">oc12_set_ctrl_str</a>(n);</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160; </div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n-&gt;<a class="code" href="structFemuCtrl.html#a8bd3f2107e1a59779f7d6a669e29b5af">num_namespaces</a>; i++) {</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <a class="code" href="structNvmeNamespace.html">NvmeNamespace</a> *ns = &amp;n-&gt;<a class="code" href="structFemuCtrl.html#a98ca6ff3bc65ccc7f98a589e018b7d71">namespaces</a>[i];</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <a class="code" href="structNvmeIdNs.html">NvmeIdNs</a> *id_ns = &amp;ns-&gt;<a class="code" href="structNvmeNamespace.html#ac5c0ddf3fd8b71e4387062b8a5e1075d">id_ns</a>;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        id_ns-&gt;<a class="code" href="structNvmeIdNs.html#aeeebe8821a3ff138cdd9bd4208b71a14">vs</a>[0] = 0x1;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    }</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <a class="code" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088">oc12_init_more</a>(n);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a0caef7cdff7d502bdf678c7e8c57e35e_cgraph.png" border="0" usemap="#oc12_8c_a0caef7cdff7d502bdf678c7e8c57e35e_cgraph" alt=""/></div>
<map name="oc12_8c_a0caef7cdff7d502bdf678c7e8c57e35e_cgraph" id="oc12_8c_a0caef7cdff7d502bdf678c7e8c57e35e_cgraph">
<area shape="rect" title=" " alt="" coords="5,436,87,463"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="139,335,262,361"/>
<area shape="rect" href="oc12_8c.html#aef55b0e79dd4659d66fc1d7d83b3a88a" title=" " alt="" coords="135,461,267,488"/>
<area shape="rect" href="nand_8c.html#abf5d19b68122bdd6e7769c2d86d12e12" title=" " alt="" coords="334,107,454,133"/>
<area shape="rect" href="oc12_8c.html#a3d17602b61b416c29c19265374c0801b" title=" " alt="" coords="333,157,455,184"/>
<area shape="rect" href="oc12_8c.html#a22cb229f7099e5695f0525b8b74ffa37" title=" " alt="" coords="330,208,458,235"/>
<area shape="rect" href="oc12_8c.html#aa22cd7b8b8e5064da4267752f5f47016" title=" " alt="" coords="333,259,455,285"/>
<area shape="rect" href="oc12_8c.html#a0e77c275cce3ddf13e9092d72285d6f5" title=" " alt="" coords="335,309,453,336"/>
<area shape="rect" href="oc12_8c.html#a59f1fe491b2d6a603c05c6488eba019a" title=" " alt="" coords="325,360,463,387"/>
<area shape="rect" href="oc12_8c.html#a9c3bc08fae8d78b595c291eee88526ad" title=" " alt="" coords="334,411,454,437"/>
<area shape="rect" href="oc12_8c.html#aee96b1d201c8c59efdcf0ca09c94ae69" title=" " alt="" coords="551,436,661,463"/>
<area shape="rect" href="oc12_8c.html#a36ce2e77da3b587fd610f820a2613ca1" title=" " alt="" coords="324,512,464,539"/>
<area shape="rect" href="nand_8c.html#ac06b76cb4e1499cd0f5086d231a92bf2" title=" " alt="" coords="523,5,689,32"/>
<area shape="rect" href="nand_8c.html#a37e87937b3211fc7dbe4b940ba9b6797" title=" " alt="" coords="521,56,691,83"/>
<area shape="rect" href="nand_8c.html#a7710f745cac37cb6e8bce3f23563ae3f" title=" " alt="" coords="526,107,686,133"/>
<area shape="rect" href="nand_8c.html#a8cb0a9f52feff4b7ff071d57c217cf86" title=" " alt="" coords="527,157,685,184"/>
<area shape="rect" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc" title=" " alt="" coords="565,208,647,235"/>
<area shape="rect" href="timing_8c.html#aa8618254a23869568da186caca33e37b" title=" " alt="" coords="557,309,655,336"/>
<area shape="rect" href="nvme-util_8c.html#a9e84e8328646dcb1f24be9c79018e6a0" title=" " alt="" coords="315,563,473,589"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a0caef7cdff7d502bdf678c7e8c57e35e_icgraph.png" border="0" usemap="#oc12_8c_a0caef7cdff7d502bdf678c7e8c57e35e_icgraph" alt=""/></div>
<map name="oc12_8c_a0caef7cdff7d502bdf678c7e8c57e35e_icgraph" id="oc12_8c_a0caef7cdff7d502bdf678c7e8c57e35e_icgraph">
<area shape="rect" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a3d17602b61b416c29c19265374c0801b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d17602b61b416c29c19265374c0801b">&#9670;&nbsp;</a></span>oc12_init_bbtbl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_init_bbtbl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;{</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="structOc12IdGroup.html">Oc12IdGroup</a> *c = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>.<a class="code" href="structOc12IdCtrl.html#adc341b399768a73cfc579fd4862747af">groups</a>[0];</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    uint32_t nr_tt_luns;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    uint32_t blks_per_lun;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    nr_tt_luns = c-&gt;<a class="code" href="structOc12IdGroup.html#a6a3f7995780567cae58de14a9596cee2">num_ch</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a>;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    blks_per_lun = c-&gt;<a class="code" href="structOc12IdGroup.html#ad4de9a793ea8301bcadc677d9524a6af">num_blk</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    ns-&gt;<a class="code" href="structNvmeNamespace.html#a95506f6c42f0b9bb0ef45bbc9d6a49be">bbtbl</a> = g_malloc0(<span class="keyword">sizeof</span>(<a class="code" href="structOc12Bbt.html">Oc12Bbt</a> *) * nr_tt_luns);</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nr_tt_luns; i++) {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="comment">/* Coperd: init per-lun bbtbl */</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <a class="code" href="structOc12Bbt.html">Oc12Bbt</a> *bbt = g_malloc0(<span class="keyword">sizeof</span>(<a class="code" href="structOc12Bbt.html">Oc12Bbt</a>) + blks_per_lun);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        bbt-&gt;<a class="code" href="structOc12Bbt.html#af7cb982c83b1df8c9f6c86924e54bfc2">tblid</a>[0] = <span class="charliteral">&#39;B&#39;</span>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        bbt-&gt;<a class="code" href="structOc12Bbt.html#af7cb982c83b1df8c9f6c86924e54bfc2">tblid</a>[1] = <span class="charliteral">&#39;B&#39;</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        bbt-&gt;<a class="code" href="structOc12Bbt.html#af7cb982c83b1df8c9f6c86924e54bfc2">tblid</a>[2] = <span class="charliteral">&#39;L&#39;</span>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        bbt-&gt;<a class="code" href="structOc12Bbt.html#af7cb982c83b1df8c9f6c86924e54bfc2">tblid</a>[3] = <span class="charliteral">&#39;T&#39;</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        bbt-&gt;<a class="code" href="structOc12Bbt.html#a5f4ffc91bc8fd86cb5ce97115c430fa7">verid</a>    = cpu_to_le16(1);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        bbt-&gt;<a class="code" href="structOc12Bbt.html#a35bb52c3ac4df4df161005835386c0f8">tblks</a>    = cpu_to_le32(blks_per_lun);</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        ns-&gt;<a class="code" href="structNvmeNamespace.html#a95506f6c42f0b9bb0ef45bbc9d6a49be">bbtbl</a>[i]  = bbt;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    }</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160; </div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a3d17602b61b416c29c19265374c0801b_icgraph.png" border="0" usemap="#oc12_8c_a3d17602b61b416c29c19265374c0801b_icgraph" alt=""/></div>
<map name="oc12_8c_a3d17602b61b416c29c19265374c0801b_icgraph" id="oc12_8c_a3d17602b61b416c29c19265374c0801b_icgraph">
<area shape="rect" title=" " alt="" coords="1099,5,1220,32"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a22cb229f7099e5695f0525b8b74ffa37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22cb229f7099e5695f0525b8b74ffa37">&#9670;&nbsp;</a></span>oc12_init_id_ctrl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void oc12_init_id_ctrl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *&#160;</td>
          <td class="paramname"><em>ln</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;{</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <a class="code" href="structOc12IdCtrl.html">Oc12IdCtrl</a> *ln_id = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#a24671d2561fff3837d6c03ab44897096">ver_id</a> = 1;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ac86b18f30c76fbe9a79c043a9fe34601">dom</a> = 0;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#a713cdc7093afae3f9b080c547ee8f325">vmnt</a> = 0;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#a4618892d39eb4490a15bf687b8be47e7">cgrps</a> = 1;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#add69cfd7b5a15e11c89be87f2d71644c">cap</a> = cpu_to_le32(0x3);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">/* Addr format: CHANNEL | LUN | BLOCK | PAGE | PLANE | SECTOR */</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a29706826c796b39de0fc7d49568c6feb">sect_offset</a> = 0;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#acb83182a42fa9b49e541b3ad9783d106">sect_len</a>    = <a class="code" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc">qemu_fls</a>(cpu_to_le16(ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#abfa9dc93828353063fc768dcaf10f57f">sec_per_pg</a>) - 1);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a6e9de9b4a4237b3b503a4233b67d254c">pln_offset</a>  = ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a29706826c796b39de0fc7d49568c6feb">sect_offset</a> + ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#acb83182a42fa9b49e541b3ad9783d106">sect_len</a>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#abeba883866c7686c68c4c4fa17875c09">pln_len</a>     = <a class="code" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc">qemu_fls</a>(cpu_to_le16(ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#ae1e90c5b8a4721bbb9eca2f3e8622c9f">num_pln</a>) - 1);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#aab081cf0b7c3a3e3e39bb2bb5c8f2dc5">pg_offset</a>   = ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a6e9de9b4a4237b3b503a4233b67d254c">pln_offset</a> + ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#abeba883866c7686c68c4c4fa17875c09">pln_len</a>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a6a77c923124143b7015002fd8084cd78">pg_len</a>      = <a class="code" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc">qemu_fls</a>(cpu_to_le16(ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a197d0d5dfe7b68f1b797dd17fb3af9c5">pgs_per_blk</a>) - 1);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a80056747d5d7ccd2ff84a24e60ffd1de">blk_offset</a>  = ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#aab081cf0b7c3a3e3e39bb2bb5c8f2dc5">pg_offset</a> + ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a6a77c923124143b7015002fd8084cd78">pg_len</a>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a05627c4f6be70dc17252ac0ff0fae901">blk_len</a>     = <a class="code" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc">qemu_fls</a>(cpu_to_le16(ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>.<a class="code" href="structOc12IdCtrl.html#adc341b399768a73cfc579fd4862747af">groups</a>[0].<a class="code" href="structOc12IdGroup.html#ad4de9a793ea8301bcadc677d9524a6af">num_blk</a>) - 1);</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a4f1c68d53544e4756997300fcf1492ca">lun_offset</a>  = ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a80056747d5d7ccd2ff84a24e60ffd1de">blk_offset</a> + ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a05627c4f6be70dc17252ac0ff0fae901">blk_len</a>;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a91100993590071ca1a4c18879bdabf14">lun_len</a>     = <a class="code" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc">qemu_fls</a>(cpu_to_le16(ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#af14b526379f64a2d408b59dbb974fd79">num_lun</a>) - 1);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#acedafdfd6c6fec774bfed650d32bfbb5">ch_offset</a>   = ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a4f1c68d53544e4756997300fcf1492ca">lun_offset</a> + ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a91100993590071ca1a4c18879bdabf14">lun_len</a>;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    ln_id-&gt;<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>.<a class="code" href="structOc12IdAddrFormat.html#a8dd7964ba2028ca75799d5b34414400b">ch_len</a>      = <a class="code" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc">qemu_fls</a>(cpu_to_le16(ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a6c9f6dc12e991d1bf1846f884ae63c77">num_ch</a>) - 1);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a22cb229f7099e5695f0525b8b74ffa37_cgraph.png" border="0" usemap="#oc12_8c_a22cb229f7099e5695f0525b8b74ffa37_cgraph" alt=""/></div>
<map name="oc12_8c_a22cb229f7099e5695f0525b8b74ffa37_cgraph" id="oc12_8c_a22cb229f7099e5695f0525b8b74ffa37_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,133,32"/>
<area shape="rect" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc" title=" " alt="" coords="181,5,263,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a22cb229f7099e5695f0525b8b74ffa37_icgraph.png" border="0" usemap="#oc12_8c_a22cb229f7099e5695f0525b8b74ffa37_icgraph" alt=""/></div>
<map name="oc12_8c_a22cb229f7099e5695f0525b8b74ffa37_icgraph" id="oc12_8c_a22cb229f7099e5695f0525b8b74ffa37_icgraph">
<area shape="rect" title=" " alt="" coords="1099,5,1227,32"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="aa22cd7b8b8e5064da4267752f5f47016"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa22cd7b8b8e5064da4267752f5f47016">&#9670;&nbsp;</a></span>oc12_init_meta()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_init_meta </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *&#160;</td>
          <td class="paramname"><em>ln</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;{</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">/* Internal meta (state: ERASED / WRITTEN) */</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    ln-&gt;<a class="code" href="structOc12Ctrl.html#a1a9ae7fad2a49762e7fbe454212d1e45">int_meta_size</a> = 4;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">     * Internal meta are the first &quot;ln-&gt;int_meta_size&quot; bytes</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">     * Then comes the tgt_oob_len which is the following ln-&gt;param.sos bytes</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    ln-&gt;<a class="code" href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">meta_len</a>    = ln-&gt;<a class="code" href="structOc12Ctrl.html#a1a9ae7fad2a49762e7fbe454212d1e45">int_meta_size</a> + ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a>;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    ln-&gt;<a class="code" href="structOc12Ctrl.html#aff7d8b44a82ea05d3170d4aa2ebcc193">meta_tbytes</a> = ln-&gt;<a class="code" href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">meta_len</a> * ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a70b265aed071dd11efd5f0741d9b9e3d">total_secs</a>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">/* Coperd: we put all the meta data into this buffer */</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;Allocating OOB: %.1f MB\n&quot;</span>, ln-&gt;<a class="code" href="structOc12Ctrl.html#aff7d8b44a82ea05d3170d4aa2ebcc193">meta_tbytes</a> / 1024 / 1024.0);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    ln-&gt;<a class="code" href="structOc12Ctrl.html#ad73b7957a8be1fb41bff6175916f73df">meta_buf</a> = g_malloc0(ln-&gt;<a class="code" href="structOc12Ctrl.html#aff7d8b44a82ea05d3170d4aa2ebcc193">meta_tbytes</a>);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aa22cd7b8b8e5064da4267752f5f47016_icgraph.png" border="0" usemap="#oc12_8c_aa22cd7b8b8e5064da4267752f5f47016_icgraph" alt=""/></div>
<map name="oc12_8c_aa22cd7b8b8e5064da4267752f5f47016_icgraph" id="oc12_8c_aa22cd7b8b8e5064da4267752f5f47016_icgraph">
<area shape="rect" title=" " alt="" coords="1099,5,1221,32"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a0e77c275cce3ddf13e9092d72285d6f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e77c275cce3ddf13e9092d72285d6f5">&#9670;&nbsp;</a></span>oc12_init_misc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_init_misc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;{</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <a class="code" href="timing_8c.html#aa8618254a23869568da186caca33e37b">set_latency</a>(n);</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="nvme_8h.html#ad687b13a8721e862fd66459c865669e6">FEMU_MAX_NUM_CHNLS</a>; i++) {</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        n-&gt;<a class="code" href="structFemuCtrl.html#a337abc6776202efbda3ad932da7e020d">chnl_next_avail_time</a>[i] = 0;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160; </div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="comment">/* FIXME: Can we use PTHREAD_PROCESS_PRIVATE here? */</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        ret = pthread_spin_init(&amp;n-&gt;<a class="code" href="structFemuCtrl.html#a0e1b916dcb45d831a416bd84da70d25d">chnl_locks</a>[i], PTHREAD_PROCESS_SHARED);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        assert(ret == 0);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    }</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="nvme_8h.html#aa099d68673fc69a8ebeeffc9b00a06d1">FEMU_MAX_NUM_CHIPS</a>; i++) {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        n-&gt;<a class="code" href="structFemuCtrl.html#aa01c6604f4ef7eec3bfdcd0bdd6c43ac">chip_next_avail_time</a>[i] = 0;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="comment">/* FIXME: Can we use PTHREAD_PROCESS_PRIVATE here? */</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        ret = pthread_spin_init(&amp;n-&gt;<a class="code" href="structFemuCtrl.html#a48cf26e3440955b976f0b77c8677c15c">chip_locks</a>[i], PTHREAD_PROCESS_SHARED);</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        assert(ret == 0);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    }</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a0e77c275cce3ddf13e9092d72285d6f5_cgraph.png" border="0" usemap="#oc12_8c_a0e77c275cce3ddf13e9092d72285d6f5_cgraph" alt=""/></div>
<map name="oc12_8c_a0e77c275cce3ddf13e9092d72285d6f5_cgraph" id="oc12_8c_a0e77c275cce3ddf13e9092d72285d6f5_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,124,32"/>
<area shape="rect" href="timing_8c.html#aa8618254a23869568da186caca33e37b" title=" " alt="" coords="172,5,269,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a0e77c275cce3ddf13e9092d72285d6f5_icgraph.png" border="0" usemap="#oc12_8c_a0e77c275cce3ddf13e9092d72285d6f5_icgraph" alt=""/></div>
<map name="oc12_8c_a0e77c275cce3ddf13e9092d72285d6f5_icgraph" id="oc12_8c_a0e77c275cce3ddf13e9092d72285d6f5_icgraph">
<area shape="rect" title=" " alt="" coords="1099,5,1217,32"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a08d50fc7f025a0a40c4a68a76fd5a088"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08d50fc7f025a0a40c4a68a76fd5a088">&#9670;&nbsp;</a></span>oc12_init_more()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_init_more </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;{</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <a class="code" href="structOc12IdGroup.html">Oc12IdGroup</a> *c;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <a class="code" href="structNvmeNamespace.html">NvmeNamespace</a> *ns;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keyword">struct </span><a class="code" href="structOc12IdAddrFormat.html">Oc12IdAddrFormat</a> *ppaf;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <a class="code" href="structOc12Params.html">Oc12Params</a> *lps;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    uint64_t chnl_blks;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160; </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a> = g_malloc0(<span class="keyword">sizeof</span>(<a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a>));</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    ppaf = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>.<a class="code" href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">ppaf</a>;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    lps = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <a class="code" href="oc12_8c.html#a59f1fe491b2d6a603c05c6488eba019a">oc12_init_params</a>(n);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">if</span> (lps-&gt;<a class="code" href="structOc12Params.html#a25caa2793ab1badb2edaa4eccc1e40e1">mtype</a> != 0)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;FEMU: Only NAND Flash Memory supported at the moment\n&quot;</span>);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">if</span> ((lps-&gt;<a class="code" href="structOc12Params.html#ae1e90c5b8a4721bbb9eca2f3e8622c9f">num_pln</a> &gt; 4) || (lps-&gt;<a class="code" href="structOc12Params.html#ae1e90c5b8a4721bbb9eca2f3e8622c9f">num_pln</a> == 3))</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;FEMU: Only 1/2/4-plane modes supported\n&quot;</span>);</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <a class="code" href="oc12_8c.html#a0e77c275cce3ddf13e9092d72285d6f5">oc12_init_misc</a>(n);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n-&gt;<a class="code" href="structFemuCtrl.html#a8bd3f2107e1a59779f7d6a669e29b5af">num_namespaces</a>; i++) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        ns = &amp;n-&gt;<a class="code" href="structFemuCtrl.html#a98ca6ff3bc65ccc7f98a589e018b7d71">namespaces</a>[i];</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        chnl_blks = ns-&gt;<a class="code" href="structNvmeNamespace.html#ad0b627e5006c33450b452a995b5c4704">ns_blks</a> / (lps-&gt;<a class="code" href="structOc12Params.html#abfa9dc93828353063fc768dcaf10f57f">sec_per_pg</a> * lps-&gt;<a class="code" href="structOc12Params.html#a197d0d5dfe7b68f1b797dd17fb3af9c5">pgs_per_blk</a> *</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                                   lps-&gt;<a class="code" href="structOc12Params.html#a6c9f6dc12e991d1bf1846f884ae63c77">num_ch</a>);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;chnl_blks=%&quot;</span>PRIu64<span class="stringliteral">&quot;,ns_blks=%&quot;</span>PRIu64<span class="stringliteral">&quot;,sec_per_pg=%d,&quot;</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                   <span class="stringliteral">&quot;pgs_per_blk=%d\n&quot;</span>, chnl_blks, ns-&gt;<a class="code" href="structNvmeNamespace.html#ad0b627e5006c33450b452a995b5c4704">ns_blks</a>, lps-&gt;<a class="code" href="structOc12Params.html#abfa9dc93828353063fc768dcaf10f57f">sec_per_pg</a>,</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                   lps-&gt;<a class="code" href="structOc12Params.html#a197d0d5dfe7b68f1b797dd17fb3af9c5">pgs_per_blk</a>);</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160; </div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        c = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>.<a class="code" href="structOc12IdCtrl.html#adc341b399768a73cfc579fd4862747af">groups</a>[0];</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#aa5b6d65ac99901288264502f0a0b3c83">mtype</a> = lps-&gt;<a class="code" href="structOc12Params.html#a25caa2793ab1badb2edaa4eccc1e40e1">mtype</a>;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#aa85ed70c5e53ba20ef52a4cd57a71ce5">fmtype</a> = lps-&gt;<a class="code" href="structOc12Params.html#a1e9ac0caf8d4bc4999841b8dd729659e">fmtype</a>;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#a6a3f7995780567cae58de14a9596cee2">num_ch</a> = lps-&gt;<a class="code" href="structOc12Params.html#a6c9f6dc12e991d1bf1846f884ae63c77">num_ch</a>;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a> = lps-&gt;<a class="code" href="structOc12Params.html#af14b526379f64a2d408b59dbb974fd79">num_lun</a>;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a> = lps-&gt;<a class="code" href="structOc12Params.html#ae1e90c5b8a4721bbb9eca2f3e8622c9f">num_pln</a>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160; </div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        assert(c-&gt;<a class="code" href="structOc12IdGroup.html#a6a3f7995780567cae58de14a9596cee2">num_ch</a> &lt;= <a class="code" href="nvme_8h.html#ad687b13a8721e862fd66459c865669e6">FEMU_MAX_NUM_CHNLS</a> &amp;&amp; c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a> &lt;= <a class="code" href="nvme_8h.html#aa099d68673fc69a8ebeeffc9b00a06d1">FEMU_MAX_NUM_CHIPS</a>);</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#ad4de9a793ea8301bcadc677d9524a6af">num_blk</a> = cpu_to_le16(chnl_blks) / (c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#a7909a44a554f357cca989384aaf2495a">num_pg</a> = cpu_to_le16(lps-&gt;<a class="code" href="structOc12Params.html#a197d0d5dfe7b68f1b797dd17fb3af9c5">pgs_per_blk</a>);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#a2a0eb1952cba3783b0e56b12a5117975">csecs</a> = cpu_to_le16(lps-&gt;<a class="code" href="structOc12Params.html#a1d40ed4de65d5fa98f4ff9805cd82c04">sec_size</a>);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#a5d709d4b4b3ddce6730de6673ed3f7ac">fpg_sz</a> = cpu_to_le16(lps-&gt;<a class="code" href="structOc12Params.html#a1d40ed4de65d5fa98f4ff9805cd82c04">sec_size</a> * lps-&gt;<a class="code" href="structOc12Params.html#abfa9dc93828353063fc768dcaf10f57f">sec_per_pg</a>);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#afd2cafe94a33040426860a895c6d17af">sos</a> = cpu_to_le16(lps-&gt;<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a>);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160; </div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;num_ch=%d,num_lun=%d,num_pln=%d,num_blk=%d,num_pg=%d,&quot;</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                   <span class="stringliteral">&quot;pg_sz=%d,sos=%d,csecs=%d\n&quot;</span>, c-&gt;<a class="code" href="structOc12IdGroup.html#a6a3f7995780567cae58de14a9596cee2">num_ch</a>, c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a>,</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                   c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>, c-&gt;<a class="code" href="structOc12IdGroup.html#ad4de9a793ea8301bcadc677d9524a6af">num_blk</a>, c-&gt;<a class="code" href="structOc12IdGroup.html#a7909a44a554f357cca989384aaf2495a">num_pg</a>, c-&gt;<a class="code" href="structOc12IdGroup.html#a5d709d4b4b3ddce6730de6673ed3f7ac">fpg_sz</a>, c-&gt;<a class="code" href="structOc12IdGroup.html#afd2cafe94a33040426860a895c6d17af">sos</a>,</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                   c-&gt;<a class="code" href="structOc12IdGroup.html#a2a0eb1952cba3783b0e56b12a5117975">csecs</a>);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160; </div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#aa712d374e318d3d06fe5114f924db0e4">trdt</a> = cpu_to_le32(40000);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#ad3b28b73abc825d8a84366bea0239392">trdm</a> = cpu_to_le32(80000);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#a9acb718bf42389c90fd15bc003a04034">tprt</a> = cpu_to_le32(1500000);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#a6936e76b6a4ca61a37d1bcbc3ea01b85">tprm</a> = cpu_to_le32(3700000);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#adb46ff670c30aa51beb4579adb7c5a77">tbet</a> = cpu_to_le32(6000000);</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#ab1804f4795520f885926d84dda040ad9">tbem</a> = cpu_to_le32(20000000);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <span class="keywordflow">switch</span> (c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>) {</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <span class="keywordflow">case</span> 1:</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            c-&gt;<a class="code" href="structOc12IdGroup.html#a3eb0edbddade2269ac3e9acd04fa2147">mpos</a> = cpu_to_le32(0x10101); <span class="comment">/* single plane */</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            c-&gt;<a class="code" href="structOc12IdGroup.html#a3eb0edbddade2269ac3e9acd04fa2147">mpos</a> = cpu_to_le32(0x20202); <span class="comment">/* dual plane */</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">case</span> 4:</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            c-&gt;<a class="code" href="structOc12IdGroup.html#a3eb0edbddade2269ac3e9acd04fa2147">mpos</a> = cpu_to_le32(0x40404); <span class="comment">/* quad plane */</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;Unsupported NAND plane type (%d)\n&quot;</span>, c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#ad8919bf4f955421370dc3cb6d9719306">cpar</a> = cpu_to_le16(0);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        c-&gt;<a class="code" href="structOc12IdGroup.html#a14587b90e79e5a80b05c1e16ad70588a">mccap</a> = 1;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        ret = <a class="code" href="oc12_8c.html#a3d17602b61b416c29c19265374c0801b">oc12_init_bbtbl</a>(n, ns);</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160; </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="comment">/* calculated values */</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#a866dde01820d32a23b0ab6c74b11ff0d">sec_per_pl</a> = lps-&gt;<a class="code" href="structOc12Params.html#abfa9dc93828353063fc768dcaf10f57f">sec_per_pg</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#a35c0b8bb1fc2cfa8d12a7495f5967b7c">sec_per_blk</a> = lps-&gt;<a class="code" href="structOc12Params.html#a866dde01820d32a23b0ab6c74b11ff0d">sec_per_pl</a> * lps-&gt;<a class="code" href="structOc12Params.html#a197d0d5dfe7b68f1b797dd17fb3af9c5">pgs_per_blk</a>;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#ac90b11508651ffc5ebc403c5caae8dc0">sec_per_lun</a> = lps-&gt;<a class="code" href="structOc12Params.html#a35c0b8bb1fc2cfa8d12a7495f5967b7c">sec_per_blk</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#ad4de9a793ea8301bcadc677d9524a6af">num_blk</a>;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#a1a4dabebac7d6a12bf17e5bf518698c2">sec_per_ch</a> = lps-&gt;<a class="code" href="structOc12Params.html#ac90b11508651ffc5ebc403c5caae8dc0">sec_per_lun</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a>;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#a70b265aed071dd11efd5f0741d9b9e3d">total_secs</a> = lps-&gt;<a class="code" href="structOc12Params.html#a1a4dabebac7d6a12bf17e5bf518698c2">sec_per_ch</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a6a3f7995780567cae58de14a9596cee2">num_ch</a>;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;sec_per_pl=%d,sec_per_blk=%d,sec_per_lun=%d,total_secs=%d\n&quot;</span>,</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                   lps-&gt;<a class="code" href="structOc12Params.html#a866dde01820d32a23b0ab6c74b11ff0d">sec_per_pl</a>, lps-&gt;<a class="code" href="structOc12Params.html#a35c0b8bb1fc2cfa8d12a7495f5967b7c">sec_per_blk</a>, lps-&gt;<a class="code" href="structOc12Params.html#ac90b11508651ffc5ebc403c5caae8dc0">sec_per_lun</a>,</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                   lps-&gt;<a class="code" href="structOc12Params.html#a70b265aed071dd11efd5f0741d9b9e3d">total_secs</a>);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="comment">/* Calculated unit values for ordering */</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#a320d8e81b78d1ab64ff97e93b499e5e6">pl_units</a> = lps-&gt;<a class="code" href="structOc12Params.html#abfa9dc93828353063fc768dcaf10f57f">sec_per_pg</a>;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#aa0eb6efdc901760309f5486bc36c7377">pg_units</a> = lps-&gt;<a class="code" href="structOc12Params.html#a320d8e81b78d1ab64ff97e93b499e5e6">pl_units</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#a18ad0f64dda473a2e3dfe44563b8f20b">blk_units</a> = lps-&gt;<a class="code" href="structOc12Params.html#aa0eb6efdc901760309f5486bc36c7377">pg_units</a> * lps-&gt;<a class="code" href="structOc12Params.html#a197d0d5dfe7b68f1b797dd17fb3af9c5">pgs_per_blk</a>;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#ad1fc4dbff62cd5ae013e33087f7867be">lun_units</a> = lps-&gt;<a class="code" href="structOc12Params.html#a18ad0f64dda473a2e3dfe44563b8f20b">blk_units</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#ad4de9a793ea8301bcadc677d9524a6af">num_blk</a>;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#a5b41da7474672b8a43623b525e29a630">ch_units</a> = lps-&gt;<a class="code" href="structOc12Params.html#ad1fc4dbff62cd5ae013e33087f7867be">lun_units</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a>;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        lps-&gt;<a class="code" href="structOc12Params.html#a68db388373f6d0da613d531282d0b2bc">total_units</a> = lps-&gt;<a class="code" href="structOc12Params.html#a5b41da7474672b8a43623b525e29a630">ch_units</a> * c-&gt;<a class="code" href="structOc12IdGroup.html#a6a3f7995780567cae58de14a9596cee2">num_ch</a>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;pl_units=%d,pg_units=%d,blk_units=%d,lun_units=%d,&quot;</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                   <span class="stringliteral">&quot;ch_units=%d,total_units=%d\n&quot;</span>, lps-&gt;<a class="code" href="structOc12Params.html#a320d8e81b78d1ab64ff97e93b499e5e6">pl_units</a>, lps-&gt;<a class="code" href="structOc12Params.html#aa0eb6efdc901760309f5486bc36c7377">pg_units</a>,</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                   lps-&gt;<a class="code" href="structOc12Params.html#a18ad0f64dda473a2e3dfe44563b8f20b">blk_units</a>, lps-&gt;<a class="code" href="structOc12Params.html#ad1fc4dbff62cd5ae013e33087f7867be">lun_units</a>, lps-&gt;<a class="code" href="structOc12Params.html#a5b41da7474672b8a43623b525e29a630">ch_units</a>,</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                   lps-&gt;<a class="code" href="structOc12Params.html#a68db388373f6d0da613d531282d0b2bc">total_units</a>);</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160; </div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <a class="code" href="oc12_8c.html#a22cb229f7099e5695f0525b8b74ffa37">oc12_init_id_ctrl</a>(ln);</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="comment">/* Address format: CH | LUN | BLK | PG | PL | SEC */</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ad274fcae4d9fa630a186d4640d1fdd4b">sec_offset</a> = ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#a29706826c796b39de0fc7d49568c6feb">sect_offset</a>;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af563da7e6555efe854c0f363d3d7f8cd">pln_offset</a> = ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#a6e9de9b4a4237b3b503a4233b67d254c">pln_offset</a>;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a9f4b8857afe5ec3d69c0c88a5cf150a2">pg_offset</a>  = ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#aab081cf0b7c3a3e3e39bb2bb5c8f2dc5">pg_offset</a>;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ac8f3101533f75b6616ef523aedb61bb0">blk_offset</a> = ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#a80056747d5d7ccd2ff84a24e60ffd1de">blk_offset</a>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a4d8bb807dc7938223baaab7656c8e787">lun_offset</a> = ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#a4f1c68d53544e4756997300fcf1492ca">lun_offset</a>;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ae474e1c6b5b4bc9db7e1933b8d1bbacc">ch_offset</a>  = ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#acedafdfd6c6fec774bfed650d32bfbb5">ch_offset</a>;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160; </div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="comment">/* Address component selection MASK */</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a2e4f8916fc739ff8d205e6bcdeaf9a48">sec_mask</a> = ((1 &lt;&lt; ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#acb83182a42fa9b49e541b3ad9783d106">sect_len</a>) - 1) &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ad274fcae4d9fa630a186d4640d1fdd4b">sec_offset</a>;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a28de76535fbf770c0abd421c251cb906">pln_mask</a> = ((1 &lt;&lt; ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#abeba883866c7686c68c4c4fa17875c09">pln_len</a>) - 1)  &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af563da7e6555efe854c0f363d3d7f8cd">pln_offset</a>;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a5a1ed43b10ab09456de5a14c347df438">pg_mask</a>  = ((1 &lt;&lt; ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#a6a77c923124143b7015002fd8084cd78">pg_len</a>) - 1)   &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a9f4b8857afe5ec3d69c0c88a5cf150a2">pg_offset</a>;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ae039cd10c2f3514fbce779e08d4f2a63">blk_mask</a> = ((1 &lt;&lt; ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#a05627c4f6be70dc17252ac0ff0fae901">blk_len</a>) - 1)  &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ac8f3101533f75b6616ef523aedb61bb0">blk_offset</a>;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af0528b7d3f8355056e2e3c1263bbf847">lun_mask</a> = ((1 &lt;&lt; ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#a91100993590071ca1a4c18879bdabf14">lun_len</a>) -1)   &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a4d8bb807dc7938223baaab7656c8e787">lun_offset</a>;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ade7c31f1d074dbbecce98d67d1219ec4">ch_mask</a>  = ((1 &lt;&lt; ppaf-&gt;<a class="code" href="structOc12IdAddrFormat.html#a8dd7964ba2028ca75799d5b34414400b">ch_len</a>) - 1)   &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ae474e1c6b5b4bc9db7e1933b8d1bbacc">ch_offset</a>;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        ns-&gt;<a class="code" href="structNvmeNamespace.html#add3b0adcb1ba29178ccd71caff85b8a0">tbl_entries</a> = ns-&gt;<a class="code" href="structNvmeNamespace.html#ad0b627e5006c33450b452a995b5c4704">ns_blks</a>;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <span class="keywordflow">if</span> (ns-&gt;<a class="code" href="structNvmeNamespace.html#a0e6565e5bda500bf95530011731823c2">tbl</a>) {</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            g_free(ns-&gt;<a class="code" href="structNvmeNamespace.html#a0e6565e5bda500bf95530011731823c2">tbl</a>);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        }</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        ns-&gt;<a class="code" href="structNvmeNamespace.html#a0e6565e5bda500bf95530011731823c2">tbl</a> = qemu_memalign(4096, <a class="code" href="oc12_8c.html#aee96b1d201c8c59efdcf0ca09c94ae69">oc12_tbl_size</a>(ns));</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <a class="code" href="oc12_8c.html#a36ce2e77da3b587fd610f820a2613ca1">oc12_tbl_initialize</a>(ns);</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    }</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160; </div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <a class="code" href="nand_8c.html#abf5d19b68122bdd6e7769c2d86d12e12">init_nand_flash</a>(n);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    ret = <a class="code" href="oc12_8c.html#aa22cd7b8b8e5064da4267752f5f47016">oc12_init_meta</a>(ln);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;oc12_init_meta failed\n&quot;</span>);</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    }</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    ret = (n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>-&gt;<a class="code" href="structOc12Ctrl.html#afb36938720a7bbc5e46796beca65ed79">read_l2p_tbl</a>) ? <a class="code" href="oc12_8c.html#a9c3bc08fae8d78b595c291eee88526ad">oc12_read_tbls</a>(n) : 0;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;read_l2p_tbl failed\n&quot;</span>);</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    }</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160; </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a08d50fc7f025a0a40c4a68a76fd5a088_cgraph.png" border="0" usemap="#oc12_8c_a08d50fc7f025a0a40c4a68a76fd5a088_cgraph" alt=""/></div>
<map name="oc12_8c_a08d50fc7f025a0a40c4a68a76fd5a088_cgraph" id="oc12_8c_a08d50fc7f025a0a40c4a68a76fd5a088_cgraph">
<area shape="rect" title=" " alt="" coords="5,309,128,336"/>
<area shape="rect" href="nand_8c.html#abf5d19b68122bdd6e7769c2d86d12e12" title=" " alt="" coords="186,107,306,133"/>
<area shape="rect" href="oc12_8c.html#a3d17602b61b416c29c19265374c0801b" title=" " alt="" coords="185,157,307,184"/>
<area shape="rect" href="oc12_8c.html#a22cb229f7099e5695f0525b8b74ffa37" title=" " alt="" coords="182,208,310,235"/>
<area shape="rect" href="oc12_8c.html#aa22cd7b8b8e5064da4267752f5f47016" title=" " alt="" coords="185,259,307,285"/>
<area shape="rect" href="oc12_8c.html#a0e77c275cce3ddf13e9092d72285d6f5" title=" " alt="" coords="187,309,305,336"/>
<area shape="rect" href="oc12_8c.html#a59f1fe491b2d6a603c05c6488eba019a" title=" " alt="" coords="177,360,315,387"/>
<area shape="rect" href="oc12_8c.html#a9c3bc08fae8d78b595c291eee88526ad" title=" " alt="" coords="186,411,306,437"/>
<area shape="rect" href="oc12_8c.html#aee96b1d201c8c59efdcf0ca09c94ae69" title=" " alt="" coords="393,436,504,463"/>
<area shape="rect" href="oc12_8c.html#a36ce2e77da3b587fd610f820a2613ca1" title=" " alt="" coords="176,512,316,539"/>
<area shape="rect" href="nand_8c.html#ac06b76cb4e1499cd0f5086d231a92bf2" title=" " alt="" coords="366,5,531,32"/>
<area shape="rect" href="nand_8c.html#a37e87937b3211fc7dbe4b940ba9b6797" title=" " alt="" coords="364,56,533,83"/>
<area shape="rect" href="nand_8c.html#a7710f745cac37cb6e8bce3f23563ae3f" title=" " alt="" coords="369,107,529,133"/>
<area shape="rect" href="nand_8c.html#a8cb0a9f52feff4b7ff071d57c217cf86" title=" " alt="" coords="370,157,527,184"/>
<area shape="rect" href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc" title=" " alt="" coords="408,208,489,235"/>
<area shape="rect" href="timing_8c.html#aa8618254a23869568da186caca33e37b" title=" " alt="" coords="400,309,497,336"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a08d50fc7f025a0a40c4a68a76fd5a088_icgraph.png" border="0" usemap="#oc12_8c_a08d50fc7f025a0a40c4a68a76fd5a088_icgraph" alt=""/></div>
<map name="oc12_8c_a08d50fc7f025a0a40c4a68a76fd5a088_icgraph" id="oc12_8c_a08d50fc7f025a0a40c4a68a76fd5a088_icgraph">
<area shape="rect" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a59f1fe491b2d6a603c05c6488eba019a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59f1fe491b2d6a603c05c6488eba019a">&#9670;&nbsp;</a></span>oc12_init_params()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_init_params </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;{</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <a class="code" href="structOc12Params.html">Oc12Params</a> *lps;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    lps = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    lps-&gt;<a class="code" href="structOc12Params.html#a1d40ed4de65d5fa98f4ff9805cd82c04">sec_size</a> = n-&gt;<a class="code" href="structFemuCtrl.html#ab1733fec286bf747df6e0e65c8f10e50">oc_params</a>.<a class="code" href="structOcCtrlParams.html#afc98d43543e8564628abe9e7e2c6ef1e">sec_size</a>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    lps-&gt;<a class="code" href="structOc12Params.html#abfa9dc93828353063fc768dcaf10f57f">sec_per_pg</a> = n-&gt;<a class="code" href="structFemuCtrl.html#ab1733fec286bf747df6e0e65c8f10e50">oc_params</a>.<a class="code" href="structOcCtrlParams.html#a5fa8675fa2741984a2a9c3f735f5087b">secs_per_pg</a>;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    lps-&gt;<a class="code" href="structOc12Params.html#a197d0d5dfe7b68f1b797dd17fb3af9c5">pgs_per_blk</a> = n-&gt;<a class="code" href="structFemuCtrl.html#ab1733fec286bf747df6e0e65c8f10e50">oc_params</a>.<a class="code" href="structOcCtrlParams.html#a27781af8d2e57f6ac3baa763d639e3ac">pgs_per_blk</a>;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    lps-&gt;<a class="code" href="structOc12Params.html#a7a9dd0f60d13cd9027ee190ee1e98ef9">max_sec_per_rq</a> = n-&gt;<a class="code" href="structFemuCtrl.html#ab1733fec286bf747df6e0e65c8f10e50">oc_params</a>.<a class="code" href="structOcCtrlParams.html#a9fd47e7ebc5ed9a791b3b5fa84b6cd99">max_sec_per_rq</a>;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    lps-&gt;<a class="code" href="structOc12Params.html#a6c9f6dc12e991d1bf1846f884ae63c77">num_ch</a> = n-&gt;<a class="code" href="structFemuCtrl.html#ab1733fec286bf747df6e0e65c8f10e50">oc_params</a>.<a class="code" href="structOcCtrlParams.html#aa2f8ab02917978e386086f2be076bafb">num_ch</a>;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    lps-&gt;<a class="code" href="structOc12Params.html#af14b526379f64a2d408b59dbb974fd79">num_lun</a> = n-&gt;<a class="code" href="structFemuCtrl.html#ab1733fec286bf747df6e0e65c8f10e50">oc_params</a>.<a class="code" href="structOcCtrlParams.html#ab57709c93e7f0281243ef23b2cbfa77b">num_lun</a>;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    lps-&gt;<a class="code" href="structOc12Params.html#ae1e90c5b8a4721bbb9eca2f3e8622c9f">num_pln</a> = n-&gt;<a class="code" href="structFemuCtrl.html#ab1733fec286bf747df6e0e65c8f10e50">oc_params</a>.<a class="code" href="structOcCtrlParams.html#ab3676d0517ea8d1e17392976cb95ea80">num_pln</a>;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    lps-&gt;<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a> = n-&gt;<a class="code" href="structFemuCtrl.html#ab1733fec286bf747df6e0e65c8f10e50">oc_params</a>.<a class="code" href="structOcCtrlParams.html#accd37db57265d7c819ea71c8e9b7e722">sos</a>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160; </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a59f1fe491b2d6a603c05c6488eba019a_icgraph.png" border="0" usemap="#oc12_8c_a59f1fe491b2d6a603c05c6488eba019a_icgraph" alt=""/></div>
<map name="oc12_8c_a59f1fe491b2d6a603c05c6488eba019a_icgraph" id="oc12_8c_a59f1fe491b2d6a603c05c6488eba019a_icgraph">
<area shape="rect" title=" " alt="" coords="1099,5,1236,32"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a3c41a58559ee2c92463ac4f25dab0a08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c41a58559ee2c92463ac4f25dab0a08">&#9670;&nbsp;</a></span>oc12_io_cmd()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_io_cmd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeRequest.html">NvmeRequest</a> *&#160;</td>
          <td class="paramname"><em>req</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;{</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordflow">switch</span> (cmd-&gt;<a class="code" href="structNvmeCmd.html#a2751bc2a772082d3af81124a1d120a0c">opcode</a>) {</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="nvme_8h.html#a01e3a918ff89282c841471f5d797fbf6a13421e16e166f06ef616c86258232336">NVME_CMD_READ</a>:</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="nvme_8h.html#a01e3a918ff89282c841471f5d797fbf6af12c69a9bdf0ad418e4a144ef5424336">NVME_CMD_WRITE</a>:</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="oc12_8c.html#a62b547738c301cdf347f2ce68659c93d">oc12_nvme_rw</a>(n, ns, cmd, req);</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a8cfd84b1039b373a3cf3d86de795803f">OC12_CMD_READ</a>:</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba">oc12_read</a>(n, ns, cmd, req);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a0db13c046f3cdc7a4a59f1f3456c95c6">OC12_CMD_WRITE</a>:</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5">oc12_write</a>(n, ns, cmd, req);</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a520122b673211f2705a64edebc5f4d61">OC12_CMD_ERASE</a>:</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf">oc12_erase_async</a>(n, ns, cmd, req);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a778b8f53d6725ef86c455e2e55d46ce7">NVME_INVALID_OPCODE</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a3c41a58559ee2c92463ac4f25dab0a08_cgraph.png" border="0" usemap="#oc12_8c_a3c41a58559ee2c92463ac4f25dab0a08_cgraph" alt=""/></div>
<map name="oc12_8c_a3c41a58559ee2c92463ac4f25dab0a08_cgraph" id="oc12_8c_a3c41a58559ee2c92463ac4f25dab0a08_cgraph">
<area shape="rect" title=" " alt="" coords="5,480,112,507"/>
<area shape="rect" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf" title=" " alt="" coords="160,385,301,412"/>
<area shape="rect" href="oc12_8c.html#a62b547738c301cdf347f2ce68659c93d" title=" " alt="" coords="171,581,291,608"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="186,461,275,488"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="184,531,277,557"/>
<area shape="rect" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23" title=" " alt="" coords="367,195,530,221"/>
<area shape="rect" href="oc12_8c.html#a513d4b55522984724a7586103d0dccde" title=" " alt="" coords="349,245,548,272"/>
<area shape="rect" href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a" title=" " alt="" coords="375,397,522,424"/>
<area shape="rect" href="timing_8c.html#a1e23cd59a19d5524e59e8a130a0318ca" title=" " alt="" coords="596,195,809,221"/>
<area shape="rect" href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e" title=" " alt="" coords="608,68,797,95"/>
<area shape="rect" href="oc12_8c.html#a7c5fa0dc26c1d7334be3de1917e950f4" title=" " alt="" coords="645,144,761,171"/>
<area shape="rect" href="nand_8h.html#a8114ba8a535f9a3dba0f920bd8a3ade3" title=" " alt="" coords="862,107,1030,133"/>
<area shape="rect" href="nand_8h.html#a1df10f9cc5736ecc33431a60f6191356" title=" " alt="" coords="859,5,1033,32"/>
<area shape="rect" href="nand_8h.html#ab8913f0fbdd3cb447393cef3754be7c4" title=" " alt="" coords="857,56,1035,83"/>
<area shape="rect" href="nand_8h.html#aea24174b997828eb73fe8f0e7c83209e" title=" " alt="" coords="887,157,1005,184"/>
<area shape="rect" href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94" title=" " alt="" coords="621,296,784,323"/>
<area shape="rect" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8" title=" " alt="" coords="898,347,994,373"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="637,600,768,627"/>
<area shape="rect" href="dram_8c.html#a1ccbcf0c92b7b084afc9890f3a7e5799" title=" " alt="" coords="399,549,498,576"/>
<area shape="rect" href="dma_8c.html#a08f51254313a657c3826f77e6bd9a1b8" title=" " alt="" coords="381,651,516,677"/>
<area shape="rect" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493" title=" " alt="" coords="387,600,510,627"/>
<area shape="rect" href="oc12_8c.html#a8c8f07c03f101ab31074a64d1d430615" title=" " alt="" coords="380,448,517,475"/>
<area shape="rect" href="oc12_8c.html#ad73121a1527886888f077d49b5e599cd" title=" " alt="" coords="622,347,783,373"/>
<area shape="rect" href="oc12_8c.html#a834f283bef0c838d4b075ba5cc5405b1" title=" " alt="" coords="374,499,523,525"/>
<area shape="rect" href="oc12_8c.html#aca64e4af4809cbee3d39390041608175" title=" " alt="" coords="622,771,783,813"/>
<area shape="rect" href="oc12_8c.html#a9a3ff44ce36ff8f6abba64c35bc5dc79" title=" " alt="" coords="620,673,785,700"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a3c41a58559ee2c92463ac4f25dab0a08_icgraph.png" border="0" usemap="#oc12_8c_a3c41a58559ee2c92463ac4f25dab0a08_icgraph" alt=""/></div>
<map name="oc12_8c_a3c41a58559ee2c92463ac4f25dab0a08_icgraph" id="oc12_8c_a3c41a58559ee2c92463ac4f25dab0a08_icgraph">
<area shape="rect" title=" " alt="" coords="799,5,905,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a513d4b55522984724a7586103d0dccde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a513d4b55522984724a7586103d0dccde">&#9670;&nbsp;</a></span>oc12_meta_blk_set_erased()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_meta_blk_set_erased </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *&#160;</td>
          <td class="paramname"><em>ln</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>psl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nr_ppas</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;{</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="structOc12IdGroup.html">Oc12IdGroup</a> *c = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>.<a class="code" href="structOc12IdCtrl.html#adc341b399768a73cfc579fd4862747af">groups</a>[0];</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    uint64_t mask = 0;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    uint32_t cur_state, <a class="code" href="oc12_8h.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a> = <a class="code" href="oc12_8h.html#a627180406cdc1216617f35e42e13b256a728141cb94f3f887265095f22d0cd0b7">OC12_SEC_ERASED</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordtype">int</span> sec, pg;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">/* Disable erase state tracking due to its high computational overhead */</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> (ln-&gt;<a class="code" href="structOc12Ctrl.html#a9f385c3ce5b8f38b703b001d66bbc48f">strict</a> &amp;&amp; nr_ppas != 1) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        printf(<span class="stringliteral">&quot;_erase_meta: Erase command unfolds on device\n&quot;</span>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">int</span> pmode = <a class="code" href="oc12_8h.html#a191ef70a32f90a74e95fe996c572216ea735e25ebb849a49112ca05d70cf7c3bc">Oc12PMODE_DUAL</a>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#if 1</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">switch</span> (pmode) {     <span class="comment">// Check that pmode is supported</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#a191ef70a32f90a74e95fe996c572216ea735e25ebb849a49112ca05d70cf7c3bc">Oc12PMODE_DUAL</a>:</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a> != 2) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            printf(<span class="stringliteral">&quot;_erase_meta: Unsupported pmode(%d) for num_pln(%d)\n&quot;</span>,</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                   pmode, c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#a191ef70a32f90a74e95fe996c572216eac21b2b4101dd7304f1ba640de6ead028">Oc12PMODE_QUAD</a>:</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a> != 4) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            printf(<span class="stringliteral">&quot;_erase_meta: Unsupported pmode(%d) for num_pln(%d)\n&quot;</span>,</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                   pmode, c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="oc12_8h.html#a191ef70a32f90a74e95fe996c572216ea0ab7f30a89bd03f2cb81e3214e610db9">Oc12PMODE_SNGL</a>:</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        printf(<span class="stringliteral">&quot;_erase_meta: Unsupported pmode(%d)\n&quot;</span>, pmode);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    mask |= ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ade7c31f1d074dbbecce98d67d1219ec4">ch_mask</a>;   <span class="comment">// Construct mask</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    mask |= ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af0528b7d3f8355056e2e3c1263bbf847">lun_mask</a>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    mask |= ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ae039cd10c2f3514fbce779e08d4f2a63">blk_mask</a>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nr_ppas; ++i) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        uint64_t <a class="code" href="structppa.html">ppa</a> = psl[i];</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordtype">size_t</span> pl_bgn, pl_end;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordtype">size_t</span> pl;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">if</span> (pmode) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            pl_bgn = 0;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            pl_end = c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a> - 1;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            pl_bgn = (<a class="code" href="structppa.html">ppa</a> &amp; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a28de76535fbf770c0abd421c251cb906">pln_mask</a>) &gt;&gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af563da7e6555efe854c0f363d3d7f8cd">pln_offset</a>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            pl_end = pl_bgn;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">for</span> (pl = pl_bgn; pl &lt;= pl_end; ++pl) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="comment">//uint32_t cur_state = 0;</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            uint64_t ppa_pl;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            ppa_pl = <a class="code" href="structppa.html">ppa</a> &amp; mask;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            ppa_pl |= pl &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af563da7e6555efe854c0f363d3d7f8cd">pln_offset</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="comment">/* Check bad-block-table to error on bad blocks */</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">if</span> (ns-&gt;<a class="code" href="structNvmeNamespace.html#a95506f6c42f0b9bb0ef45bbc9d6a49be">bbtbl</a>[oc12_bbt_pos_get(ln, ppa_pl)]) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                printf(<span class="stringliteral">&quot;_erase_meta: failed -- block is bad\n&quot;</span>);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="comment">/* Check state of first sector to error on double-erase */</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94">oc12_meta_state_get</a>(ln, ppa_pl, &amp;cur_state)) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                printf(<span class="stringliteral">&quot;_erase_meta: failed: reading current state\n&quot;</span>);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <span class="keywordflow">if</span> (cur_state == <a class="code" href="oc12_8h.html#a627180406cdc1216617f35e42e13b256a728141cb94f3f887265095f22d0cd0b7">OC12_SEC_ERASED</a>) {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                printf(<span class="stringliteral">&quot;_erase_meta: failed -- already erased\n&quot;</span>);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">for</span> (pg = 0; pg &lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a197d0d5dfe7b68f1b797dd17fb3af9c5">pgs_per_blk</a>; ++pg) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                <span class="keywordflow">for</span> (sec = 0; sec &lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#abfa9dc93828353063fc768dcaf10f57f">sec_per_pg</a>; ++sec) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    uint64_t ppa_sec, off;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                    ppa_sec = <a class="code" href="structppa.html">ppa</a> &amp; mask;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                    ppa_sec |= pg &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a9f4b8857afe5ec3d69c0c88a5cf150a2">pg_offset</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    ppa_sec |= pl &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#af563da7e6555efe854c0f363d3d7f8cd">pln_offset</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                    ppa_sec |= sec &lt;&lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#ad274fcae4d9fa630a186d4640d1fdd4b">sec_offset</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                    <span class="comment">//pr_ppa(ln, ppa_sec);</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    off = <a class="code" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8">ppa2secidx</a>(ln, ppa_sec);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                    memcpy(&amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#ad73b7957a8be1fb41bff6175916f73df">meta_buf</a>[off * ln-&gt;<a class="code" href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">meta_len</a>], &amp;<a class="code" href="oc12_8h.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a>, ln-&gt;<a class="code" href="structOc12Ctrl.html#a1a9ae7fad2a49762e7fbe454212d1e45">int_meta_size</a>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a513d4b55522984724a7586103d0dccde_cgraph.png" border="0" usemap="#oc12_8c_a513d4b55522984724a7586103d0dccde_cgraph" alt=""/></div>
<map name="oc12_8c_a513d4b55522984724a7586103d0dccde_cgraph" id="oc12_8c_a513d4b55522984724a7586103d0dccde_cgraph">
<area shape="rect" title=" " alt="" coords="5,31,204,57"/>
<area shape="rect" href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94" title=" " alt="" coords="252,5,415,32"/>
<area shape="rect" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8" title=" " alt="" coords="463,31,559,57"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a513d4b55522984724a7586103d0dccde_icgraph.png" border="0" usemap="#oc12_8c_a513d4b55522984724a7586103d0dccde_icgraph" alt=""/></div>
<map name="oc12_8c_a513d4b55522984724a7586103d0dccde_icgraph" id="oc12_8c_a513d4b55522984724a7586103d0dccde_icgraph">
<area shape="rect" title=" " alt="" coords="1143,5,1341,32"/>
<area shape="rect" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf" title=" " alt="" coords="953,5,1095,32"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,5,905,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a8c8f07c03f101ab31074a64d1d430615"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c8f07c03f101ab31074a64d1d430615">&#9670;&nbsp;</a></span>oc12_meta_index()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* oc12_meta_index </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *&#160;</td>
          <td class="paramname"><em>ln</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>meta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;{</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">return</span> meta + (index * ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a>);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a8c8f07c03f101ab31074a64d1d430615_icgraph.png" border="0" usemap="#oc12_8c_a8c8f07c03f101ab31074a64d1d430615_icgraph" alt=""/></div>
<map name="oc12_8c_a8c8f07c03f101ab31074a64d1d430615_icgraph" id="oc12_8c_a8c8f07c03f101ab31074a64d1d430615_icgraph">
<area shape="rect" title=" " alt="" coords="1095,31,1232,57"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="955,5,1045,32"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="953,56,1047,83"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,31,905,57"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,31,751,57"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,31,527,57"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,31,284,57"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,31,129,57"/>
</map>
</div>

</div>
</div>
<a id="ae5be918e6cb93b49cf43fcc2c6a36d94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5be918e6cb93b49cf43fcc2c6a36d94">&#9670;&nbsp;</a></span>oc12_meta_state_get()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_meta_state_get </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *&#160;</td>
          <td class="paramname"><em>ln</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>ppa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    uint64_t sec_idx = <a class="code" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8">ppa2secidx</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    uint64_t oft = sec_idx * ln-&gt;<a class="code" href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">meta_len</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    uint8_t *tgt_sec_meta_buf = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#ad73b7957a8be1fb41bff6175916f73df">meta_buf</a>[oft];</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    assert(oft + ln-&gt;<a class="code" href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">meta_len</a> &lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#aff7d8b44a82ea05d3170d4aa2ebcc193">meta_tbytes</a>);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">/* Only need the internal oob area */</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    memcpy(<a class="code" href="oc12_8h.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a>, tgt_sec_meta_buf, ln-&gt;<a class="code" href="structOc12Ctrl.html#a1a9ae7fad2a49762e7fbe454212d1e45">int_meta_size</a>);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_ae5be918e6cb93b49cf43fcc2c6a36d94_cgraph.png" border="0" usemap="#oc12_8c_ae5be918e6cb93b49cf43fcc2c6a36d94_cgraph" alt=""/></div>
<map name="oc12_8c_ae5be918e6cb93b49cf43fcc2c6a36d94_cgraph" id="oc12_8c_ae5be918e6cb93b49cf43fcc2c6a36d94_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,168,32"/>
<area shape="rect" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8" title=" " alt="" coords="216,5,312,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_ae5be918e6cb93b49cf43fcc2c6a36d94_icgraph.png" border="0" usemap="#oc12_8c_ae5be918e6cb93b49cf43fcc2c6a36d94_icgraph" alt=""/></div>
<map name="oc12_8c_ae5be918e6cb93b49cf43fcc2c6a36d94_icgraph" id="oc12_8c_ae5be918e6cb93b49cf43fcc2c6a36d94_icgraph">
<area shape="rect" title=" " alt="" coords="1389,31,1552,57"/>
<area shape="rect" href="oc12_8c.html#a513d4b55522984724a7586103d0dccde" title=" " alt="" coords="1143,5,1341,32"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="979,56,1069,83"/>
<area shape="rect" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf" title=" " alt="" coords="953,5,1095,32"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,31,905,57"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,31,751,57"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,31,527,57"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,31,284,57"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,31,129,57"/>
</map>
</div>

</div>
</div>
<a id="aca64e4af4809cbee3d39390041608175"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca64e4af4809cbee3d39390041608175">&#9670;&nbsp;</a></span>oc12_meta_state_set_written()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_meta_state_set_written </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *&#160;</td>
          <td class="paramname"><em>ln</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>ppa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;{</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">/* The n-th sector in the flat addr space */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    uint64_t sec_idx = <a class="code" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8">ppa2secidx</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    uint64_t oft = sec_idx * ln-&gt;<a class="code" href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">meta_len</a>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    uint32_t new_state = <a class="code" href="oc12_8h.html#a627180406cdc1216617f35e42e13b256af74448337374176cd70950690b2a1ead">OC12_SEC_WRITTEN</a>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    uint8_t *tgt_sec_meta_buf = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#ad73b7957a8be1fb41bff6175916f73df">meta_buf</a>[oft];</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    assert(oft + ln-&gt;<a class="code" href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">meta_len</a> &lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#aff7d8b44a82ea05d3170d4aa2ebcc193">meta_tbytes</a>);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">/* Make sure it was not already written */</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    uint32_t cur_state = ((uint32_t *)tgt_sec_meta_buf)[0];</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span> (cur_state == <a class="code" href="oc12_8h.html#a627180406cdc1216617f35e42e13b256af74448337374176cd70950690b2a1ead">OC12_SEC_WRITTEN</a>) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;oc12_meta_state_set_written failed, already written!\n&quot;</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    memcpy(tgt_sec_meta_buf, &amp;new_state, ln-&gt;<a class="code" href="structOc12Ctrl.html#a1a9ae7fad2a49762e7fbe454212d1e45">int_meta_size</a>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aca64e4af4809cbee3d39390041608175_cgraph.png" border="0" usemap="#oc12_8c_aca64e4af4809cbee3d39390041608175_cgraph" alt=""/></div>
<map name="oc12_8c_aca64e4af4809cbee3d39390041608175_cgraph" id="oc12_8c_aca64e4af4809cbee3d39390041608175_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,167,47"/>
<area shape="rect" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8" title=" " alt="" coords="215,13,311,39"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aca64e4af4809cbee3d39390041608175_icgraph.png" border="0" usemap="#oc12_8c_aca64e4af4809cbee3d39390041608175_icgraph" alt=""/></div>
<map name="oc12_8c_aca64e4af4809cbee3d39390041608175_icgraph" id="oc12_8c_aca64e4af4809cbee3d39390041608175_icgraph">
<area shape="rect" title=" " alt="" coords="1095,5,1256,47"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="953,13,1047,39"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,13,905,39"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,13,751,39"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,13,527,39"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,13,284,39"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,13,129,39"/>
</map>
</div>

</div>
</div>
<a id="a62b547738c301cdf347f2ce68659c93d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62b547738c301cdf347f2ce68659c93d">&#9670;&nbsp;</a></span>oc12_nvme_rw()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_nvme_rw </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeRequest.html">NvmeRequest</a> *&#160;</td>
          <td class="paramname"><em>req</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;{</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="comment">/* Note: this is not the read/write path for OCSSD */</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a62b547738c301cdf347f2ce68659c93d_icgraph.png" border="0" usemap="#oc12_8c_a62b547738c301cdf347f2ce68659c93d_icgraph" alt=""/></div>
<map name="oc12_8c_a62b547738c301cdf347f2ce68659c93d_icgraph" id="oc12_8c_a62b547738c301cdf347f2ce68659c93d_icgraph">
<area shape="rect" title=" " alt="" coords="953,5,1073,32"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,5,905,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a7e3ff8c5923a54ae4b9167627877b7ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e3ff8c5923a54ae4b9167627877b7ba">&#9670;&nbsp;</a></span>oc12_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeRequest.html">NvmeRequest</a> *&#160;</td>
          <td class="paramname"><em>req</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;{</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *ocrw = (<a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *)cmd;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    uint16_t nlb  = le16_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#ab43b0d732b299b53629be5e0120f2930">nlb</a>) + 1;     <span class="comment">/* # of logical blocks */</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    uint64_t prp1 = le64_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#aa0ac0ee2111dc2dbfb5d1a7fd3aa6925">prp1</a>);        <span class="comment">/* PRP1 */</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    uint64_t prp2 = le64_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#a0b80057273b661a4f0537c5c027d7f1e">prp2</a>);        <span class="comment">/* PRP2 */</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    uint64_t meta = le64_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#a2332402af048a5dd39fd8d96c75c93a3">metadata</a>);    <span class="comment">/* OOB */</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keyword">const</span> uint8_t lbaid = <a class="code" href="nvme_8h.html#a91333268a64e669e088f20aaf0bfd9b7">NVME_ID_NS_FLBAS_INDEX</a>(ns-&gt;<a class="code" href="structNvmeNamespace.html#ac5c0ddf3fd8b71e4387062b8a5e1075d">id_ns</a>.<a class="code" href="structNvmeIdNs.html#ac2061ba91f1d2bf0282bfe22221f65a2">flbas</a>);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keyword">const</span> uint8_t lbads = <a class="code" href="nvme_8h.html#a47af6344ba88ebc43f7a48a8845b57de">NVME_ID_NS_LBAF_DS</a>(ns, lbaid);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keyword">const</span> uint16_t ms = <a class="code" href="nvme_8h.html#a06fc0c989e392cd0684a2bd82ac3b577">NVME_ID_NS_LBAF_MS</a>(ns, lbaid);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    uint64_t data_size = nlb &lt;&lt; lbads;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    uint64_t meta_size = nlb * ms;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    uint64_t *psl;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    uint64_t <a class="code" href="structppa.html">ppa</a>;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordtype">void</span> *msl;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    uint16_t err;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    req-&gt;<a class="code" href="structNvmeRequest.html#a6f04006cddb851afcc919412c6e90b60">is_write</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a> = (uint64_t)g_malloc0(<span class="keyword">sizeof</span>(uint64_t) * nlb);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">/* To save some ugly type casts later */</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    psl = (uint64_t *)req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    msl = g_malloc0(ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a> * nlb);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <a class="code" href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a">oc12_read_ppa_list</a>(n, ocrw, psl);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">/* Must come after req-&gt;slba is correctly read from the host side */</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    err = <a class="code" href="oc12_8c.html#a834f283bef0c838d4b075ba5cc5405b1">oc12_rw_check_req</a>(n, ns, cmd, req, (uint64_t *)req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>, nlb, nlb,</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                            data_size, meta_size);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> (err) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;oc12_rw: failed nvme_rw_check (0x%x)\n&quot;</span>, err);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">goto</span> fail_free;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlb; i++) {</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        uint32_t <a class="code" href="oc12_8h.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <a class="code" href="structppa.html">ppa</a> = psl[i];</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <a class="code" href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94">oc12_meta_state_get</a>(ln, <a class="code" href="structppa.html">ppa</a>, &amp;<a class="code" href="oc12_8h.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordflow">if</span> (meta) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <a class="code" href="oc12_8c.html#ad73121a1527886888f077d49b5e599cd">oc12_read_oob_meta</a>(ln, <a class="code" href="structppa.html">ppa</a>, <a class="code" href="oc12_8c.html#a8c8f07c03f101ab31074a64d1d430615">oc12_meta_index</a>(ln, msl, i));</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        psl[i] = ns-&gt;<a class="code" href="structNvmeNamespace.html#a0ed912de2d37b54d07b1f27deb7c5bb6">start_block</a> + (<a class="code" href="structppa.html">ppa</a> &lt;&lt; lbads);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">/* DMA OOB metadata back to host first */</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">if</span> (meta) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <a class="code" href="dma_8c.html#a08f51254313a657c3826f77e6bd9a1b8">nvme_addr_write</a>(n, meta, (<span class="keywordtype">void</span> *)msl, nlb * ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a>);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">/* DMA user data */</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493">nvme_map_prp</a>(&amp;req-&gt;<a class="code" href="structNvmeRequest.html#a678064f3bc45fbeb366ea44aea7273b2">qsg</a>, &amp;req-&gt;<a class="code" href="structNvmeRequest.html#a22a0c24be595ec2abed21073be01efd9">iov</a>, prp1, prp2, data_size, n)) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;oc12_read: malformed prp (sz:%lu)\n&quot;</span>, data_size);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        err = <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="keywordflow">goto</span> fail_free;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="dram_8c.html#a1ccbcf0c92b7b084afc9890f3a7e5799">backend_rw</a>(n-&gt;<a class="code" href="structFemuCtrl.html#ab4f555e0b42bfe51c089ab004c88ff48">mbe</a>, &amp;req-&gt;<a class="code" href="structNvmeRequest.html#a678064f3bc45fbeb366ea44aea7273b2">qsg</a>, psl, req-&gt;<a class="code" href="structNvmeRequest.html#a6f04006cddb851afcc919412c6e90b60">is_write</a>);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">/* Timing Model */</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23">oc12_advance_status</a>(n, ns, cmd, req);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    g_free(msl);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    g_free((<span class="keywordtype">void</span> *)req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a3268f6be90861f0c2270d86a44d5b09c">NVME_SUCCESS</a>;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;fail_free:</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    g_free(msl);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    g_free((<span class="keywordtype">void</span> *)req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a7e3ff8c5923a54ae4b9167627877b7ba_cgraph.png" border="0" usemap="#oc12_8c_a7e3ff8c5923a54ae4b9167627877b7ba_cgraph" alt=""/></div>
<map name="oc12_8c_a7e3ff8c5923a54ae4b9167627877b7ba_cgraph" id="oc12_8c_a7e3ff8c5923a54ae4b9167627877b7ba_cgraph">
<area shape="rect" title=" " alt="" coords="5,245,95,272"/>
<area shape="rect" href="dram_8c.html#a1ccbcf0c92b7b084afc9890f3a7e5799" title=" " alt="" coords="175,43,273,69"/>
<area shape="rect" href="dma_8c.html#a08f51254313a657c3826f77e6bd9a1b8" title=" " alt="" coords="157,93,291,120"/>
<area shape="rect" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493" title=" " alt="" coords="163,195,285,221"/>
<area shape="rect" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23" title=" " alt="" coords="143,144,305,171"/>
<area shape="rect" href="oc12_8c.html#a8c8f07c03f101ab31074a64d1d430615" title=" " alt="" coords="155,245,293,272"/>
<area shape="rect" href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94" title=" " alt="" coords="143,347,305,373"/>
<area shape="rect" href="oc12_8c.html#ad73121a1527886888f077d49b5e599cd" title=" " alt="" coords="143,397,305,424"/>
<area shape="rect" href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a" title=" " alt="" coords="151,296,297,323"/>
<area shape="rect" href="oc12_8c.html#a834f283bef0c838d4b075ba5cc5405b1" title=" " alt="" coords="149,448,299,475"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="395,271,525,297"/>
<area shape="rect" href="timing_8c.html#a1e23cd59a19d5524e59e8a130a0318ca" title=" " alt="" coords="353,195,567,221"/>
<area shape="rect" href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e" title=" " alt="" coords="365,68,555,95"/>
<area shape="rect" href="oc12_8c.html#a7c5fa0dc26c1d7334be3de1917e950f4" title=" " alt="" coords="402,144,518,171"/>
<area shape="rect" href="nand_8h.html#a8114ba8a535f9a3dba0f920bd8a3ade3" title=" " alt="" coords="619,56,787,83"/>
<area shape="rect" href="nand_8h.html#a1df10f9cc5736ecc33431a60f6191356" title=" " alt="" coords="617,107,790,133"/>
<area shape="rect" href="nand_8h.html#ab8913f0fbdd3cb447393cef3754be7c4" title=" " alt="" coords="615,5,792,32"/>
<area shape="rect" href="nand_8h.html#aea24174b997828eb73fe8f0e7c83209e" title=" " alt="" coords="644,157,763,184"/>
<area shape="rect" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8" title=" " alt="" coords="412,372,508,399"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a7e3ff8c5923a54ae4b9167627877b7ba_icgraph.png" border="0" usemap="#oc12_8c_a7e3ff8c5923a54ae4b9167627877b7ba_icgraph" alt=""/></div>
<map name="oc12_8c_a7e3ff8c5923a54ae4b9167627877b7ba_icgraph" id="oc12_8c_a7e3ff8c5923a54ae4b9167627877b7ba_icgraph">
<area shape="rect" title=" " alt="" coords="953,5,1043,32"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,5,905,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="ad73121a1527886888f077d49b5e599cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad73121a1527886888f077d49b5e599cd">&#9670;&nbsp;</a></span>oc12_read_oob_meta()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_read_oob_meta </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *&#160;</td>
          <td class="paramname"><em>ln</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>ppa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>meta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    uint64_t sec_idx = <a class="code" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8">ppa2secidx</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    uint64_t oft = sec_idx * ln-&gt;<a class="code" href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">meta_len</a> + ln-&gt;<a class="code" href="structOc12Ctrl.html#a1a9ae7fad2a49762e7fbe454212d1e45">int_meta_size</a>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    uint8_t *tgt_sos_meta_buf = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#ad73b7957a8be1fb41bff6175916f73df">meta_buf</a>[oft];</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    assert(oft + ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a> &lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#aff7d8b44a82ea05d3170d4aa2ebcc193">meta_tbytes</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    memcpy(meta, tgt_sos_meta_buf, ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_ad73121a1527886888f077d49b5e599cd_cgraph.png" border="0" usemap="#oc12_8c_ad73121a1527886888f077d49b5e599cd_cgraph" alt=""/></div>
<map name="oc12_8c_ad73121a1527886888f077d49b5e599cd_cgraph" id="oc12_8c_ad73121a1527886888f077d49b5e599cd_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,167,32"/>
<area shape="rect" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8" title=" " alt="" coords="215,5,311,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_ad73121a1527886888f077d49b5e599cd_icgraph.png" border="0" usemap="#oc12_8c_ad73121a1527886888f077d49b5e599cd_icgraph" alt=""/></div>
<map name="oc12_8c_ad73121a1527886888f077d49b5e599cd_icgraph" id="oc12_8c_ad73121a1527886888f077d49b5e599cd_icgraph">
<area shape="rect" title=" " alt="" coords="1091,5,1252,32"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="953,5,1043,32"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,5,905,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="ad73b76922bf7b9ecd50de33ff112412a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad73b76922bf7b9ecd50de33ff112412a">&#9670;&nbsp;</a></span>oc12_read_ppa_list()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void oc12_read_ppa_list </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOc12RwCmd.html">Oc12RwCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>ppa_list</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;{</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    uint64_t spba = le64_to_cpu(cmd-&gt;<a class="code" href="structOc12RwCmd.html#a24e2d0a72fbd34f3e31c0febf46c114d">spba</a>);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    uint32_t nlb = le16_to_cpu(cmd-&gt;<a class="code" href="structOc12RwCmd.html#ab43b0d732b299b53629be5e0120f2930">nlb</a>) + 1;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span> (nlb &gt; 1) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <a class="code" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484">nvme_addr_read</a>(n, spba, (<span class="keywordtype">void</span> *)ppa_list, nlb * <span class="keyword">sizeof</span>(uint64_t));</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        ppa_list[0] = spba;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_ad73b76922bf7b9ecd50de33ff112412a_cgraph.png" border="0" usemap="#oc12_8c_ad73b76922bf7b9ecd50de33ff112412a_cgraph" alt=""/></div>
<map name="oc12_8c_ad73b76922bf7b9ecd50de33ff112412a_cgraph" id="oc12_8c_ad73b76922bf7b9ecd50de33ff112412a_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,152,32"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="200,5,331,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_ad73b76922bf7b9ecd50de33ff112412a_icgraph.png" border="0" usemap="#oc12_8c_ad73b76922bf7b9ecd50de33ff112412a_icgraph" alt=""/></div>
<map name="oc12_8c_ad73b76922bf7b9ecd50de33ff112412a_icgraph" id="oc12_8c_ad73b76922bf7b9ecd50de33ff112412a_icgraph">
<area shape="rect" title=" " alt="" coords="1143,56,1289,83"/>
<area shape="rect" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf" title=" " alt="" coords="953,5,1095,32"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="979,56,1069,83"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="977,107,1071,133"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,56,905,83"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,56,751,83"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,56,527,83"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,56,284,83"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,56,129,83"/>
</map>
</div>

</div>
</div>
<a id="a9c3bc08fae8d78b595c291eee88526ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c3bc08fae8d78b595c291eee88526ad">&#9670;&nbsp;</a></span>oc12_read_tbls()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_read_tbls </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;{</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; n-&gt;<a class="code" href="structFemuCtrl.html#a8bd3f2107e1a59779f7d6a669e29b5af">num_namespaces</a>; i++) {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <a class="code" href="structNvmeNamespace.html">NvmeNamespace</a> *ns = &amp;n-&gt;<a class="code" href="structFemuCtrl.html#a98ca6ff3bc65ccc7f98a589e018b7d71">namespaces</a>[i];</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        uint32_t tbl_size = <a class="code" href="oc12_8c.html#aee96b1d201c8c59efdcf0ca09c94ae69">oc12_tbl_size</a>(ns);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <a class="code" href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a>(<span class="stringliteral">&quot;tbl_size=%d\n&quot;</span>, tbl_size);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        assert(tbl_size);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a9c3bc08fae8d78b595c291eee88526ad_cgraph.png" border="0" usemap="#oc12_8c_a9c3bc08fae8d78b595c291eee88526ad_cgraph" alt=""/></div>
<map name="oc12_8c_a9c3bc08fae8d78b595c291eee88526ad_cgraph" id="oc12_8c_a9c3bc08fae8d78b595c291eee88526ad_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,125,32"/>
<area shape="rect" href="oc12_8c.html#aee96b1d201c8c59efdcf0ca09c94ae69" title=" " alt="" coords="173,5,284,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a9c3bc08fae8d78b595c291eee88526ad_icgraph.png" border="0" usemap="#oc12_8c_a9c3bc08fae8d78b595c291eee88526ad_icgraph" alt=""/></div>
<map name="oc12_8c_a9c3bc08fae8d78b595c291eee88526ad_icgraph" id="oc12_8c_a9c3bc08fae8d78b595c291eee88526ad_icgraph">
<area shape="rect" title=" " alt="" coords="1099,5,1219,32"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a42a412e9ba005df6611a73cfbb61ed85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42a412e9ba005df6611a73cfbb61ed85">&#9670;&nbsp;</a></span>oc12_release_locks()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void oc12_release_locks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;{</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="nvme_8h.html#ad687b13a8721e862fd66459c865669e6">FEMU_MAX_NUM_CHNLS</a>; i++) {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        ret = pthread_spin_destroy(&amp;n-&gt;<a class="code" href="structFemuCtrl.html#a0e1b916dcb45d831a416bd84da70d25d">chnl_locks</a>[i]);</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        assert(ret == 0);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="nvme_8h.html#aa099d68673fc69a8ebeeffc9b00a06d1">FEMU_MAX_NUM_CHIPS</a>; i++) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        ret = pthread_spin_destroy(&amp;n-&gt;<a class="code" href="structFemuCtrl.html#a48cf26e3440955b976f0b77c8677c15c">chip_locks</a>[i]);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        assert(ret == 0);</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a42a412e9ba005df6611a73cfbb61ed85_icgraph.png" border="0" usemap="#oc12_8c_a42a412e9ba005df6611a73cfbb61ed85_icgraph" alt=""/></div>
<map name="oc12_8c_a42a412e9ba005df6611a73cfbb61ed85_icgraph" id="oc12_8c_a42a412e9ba005df6611a73cfbb61ed85_icgraph">
<area shape="rect" title=" " alt="" coords="932,5,1081,32"/>
<area shape="rect" href="oc12_8c.html#adb2f63023ff079bd918f3e0a2fc99c0a" title=" " alt="" coords="799,5,884,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a834f283bef0c838d4b075ba5cc5405b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a834f283bef0c838d4b075ba5cc5405b1">&#9670;&nbsp;</a></span>oc12_rw_check_req()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_rw_check_req </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeRequest.html">NvmeRequest</a> *&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>psl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nr_pages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nlb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>data_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>meta_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;{</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *ocrw = (<a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *)cmd;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    uint64_t spba = le64_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#a24e2d0a72fbd34f3e31c0febf46c114d">spba</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    uint64_t slba = psl[0];</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    uint64_t elba = psl[nr_pages-1];</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    uint16_t is_write = (ocrw-&gt;<a class="code" href="structOc12RwCmd.html#a0489f3cd5053aaea3eb7fd83d9958122">opcode</a> == <a class="code" href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a0db13c046f3cdc7a4a59f1f3456c95c6">OC12_CMD_WRITE</a>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    assert(nr_pages == nlb);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (nlb &gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a7a9dd0f60d13cd9027ee190ee1e98ef9">max_sec_per_rq</a>) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;oc12_rw: npages too large (%u). Max:%u supported\n&quot;</span>, nlb,</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                 ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a7a9dd0f60d13cd9027ee190ee1e98ef9">max_sec_per_rq</a>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> ((is_write) &amp;&amp; (nlb &lt; ln-&gt;params.sec_per_pl)) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;oc12_rw: I/O does not respect device write constrains.&quot;</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                 <span class="stringliteral">&quot;Sectors send: (%u). Min:%u sectors required\n&quot;</span>, nlb,</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                 ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a866dde01820d32a23b0ab6c74b11ff0d">sec_per_pl</a>);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span> (spba == <a class="code" href="oc12_8h.html#ace152beca8789cab7f1e29d970ce8266">OC12_PBA_UNMAPPED</a>) {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;oc12_rw: unmapped PBA\n&quot;</span>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nr_pages; i++) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="keywordflow">if</span> (psl[i] &gt; le64_to_cpu(ns-&gt;<a class="code" href="structNvmeNamespace.html#ac5c0ddf3fd8b71e4387062b8a5e1075d">id_ns</a>.<a class="code" href="structNvmeIdNs.html#a4a814e395ae6ea7b3b7c5cba1c22ad85">nsze</a>)) {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a43aae0e0a370dd16186369148885344f">NVME_LBA_RANGE</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">if</span> (n-&gt;<a class="code" href="structFemuCtrl.html#af13a4a3fc3667cdddbd181c34378b406">id_ctrl</a>.<a class="code" href="structNvmeIdCtrl.html#a7aa6155f605fdb78fab28db981e0c5c4">mdts</a> &amp;&amp; data_size &gt; n-&gt;<a class="code" href="structFemuCtrl.html#a6d0418e38e888b2b8980a34198bfd463">page_size</a> * (1 &lt;&lt; n-&gt;<a class="code" href="structFemuCtrl.html#af13a4a3fc3667cdddbd181c34378b406">id_ctrl</a>.<a class="code" href="structNvmeIdCtrl.html#a7aa6155f605fdb78fab28db981e0c5c4">mdts</a>)) {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span> (meta_size) {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (!req-&gt;<a class="code" href="structNvmeRequest.html#a6f04006cddb851afcc919412c6e90b60">is_write</a> &amp;&amp; find_next_bit(ns-&gt;<a class="code" href="structNvmeNamespace.html#a82fb6235b209c097c887181151ad33a1">uncorrectable</a>, elba, slba) &lt; elba) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a5157ff55aedb970b020e6602903bd46a">NVME_UNRECOVERED_READ</a>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a834f283bef0c838d4b075ba5cc5405b1_icgraph.png" border="0" usemap="#oc12_8c_a834f283bef0c838d4b075ba5cc5405b1_icgraph" alt=""/></div>
<map name="oc12_8c_a834f283bef0c838d4b075ba5cc5405b1_icgraph" id="oc12_8c_a834f283bef0c838d4b075ba5cc5405b1_icgraph">
<area shape="rect" title=" " alt="" coords="1095,31,1244,57"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="955,5,1045,32"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="953,56,1047,83"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,31,905,57"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,31,751,57"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,31,527,57"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,31,284,57"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,31,129,57"/>
</map>
</div>

</div>
</div>
<a id="aef55b0e79dd4659d66fc1d7d83b3a88a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef55b0e79dd4659d66fc1d7d83b3a88a">&#9670;&nbsp;</a></span>oc12_set_ctrl_str()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void oc12_set_ctrl_str </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;{</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> fsid_voc12 = 0;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *vocssd12_mn = <span class="stringliteral">&quot;FEMU OpenChannel-SSD Controller (v1.2)&quot;</span>;</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *vocssd12_sn   = <span class="stringliteral">&quot;vOCSSD&quot;</span>;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160; </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <a class="code" href="nvme-util_8c.html#a9e84e8328646dcb1f24be9c79018e6a0">nvme_set_ctrl_name</a>(n, vocssd12_mn, vocssd12_sn, &amp;fsid_voc12);</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aef55b0e79dd4659d66fc1d7d83b3a88a_cgraph.png" border="0" usemap="#oc12_8c_aef55b0e79dd4659d66fc1d7d83b3a88a_cgraph" alt=""/></div>
<map name="oc12_8c_aef55b0e79dd4659d66fc1d7d83b3a88a_cgraph" id="oc12_8c_aef55b0e79dd4659d66fc1d7d83b3a88a_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,137,32"/>
<area shape="rect" href="nvme-util_8c.html#a9e84e8328646dcb1f24be9c79018e6a0" title=" " alt="" coords="185,5,344,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aef55b0e79dd4659d66fc1d7d83b3a88a_icgraph.png" border="0" usemap="#oc12_8c_aef55b0e79dd4659d66fc1d7d83b3a88a_icgraph" alt=""/></div>
<map name="oc12_8c_aef55b0e79dd4659d66fc1d7d83b3a88a_icgraph" id="oc12_8c_aef55b0e79dd4659d66fc1d7d83b3a88a_icgraph">
<area shape="rect" title=" " alt="" coords="928,5,1060,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a36ce2e77da3b587fd610f820a2613ca1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36ce2e77da3b587fd610f820a2613ca1">&#9670;&nbsp;</a></span>oc12_tbl_initialize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void oc12_tbl_initialize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;{</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    uint32_t len = ns-&gt;<a class="code" href="structNvmeNamespace.html#add3b0adcb1ba29178ccd71caff85b8a0">tbl_entries</a>;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; len; i++) {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        ns-&gt;<a class="code" href="structNvmeNamespace.html#a0e6565e5bda500bf95530011731823c2">tbl</a>[i] = <a class="code" href="oc12_8h.html#a8008c35ea603710c25e24d36be6a9784">OC12_LBA_UNMAPPED</a>;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    }</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a36ce2e77da3b587fd610f820a2613ca1_icgraph.png" border="0" usemap="#oc12_8c_a36ce2e77da3b587fd610f820a2613ca1_icgraph" alt=""/></div>
<map name="oc12_8c_a36ce2e77da3b587fd610f820a2613ca1_icgraph" id="oc12_8c_a36ce2e77da3b587fd610f820a2613ca1_icgraph">
<area shape="rect" title=" " alt="" coords="1099,5,1239,32"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="aee96b1d201c8c59efdcf0ca09c94ae69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee96b1d201c8c59efdcf0ca09c94ae69">&#9670;&nbsp;</a></span>oc12_tbl_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t oc12_tbl_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;{</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">return</span> ns-&gt;<a class="code" href="structNvmeNamespace.html#add3b0adcb1ba29178ccd71caff85b8a0">tbl_entries</a> * <span class="keyword">sizeof</span>(*(ns-&gt;<a class="code" href="structNvmeNamespace.html#a0e6565e5bda500bf95530011731823c2">tbl</a>));</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_aee96b1d201c8c59efdcf0ca09c94ae69_icgraph.png" border="0" usemap="#oc12_8c_aee96b1d201c8c59efdcf0ca09c94ae69_icgraph" alt=""/></div>
<map name="oc12_8c_aee96b1d201c8c59efdcf0ca09c94ae69_icgraph" id="oc12_8c_aee96b1d201c8c59efdcf0ca09c94ae69_icgraph">
<area shape="rect" title=" " alt="" coords="1267,5,1377,32"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a9c3bc08fae8d78b595c291eee88526ad" title=" " alt="" coords="1099,31,1219,57"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="af8b73b03b7edcdc1740a24b053ce72a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8b73b03b7edcdc1740a24b053ce72a5">&#9670;&nbsp;</a></span>oc12_write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint16_t oc12_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeRequest.html">NvmeRequest</a> *&#160;</td>
          <td class="paramname"><em>req</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;{</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *ocrw = (<a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *)cmd;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    uint16_t nlb  = le16_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#ab43b0d732b299b53629be5e0120f2930">nlb</a>) + 1;     <span class="comment">/* # of logical blocks */</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    uint64_t prp1 = le64_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#aa0ac0ee2111dc2dbfb5d1a7fd3aa6925">prp1</a>);        <span class="comment">/* PRP1 */</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    uint64_t prp2 = le64_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#a0b80057273b661a4f0537c5c027d7f1e">prp2</a>);        <span class="comment">/* PRP2 */</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    uint64_t meta = le64_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#a2332402af048a5dd39fd8d96c75c93a3">metadata</a>);    <span class="comment">/* OOB */</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keyword">const</span> uint8_t lbaid = <a class="code" href="nvme_8h.html#a91333268a64e669e088f20aaf0bfd9b7">NVME_ID_NS_FLBAS_INDEX</a>(ns-&gt;<a class="code" href="structNvmeNamespace.html#ac5c0ddf3fd8b71e4387062b8a5e1075d">id_ns</a>.<a class="code" href="structNvmeIdNs.html#ac2061ba91f1d2bf0282bfe22221f65a2">flbas</a>);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keyword">const</span> uint8_t lbads = <a class="code" href="nvme_8h.html#a47af6344ba88ebc43f7a48a8845b57de">NVME_ID_NS_LBAF_DS</a>(ns, lbaid);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keyword">const</span> uint16_t ms = <a class="code" href="nvme_8h.html#a06fc0c989e392cd0684a2bd82ac3b577">NVME_ID_NS_LBAF_MS</a>(ns, lbaid);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    uint64_t data_size = nlb &lt;&lt; lbads;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    uint64_t meta_size = nlb * ms;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    uint64_t *psl;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    uint64_t <a class="code" href="structppa.html">ppa</a>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordtype">void</span> *msl;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    uint16_t err;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    req-&gt;<a class="code" href="structNvmeRequest.html#a6f04006cddb851afcc919412c6e90b60">is_write</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a> = (uint64_t)g_malloc0(<span class="keyword">sizeof</span>(uint64_t) * nlb);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    psl = (uint64_t *)req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    msl = g_malloc0(ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a> * nlb);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <a class="code" href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a">oc12_read_ppa_list</a>(n, ocrw, psl);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">/* Must come after req-&gt;slba is correctly read from the host side */</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    err = <a class="code" href="oc12_8c.html#a834f283bef0c838d4b075ba5cc5405b1">oc12_rw_check_req</a>(n, ns, cmd, req, psl, nlb, nlb, data_size,</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                            meta_size);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">if</span> (err) {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;oc12_write: failed nvme_rw_check (0x%x)\n&quot;</span>, err);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">goto</span> fail_free;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">/* Read host-passed metadata to a temporary buffer */</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (meta) {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <a class="code" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484">nvme_addr_read</a>(n, meta, (<span class="keywordtype">void</span> *)msl, nlb * ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a>);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160; </div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlb; i++) {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <a class="code" href="structppa.html">ppa</a> = psl[i];</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <a class="code" href="oc12_8c.html#aca64e4af4809cbee3d39390041608175">oc12_meta_state_set_written</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">if</span> (meta) {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <a class="code" href="oc12_8c.html#a9a3ff44ce36ff8f6abba64c35bc5dc79">oc12_write_oob_meta</a>(ln, <a class="code" href="structppa.html">ppa</a>, <a class="code" href="oc12_8c.html#a8c8f07c03f101ab31074a64d1d430615">oc12_meta_index</a>(ln, msl, i));</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        psl[i] = ns-&gt;<a class="code" href="structNvmeNamespace.html#a0ed912de2d37b54d07b1f27deb7c5bb6">start_block</a> + (<a class="code" href="structppa.html">ppa</a> &lt;&lt; lbads);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="comment">/* DMA OOB metadata back to host first */</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">if</span> (meta) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <a class="code" href="dma_8c.html#a08f51254313a657c3826f77e6bd9a1b8">nvme_addr_write</a>(n, meta, (<span class="keywordtype">void</span> *)msl, nlb * ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a>);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">/* DMA user data */</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493">nvme_map_prp</a>(&amp;req-&gt;<a class="code" href="structNvmeRequest.html#a678064f3bc45fbeb366ea44aea7273b2">qsg</a>, &amp;req-&gt;<a class="code" href="structNvmeRequest.html#a22a0c24be595ec2abed21073be01efd9">iov</a>, prp1, prp2, data_size, n)) {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;oc12_write: malformed prp (sz:%lu)\n&quot;</span>, data_size);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        err = <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a> | <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a>;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">goto</span> fail_free;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <a class="code" href="dram_8c.html#a1ccbcf0c92b7b084afc9890f3a7e5799">backend_rw</a>(n-&gt;<a class="code" href="structFemuCtrl.html#ab4f555e0b42bfe51c089ab004c88ff48">mbe</a>, &amp;req-&gt;<a class="code" href="structNvmeRequest.html#a678064f3bc45fbeb366ea44aea7273b2">qsg</a>, psl, req-&gt;<a class="code" href="structNvmeRequest.html#a6f04006cddb851afcc919412c6e90b60">is_write</a>);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">/* Timing Model */</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23">oc12_advance_status</a>(n, ns, cmd, req);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    g_free(msl);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    g_free((<span class="keywordtype">void</span> *)req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a3268f6be90861f0c2270d86a44d5b09c">NVME_SUCCESS</a>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;fail_free:</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    g_free(msl);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    g_free((<span class="keywordtype">void</span> *)req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_af8b73b03b7edcdc1740a24b053ce72a5_cgraph.png" border="0" usemap="#oc12_8c_af8b73b03b7edcdc1740a24b053ce72a5_cgraph" alt=""/></div>
<map name="oc12_8c_af8b73b03b7edcdc1740a24b053ce72a5_cgraph" id="oc12_8c_af8b73b03b7edcdc1740a24b053ce72a5_cgraph">
<area shape="rect" title=" " alt="" coords="5,233,99,260"/>
<area shape="rect" href="dram_8c.html#a1ccbcf0c92b7b084afc9890f3a7e5799" title=" " alt="" coords="180,5,279,32"/>
<area shape="rect" href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484" title=" " alt="" coords="401,157,532,184"/>
<area shape="rect" href="dma_8c.html#a08f51254313a657c3826f77e6bd9a1b8" title=" " alt="" coords="162,107,297,133"/>
<area shape="rect" href="dma_8c.html#aff05c76845a6cc08d0131d2761153493" title=" " alt="" coords="168,208,291,235"/>
<area shape="rect" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23" title=" " alt="" coords="148,309,311,336"/>
<area shape="rect" href="oc12_8c.html#a8c8f07c03f101ab31074a64d1d430615" title=" " alt="" coords="161,259,298,285"/>
<area shape="rect" href="oc12_8c.html#aca64e4af4809cbee3d39390041608175" title=" " alt="" coords="149,361,310,402"/>
<area shape="rect" href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a" title=" " alt="" coords="156,56,303,83"/>
<area shape="rect" href="oc12_8c.html#a834f283bef0c838d4b075ba5cc5405b1" title=" " alt="" coords="155,427,304,453"/>
<area shape="rect" href="oc12_8c.html#a9a3ff44ce36ff8f6abba64c35bc5dc79" title=" " alt="" coords="147,477,312,504"/>
<area shape="rect" href="timing_8c.html#a1e23cd59a19d5524e59e8a130a0318ca" title=" " alt="" coords="360,360,573,387"/>
<area shape="rect" href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e" title=" " alt="" coords="372,233,561,260"/>
<area shape="rect" href="oc12_8c.html#a7c5fa0dc26c1d7334be3de1917e950f4" title=" " alt="" coords="409,309,525,336"/>
<area shape="rect" href="nand_8h.html#a8114ba8a535f9a3dba0f920bd8a3ade3" title=" " alt="" coords="626,221,794,248"/>
<area shape="rect" href="nand_8h.html#a1df10f9cc5736ecc33431a60f6191356" title=" " alt="" coords="623,272,797,299"/>
<area shape="rect" href="nand_8h.html#ab8913f0fbdd3cb447393cef3754be7c4" title=" " alt="" coords="621,171,799,197"/>
<area shape="rect" href="nand_8h.html#aea24174b997828eb73fe8f0e7c83209e" title=" " alt="" coords="651,323,769,349"/>
<area shape="rect" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8" title=" " alt="" coords="419,444,515,471"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_af8b73b03b7edcdc1740a24b053ce72a5_icgraph.png" border="0" usemap="#oc12_8c_af8b73b03b7edcdc1740a24b053ce72a5_icgraph" alt=""/></div>
<map name="oc12_8c_af8b73b03b7edcdc1740a24b053ce72a5_icgraph" id="oc12_8c_af8b73b03b7edcdc1740a24b053ce72a5_icgraph">
<area shape="rect" title=" " alt="" coords="953,5,1047,32"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,5,905,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a9a3ff44ce36ff8f6abba64c35bc5dc79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a3ff44ce36ff8f6abba64c35bc5dc79">&#9670;&nbsp;</a></span>oc12_write_oob_meta()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int oc12_write_oob_meta </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *&#160;</td>
          <td class="paramname"><em>ln</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>ppa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>meta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;{</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    uint64_t sec_idx = <a class="code" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8">ppa2secidx</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    uint64_t oft = sec_idx * ln-&gt;<a class="code" href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">meta_len</a> + ln-&gt;<a class="code" href="structOc12Ctrl.html#a1a9ae7fad2a49762e7fbe454212d1e45">int_meta_size</a>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    uint8_t *tgt_sos_meta_buf = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#ad73b7957a8be1fb41bff6175916f73df">meta_buf</a>[oft];</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    assert(oft + ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a> &lt; ln-&gt;<a class="code" href="structOc12Ctrl.html#aff7d8b44a82ea05d3170d4aa2ebcc193">meta_tbytes</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    memcpy(tgt_sos_meta_buf, meta, ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">sos</a>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a9a3ff44ce36ff8f6abba64c35bc5dc79_cgraph.png" border="0" usemap="#oc12_8c_a9a3ff44ce36ff8f6abba64c35bc5dc79_cgraph" alt=""/></div>
<map name="oc12_8c_a9a3ff44ce36ff8f6abba64c35bc5dc79_cgraph" id="oc12_8c_a9a3ff44ce36ff8f6abba64c35bc5dc79_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,171,32"/>
<area shape="rect" href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8" title=" " alt="" coords="219,5,315,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a9a3ff44ce36ff8f6abba64c35bc5dc79_icgraph.png" border="0" usemap="#oc12_8c_a9a3ff44ce36ff8f6abba64c35bc5dc79_icgraph" alt=""/></div>
<map name="oc12_8c_a9a3ff44ce36ff8f6abba64c35bc5dc79_icgraph" id="oc12_8c_a9a3ff44ce36ff8f6abba64c35bc5dc79_icgraph">
<area shape="rect" title=" " alt="" coords="1095,5,1260,32"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="953,5,1047,32"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,5,905,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
<a id="a7c5fa0dc26c1d7334be3de1917e950f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c5fa0dc26c1d7334be3de1917e950f4">&#9670;&nbsp;</a></span>parse_ppa_list()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void parse_ppa_list </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structFemuCtrl.html">FemuCtrl</a> *&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeNamespace.html">NvmeNamespace</a> *&#160;</td>
          <td class="paramname"><em>ns</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeCmd.html">NvmeCmd</a> *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNvmeRequest.html">NvmeRequest</a> *&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structAddrBucket.html">AddrBucket</a> *&#160;</td>
          <td class="paramname"><em>bucket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>nr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;{</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *ocrw = (<a class="code" href="structOc12RwCmd.html">Oc12RwCmd</a> *)cmd;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="structOc12Ctrl.html">Oc12Ctrl</a> *ln = n-&gt;<a class="code" href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">oc12_ctrl</a>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    uint16_t nlb  = le16_to_cpu(ocrw-&gt;<a class="code" href="structOc12RwCmd.html#ab43b0d732b299b53629be5e0120f2930">nlb</a>) + 1;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordtype">int</span> max_sec_per_rq = ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a7a9dd0f60d13cd9027ee190ee1e98ef9">max_sec_per_rq</a>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    uint64_t cur_pg_addr, prev_pg_addr = ~(0ULL);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordtype">int</span> secs_idx = -1;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    uint64_t <a class="code" href="structppa.html">ppa</a>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    memset(bucket, 0, <span class="keyword">sizeof</span>(<a class="code" href="structAddrBucket.html">AddrBucket</a>) * max_sec_per_rq);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nlb; i++) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <a class="code" href="structppa.html">ppa</a> = ((uint64_t *)(req-&gt;<a class="code" href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">slba</a>))[i];</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="comment">//pr_ppa(ln, ppa);</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        cur_pg_addr = (<a class="code" href="structppa.html">ppa</a> &amp; (~(ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a2e4f8916fc739ff8d205e6bcdeaf9a48">sec_mask</a>)) &amp; (~(ln-&gt;<a class="code" href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">ppaf</a>.<a class="code" href="structOc12AddrF.html#a28de76535fbf770c0abd421c251cb906">pln_mask</a>)));</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">if</span> (cur_pg_addr == prev_pg_addr) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="comment">/* Accessing another secotr in the same NAND page */</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            bucket[secs_idx].<a class="code" href="structAddrBucket.html#a61e6c99a9e481a5f5f5fd3916a933c9e">cnt</a>++;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="comment">/* Accessing a new NAND page addr */</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            secs_idx++;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            bucket[secs_idx].<a class="code" href="structAddrBucket.html#a61e6c99a9e481a5f5f5fd3916a933c9e">cnt</a>++;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            bucket[secs_idx].<a class="code" href="structAddrBucket.html#a20d14f13630952d9600c045a6d9ce329">ch</a> = <a class="code" href="nand_8h.html#adfbaba29b1f26d638ba0358de7aec107">PPA_CH</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            bucket[secs_idx].<a class="code" href="structAddrBucket.html#a8ad87aa0dffdeb38c21341e2e869a957">lun</a> = <a class="code" href="nand_8h.html#a61ca2e3531ba78a2d7f62cb9c077dbec">PPA_LUN</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            bucket[secs_idx].<a class="code" href="structAddrBucket.html#a605c129d45ea08a49ad1cb3acea6340f">pg</a> = <a class="code" href="nand_8h.html#a277eb77cc9a0d195f464a357430de968">PPA_PG</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            bucket[secs_idx].<a class="code" href="structAddrBucket.html#a6067622337a90fb397b788a17d540af4">page_type</a> = <a class="code" href="nand_8h.html#aea24174b997828eb73fe8f0e7c83209e">get_page_type</a>(n-&gt;<a class="code" href="structFemuCtrl.html#a1134e53459a8a70ec5615d1881b26b47">flash_type</a>, bucket[secs_idx].pg);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            prev_pg_addr = cur_pg_addr;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    *nr = secs_idx + 1;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
函数调用图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a7c5fa0dc26c1d7334be3de1917e950f4_cgraph.png" border="0" usemap="#oc12_8c_a7c5fa0dc26c1d7334be3de1917e950f4_cgraph" alt=""/></div>
<map name="oc12_8c_a7c5fa0dc26c1d7334be3de1917e950f4_cgraph" id="oc12_8c_a7c5fa0dc26c1d7334be3de1917e950f4_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,121,32"/>
<area shape="rect" href="nand_8h.html#aea24174b997828eb73fe8f0e7c83209e" title=" " alt="" coords="169,5,288,32"/>
</map>
</div>
<div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a7c5fa0dc26c1d7334be3de1917e950f4_icgraph.png" border="0" usemap="#oc12_8c_a7c5fa0dc26c1d7334be3de1917e950f4_icgraph" alt=""/></div>
<map name="oc12_8c_a7c5fa0dc26c1d7334be3de1917e950f4_icgraph" id="oc12_8c_a7c5fa0dc26c1d7334be3de1917e950f4_icgraph">
<area shape="rect" title=" " alt="" coords="1353,56,1469,83"/>
<area shape="rect" href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23" title=" " alt="" coords="1143,56,1305,83"/>
<area shape="rect" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf" title=" " alt="" coords="953,5,1095,32"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="979,56,1069,83"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="977,107,1071,133"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,56,905,83"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,56,751,83"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,56,527,83"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,56,284,83"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,56,129,83"/>
</map>
</div>

</div>
</div>
<a id="a968e2bafefcfab11d1e90df7bc2284a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a968e2bafefcfab11d1e90df7bc2284a8">&#9670;&nbsp;</a></span>ppa2secidx()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t ppa2secidx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structOc12Ctrl.html">Oc12Ctrl</a> *&#160;</td>
          <td class="paramname"><em>ln</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>ppa</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;{</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <a class="code" href="structOc12IdGroup.html">Oc12IdGroup</a> *c = &amp;ln-&gt;<a class="code" href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">id_ctrl</a>.<a class="code" href="structOc12IdCtrl.html#adc341b399768a73cfc579fd4862747af">groups</a>[0];</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    uint64_t ch, lun, pln, blk, pg, sec;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    uint64_t r;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    ch  = <a class="code" href="nand_8h.html#adfbaba29b1f26d638ba0358de7aec107">PPA_CH</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    lun = <a class="code" href="nand_8h.html#a61ca2e3531ba78a2d7f62cb9c077dbec">PPA_LUN</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    pln = <a class="code" href="nand_8h.html#a1d76007eb272ea57874f05dc798f9d99">PPA_PLN</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    blk = <a class="code" href="nand_8h.html#a4ffad3c1a39f11cbd50e21734894bcee">PPA_BLK</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    pg  = <a class="code" href="nand_8h.html#a277eb77cc9a0d195f464a357430de968">PPA_PG</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    sec = <a class="code" href="nand_8h.html#a3dfa4d340b137c1c335b19a70ca2fbde">PPA_SEC</a>(ln, <a class="code" href="structppa.html">ppa</a>);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    r  = sec;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    r += ch * c-&gt;<a class="code" href="structOc12IdGroup.html#a6a3f7995780567cae58de14a9596cee2">num_ch</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    r += lun * c-&gt;<a class="code" href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">num_lun</a>;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    r += pln * c-&gt;<a class="code" href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">num_pln</a>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    r += blk * c-&gt;<a class="code" href="structOc12IdGroup.html#ad4de9a793ea8301bcadc677d9524a6af">num_blk</a>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    r += pg * c-&gt;<a class="code" href="structOc12IdGroup.html#a7909a44a554f357cca989384aaf2495a">num_pg</a>;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (r &gt; ln-&gt;<a class="code" href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">params</a>.<a class="code" href="structOc12Params.html#a68db388373f6d0da613d531282d0b2bc">total_units</a>) {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <a class="code" href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a>(<span class="stringliteral">&quot;Out-of-range PPA detected!&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                 <span class="stringliteral">&quot;ch:%lu,lun:%lu,blk:%lu,pg:%lu,pl:%lu,sec:%lu\n&quot;</span>, ch, lun, blk,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                 pg, pln, sec);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keywordflow">return</span> ~(0ULL);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">return</span> r;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a968e2bafefcfab11d1e90df7bc2284a8_icgraph.png" border="0" usemap="#oc12_8c_a968e2bafefcfab11d1e90df7bc2284a8_icgraph" alt=""/></div>
<map name="oc12_8c_a968e2bafefcfab11d1e90df7bc2284a8_icgraph" id="oc12_8c_a968e2bafefcfab11d1e90df7bc2284a8_icgraph">
<area shape="rect" title=" " alt="" coords="1603,84,1699,111"/>
<area shape="rect" href="oc12_8c.html#a513d4b55522984724a7586103d0dccde" title=" " alt="" coords="1143,34,1341,60"/>
<area shape="rect" href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94" title=" " alt="" coords="1391,34,1553,60"/>
<area shape="rect" href="oc12_8c.html#aca64e4af4809cbee3d39390041608175" title=" " alt="" coords="1391,136,1553,177"/>
<area shape="rect" href="oc12_8c.html#ad73121a1527886888f077d49b5e599cd" title=" " alt="" coords="1391,84,1553,111"/>
<area shape="rect" href="oc12_8c.html#a9a3ff44ce36ff8f6abba64c35bc5dc79" title=" " alt="" coords="1389,202,1555,228"/>
<area shape="rect" href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf" title=" " alt="" coords="953,34,1095,60"/>
<area shape="rect" href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08" title=" " alt="" coords="799,84,905,111"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,84,751,111"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,84,527,111"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,84,284,111"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,84,129,111"/>
<area shape="rect" href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba" title=" " alt="" coords="1197,84,1287,111"/>
<area shape="rect" href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5" title=" " alt="" coords="1195,143,1289,170"/>
</map>
</div>

</div>
</div>
<a id="a3bfb4ee5498ee9493ea2965fb44074dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bfb4ee5498ee9493ea2965fb44074dc">&#9670;&nbsp;</a></span>qemu_fls()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int qemu_fls </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;{</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    <span class="keywordflow">return</span> 32 - clz32(i);</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
这是这个函数的调用关系图:</div>
<div class="dyncontent">
<div class="center"><img src="oc12_8c_a3bfb4ee5498ee9493ea2965fb44074dc_icgraph.png" border="0" usemap="#oc12_8c_a3bfb4ee5498ee9493ea2965fb44074dc_icgraph" alt=""/></div>
<map name="oc12_8c_a3bfb4ee5498ee9493ea2965fb44074dc_icgraph" id="oc12_8c_a3bfb4ee5498ee9493ea2965fb44074dc_icgraph">
<area shape="rect" title=" " alt="" coords="1275,5,1356,32"/>
<area shape="rect" href="oc12_8c.html#a22cb229f7099e5695f0525b8b74ffa37" title=" " alt="" coords="1099,5,1227,32"/>
<area shape="rect" href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088" title=" " alt="" coords="928,5,1051,32"/>
<area shape="rect" href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e" title=" " alt="" coords="799,5,880,32"/>
<area shape="rect" href="oc12_8c.html#a623f6939cbe95d9de1eab8847f6ddba0" title=" " alt="" coords="575,5,751,32"/>
<area shape="rect" href="femu_8c.html#a76a47b73caa1fa75fb706e3ed8f16a73" title=" " alt="" coords="332,5,527,32"/>
<area shape="rect" href="femu_8c.html#a966fbeb7afc495936413dbc445a0dd45" title=" " alt="" coords="177,5,284,32"/>
<area shape="rect" href="femu_8c.html#aeb3b70286609648db37222148efcf8d3" title=" " alt="" coords="5,5,129,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="adma_8c_html_adef0f21bc237d992b4ae8b29258645a8"><div class="ttname"><a href="dma_8c.html#adef0f21bc237d992b4ae8b29258645a8">dma_write_prp</a></div><div class="ttdeci">uint16_t dma_write_prp(FemuCtrl *n, uint8_t *ptr, uint32_t len, uint64_t prp1, uint64_t prp2)</div><div class="ttdef"><b>Definition:</b> dma.c:112</div></div>
<div class="ttc" id="astructOc12IdGroup_html_aa5b6d65ac99901288264502f0a0b3c83"><div class="ttname"><a href="structOc12IdGroup.html#aa5b6d65ac99901288264502f0a0b3c83">Oc12IdGroup::mtype</a></div><div class="ttdeci">uint8_t mtype</div><div class="ttdef"><b>Definition:</b> oc12.h:124</div></div>
<div class="ttc" id="astructOc12BbtGet_html_a5d030b8c1ecd315d53025c3286032d30"><div class="ttname"><a href="structOc12BbtGet.html#a5d030b8c1ecd315d53025c3286032d30">Oc12BbtGet::nsid</a></div><div class="ttdeci">uint32_t nsid</div><div class="ttdef"><b>Definition:</b> oc12.h:42</div></div>
<div class="ttc" id="astructOcCtrlParams_html_aa2f8ab02917978e386086f2be076bafb"><div class="ttname"><a href="structOcCtrlParams.html#aa2f8ab02917978e386086f2be076bafb">OcCtrlParams::num_ch</a></div><div class="ttdeci">uint8_t num_ch</div><div class="ttdef"><b>Definition:</b> nvme.h:1152</div></div>
<div class="ttc" id="astructOc12IdGroup_html_ad8919bf4f955421370dc3cb6d9719306"><div class="ttname"><a href="structOc12IdGroup.html#ad8919bf4f955421370dc3cb6d9719306">Oc12IdGroup::cpar</a></div><div class="ttdeci">uint16_t cpar</div><div class="ttdef"><b>Definition:</b> oc12.h:145</div></div>
<div class="ttc" id="astructFemuCtrl_html_a0e1b916dcb45d831a416bd84da70d25d"><div class="ttname"><a href="structFemuCtrl.html#a0e1b916dcb45d831a416bd84da70d25d">FemuCtrl::chnl_locks</a></div><div class="ttdeci">pthread_spinlock_t chnl_locks[FEMU_MAX_NUM_CHNLS]</div><div class="ttdef"><b>Definition:</b> nvme.h:1291</div></div>
<div class="ttc" id="astructOc12Ctrl_html_a2aee6c4895df5825404717f23aa5cde1"><div class="ttname"><a href="structOc12Ctrl.html#a2aee6c4895df5825404717f23aa5cde1">Oc12Ctrl::meta_len</a></div><div class="ttdeci">int meta_len</div><div class="ttdef"><b>Definition:</b> oc12.h:228</div></div>
<div class="ttc" id="aoc12_8c_html_a3d17602b61b416c29c19265374c0801b"><div class="ttname"><a href="oc12_8c.html#a3d17602b61b416c29c19265374c0801b">oc12_init_bbtbl</a></div><div class="ttdeci">static int oc12_init_bbtbl(FemuCtrl *n, NvmeNamespace *ns)</div><div class="ttdef"><b>Definition:</b> oc12.c:794</div></div>
<div class="ttc" id="aoc12_8c_html_a59f1fe491b2d6a603c05c6488eba019a"><div class="ttname"><a href="oc12_8c.html#a59f1fe491b2d6a603c05c6488eba019a">oc12_init_params</a></div><div class="ttdeci">static int oc12_init_params(FemuCtrl *n)</div><div class="ttdef"><b>Definition:</b> oc12.c:862</div></div>
<div class="ttc" id="astructFemuCtrl_html_a1134e53459a8a70ec5615d1881b26b47"><div class="ttname"><a href="structFemuCtrl.html#a1134e53459a8a70ec5615d1881b26b47">FemuCtrl::flash_type</a></div><div class="ttdeci">uint8_t flash_type</div><div class="ttdef"><b>Definition:</b> nvme.h:1326</div></div>
<div class="ttc" id="anvme_8h_html_a2259ab6ad32aaf55b340159f4fb043f4a43aae0e0a370dd16186369148885344f"><div class="ttname"><a href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a43aae0e0a370dd16186369148885344f">NVME_LBA_RANGE</a></div><div class="ttdeci">@ NVME_LBA_RANGE</div><div class="ttdef"><b>Definition:</b> nvme.h:534</div></div>
<div class="ttc" id="astructOc12AddrF_html_a5a1ed43b10ab09456de5a14c347df438"><div class="ttname"><a href="structOc12AddrF.html#a5a1ed43b10ab09456de5a14c347df438">Oc12AddrF::pg_mask</a></div><div class="ttdeci">uint64_t pg_mask</div><div class="ttdef"><b>Definition:</b> oc12.h:113</div></div>
<div class="ttc" id="astructOc12IdCtrl_html_a24671d2561fff3837d6c03ab44897096"><div class="ttname"><a href="structOc12IdCtrl.html#a24671d2561fff3837d6c03ab44897096">Oc12IdCtrl::ver_id</a></div><div class="ttdeci">uint8_t ver_id</div><div class="ttdef"><b>Definition:</b> oc12.h:150</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a6a3f7995780567cae58de14a9596cee2"><div class="ttname"><a href="structOc12IdGroup.html#a6a3f7995780567cae58de14a9596cee2">Oc12IdGroup::num_ch</a></div><div class="ttdeci">uint8_t num_ch</div><div class="ttdef"><b>Definition:</b> oc12.h:127</div></div>
<div class="ttc" id="astructOc12Params_html_a197d0d5dfe7b68f1b797dd17fb3af9c5"><div class="ttname"><a href="structOc12Params.html#a197d0d5dfe7b68f1b797dd17fb3af9c5">Oc12Params::pgs_per_blk</a></div><div class="ttdeci">uint16_t pgs_per_blk</div><div class="ttdef"><b>Definition:</b> oc12.h:178</div></div>
<div class="ttc" id="anand_8h_html_a3dfa4d340b137c1c335b19a70ca2fbde"><div class="ttname"><a href="nand_8h.html#a3dfa4d340b137c1c335b19a70ca2fbde">PPA_SEC</a></div><div class="ttdeci">#define PPA_SEC(ln, ppa)</div><div class="ttdef"><b>Definition:</b> nand.h:118</div></div>
<div class="ttc" id="aoc12_8h_html_a8008c35ea603710c25e24d36be6a9784"><div class="ttname"><a href="oc12_8h.html#a8008c35ea603710c25e24d36be6a9784">OC12_LBA_UNMAPPED</a></div><div class="ttdeci">#define OC12_LBA_UNMAPPED</div><div class="ttdef"><b>Definition:</b> oc12.h:254</div></div>
<div class="ttc" id="astructOc12IdGroup_html_adb46ff670c30aa51beb4579adb7c5a77"><div class="ttname"><a href="structOc12IdGroup.html#adb46ff670c30aa51beb4579adb7c5a77">Oc12IdGroup::tbet</a></div><div class="ttdeci">uint32_t tbet</div><div class="ttdef"><b>Definition:</b> oc12.h:141</div></div>
<div class="ttc" id="astructFemuCtrl_html_a2b07accc41de60cd0c6de43adde355ad"><div class="ttname"><a href="structFemuCtrl.html#a2b07accc41de60cd0c6de43adde355ad">FemuCtrl::ext_ops</a></div><div class="ttdeci">FemuExtCtrlOps ext_ops</div><div class="ttdef"><b>Definition:</b> nvme.h:1206</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_acb83182a42fa9b49e541b3ad9783d106"><div class="ttname"><a href="structOc12IdAddrFormat.html#acb83182a42fa9b49e541b3ad9783d106">Oc12IdAddrFormat::sect_len</a></div><div class="ttdeci">uint8_t sect_len</div><div class="ttdef"><b>Definition:</b> oc12.h:104</div></div>
<div class="ttc" id="astructNvmeIdNs_html"><div class="ttname"><a href="structNvmeIdNs.html">NvmeIdNs</a></div><div class="ttdef"><b>Definition:</b> nvme.h:857</div></div>
<div class="ttc" id="astructOc12Params_html_ad1fc4dbff62cd5ae013e33087f7867be"><div class="ttname"><a href="structOc12Params.html#ad1fc4dbff62cd5ae013e33087f7867be">Oc12Params::lun_units</a></div><div class="ttdeci">uint32_t lun_units</div><div class="ttdef"><b>Definition:</b> oc12.h:200</div></div>
<div class="ttc" id="anand_8h_html_a4ffad3c1a39f11cbd50e21734894bcee"><div class="ttname"><a href="nand_8h.html#a4ffad3c1a39f11cbd50e21734894bcee">PPA_BLK</a></div><div class="ttdeci">#define PPA_BLK(ln, ppa)</div><div class="ttdef"><b>Definition:</b> nand.h:116</div></div>
<div class="ttc" id="astructNvmeRequest_html_a678064f3bc45fbeb366ea44aea7273b2"><div class="ttname"><a href="structNvmeRequest.html#a678064f3bc45fbeb366ea44aea7273b2">NvmeRequest::qsg</a></div><div class="ttdeci">QEMUSGList qsg</div><div class="ttdef"><b>Definition:</b> nvme.h:978</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_a4f1c68d53544e4756997300fcf1492ca"><div class="ttname"><a href="structOc12IdAddrFormat.html#a4f1c68d53544e4756997300fcf1492ca">Oc12IdAddrFormat::lun_offset</a></div><div class="ttdeci">uint8_t lun_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:95</div></div>
<div class="ttc" id="astructOc12IdCtrl_html_ab288c79c7c494859929dbba46e44f039"><div class="ttname"><a href="structOc12IdCtrl.html#ab288c79c7c494859929dbba46e44f039">Oc12IdCtrl::ppaf</a></div><div class="ttdeci">struct Oc12IdAddrFormat ppaf</div><div class="ttdef"><b>Definition:</b> oc12.h:156</div></div>
<div class="ttc" id="aoc12_8c_html_a9c3bc08fae8d78b595c291eee88526ad"><div class="ttname"><a href="oc12_8c.html#a9c3bc08fae8d78b595c291eee88526ad">oc12_read_tbls</a></div><div class="ttdeci">static int oc12_read_tbls(FemuCtrl *n)</div><div class="ttdef"><b>Definition:</b> oc12.c:701</div></div>
<div class="ttc" id="astructOc12Ctrl_html_a9849745ef8a5149eb4dda97c15b1d640"><div class="ttname"><a href="structOc12Ctrl.html#a9849745ef8a5149eb4dda97c15b1d640">Oc12Ctrl::id_ctrl</a></div><div class="ttdeci">Oc12IdCtrl id_ctrl</div><div class="ttdef"><b>Definition:</b> oc12.h:218</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a2a0eb1952cba3783b0e56b12a5117975"><div class="ttname"><a href="structOc12IdGroup.html#a2a0eb1952cba3783b0e56b12a5117975">Oc12IdGroup::csecs</a></div><div class="ttdeci">uint16_t csecs</div><div class="ttdef"><b>Definition:</b> oc12.h:134</div></div>
<div class="ttc" id="astructOc12IdCtrl_html_a713cdc7093afae3f9b080c547ee8f325"><div class="ttname"><a href="structOc12IdCtrl.html#a713cdc7093afae3f9b080c547ee8f325">Oc12IdCtrl::vmnt</a></div><div class="ttdeci">uint8_t vmnt</div><div class="ttdef"><b>Definition:</b> oc12.h:151</div></div>
<div class="ttc" id="astructOc12AddrF_html_af0528b7d3f8355056e2e3c1263bbf847"><div class="ttname"><a href="structOc12AddrF.html#af0528b7d3f8355056e2e3c1263bbf847">Oc12AddrF::lun_mask</a></div><div class="ttdeci">uint64_t lun_mask</div><div class="ttdef"><b>Definition:</b> oc12.h:110</div></div>
<div class="ttc" id="astructNvmeNamespace_html_a82fb6235b209c097c887181151ad33a1"><div class="ttname"><a href="structNvmeNamespace.html#a82fb6235b209c097c887181151ad33a1">NvmeNamespace::uncorrectable</a></div><div class="ttdeci">unsigned long * uncorrectable</div><div class="ttdef"><b>Definition:</b> nvme.h:1064</div></div>
<div class="ttc" id="astructOc12Ctrl_html"><div class="ttname"><a href="structOc12Ctrl.html">Oc12Ctrl</a></div><div class="ttdef"><b>Definition:</b> oc12.h:216</div></div>
<div class="ttc" id="astructOc12Params_html_ae1e90c5b8a4721bbb9eca2f3e8622c9f"><div class="ttname"><a href="structOc12Params.html#ae1e90c5b8a4721bbb9eca2f3e8622c9f">Oc12Params::num_pln</a></div><div class="ttdeci">uint8_t num_pln</div><div class="ttdef"><b>Definition:</b> oc12.h:186</div></div>
<div class="ttc" id="astructOc12Params_html_a866dde01820d32a23b0ab6c74b11ff0d"><div class="ttname"><a href="structOc12Params.html#a866dde01820d32a23b0ab6c74b11ff0d">Oc12Params::sec_per_pl</a></div><div class="ttdeci">uint32_t sec_per_pl</div><div class="ttdef"><b>Definition:</b> oc12.h:190</div></div>
<div class="ttc" id="anvme_8h_html_a5d9fde4912328e2ecf4f80e41e1da013"><div class="ttname"><a href="nvme_8h.html#a5d9fde4912328e2ecf4f80e41e1da013">FemuExtCtrlOps</a></div><div class="ttdeci">struct FemuExtCtrlOps FemuExtCtrlOps</div></div>
<div class="ttc" id="astructNvmeNamespace_html_add3b0adcb1ba29178ccd71caff85b8a0"><div class="ttname"><a href="structNvmeNamespace.html#add3b0adcb1ba29178ccd71caff85b8a0">NvmeNamespace::tbl_entries</a></div><div class="ttdeci">uint32_t tbl_entries</div><div class="ttdef"><b>Definition:</b> nvme.h:1071</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_a05627c4f6be70dc17252ac0ff0fae901"><div class="ttname"><a href="structOc12IdAddrFormat.html#a05627c4f6be70dc17252ac0ff0fae901">Oc12IdAddrFormat::blk_len</a></div><div class="ttdeci">uint8_t blk_len</div><div class="ttdef"><b>Definition:</b> oc12.h:100</div></div>
<div class="ttc" id="astructOc12IdCtrl_html_adc341b399768a73cfc579fd4862747af"><div class="ttname"><a href="structOc12IdCtrl.html#adc341b399768a73cfc579fd4862747af">Oc12IdCtrl::groups</a></div><div class="ttdeci">Oc12IdGroup groups[4]</div><div class="ttdef"><b>Definition:</b> oc12.h:158</div></div>
<div class="ttc" id="astructAddrBucket_html_a20d14f13630952d9600c045a6d9ce329"><div class="ttname"><a href="structAddrBucket.html#a20d14f13630952d9600c045a6d9ce329">AddrBucket::ch</a></div><div class="ttdeci">int ch</div><div class="ttdef"><b>Definition:</b> oc12.h:243</div></div>
<div class="ttc" id="astructOc12AddrF_html_a4d8bb807dc7938223baaab7656c8e787"><div class="ttname"><a href="structOc12AddrF.html#a4d8bb807dc7938223baaab7656c8e787">Oc12AddrF::lun_offset</a></div><div class="ttdeci">uint8_t lun_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:116</div></div>
<div class="ttc" id="aoc12_8h_html_ad5747debd7a5038339741a4a5c341411a0aa62d870174142f5c126b872882215b"><div class="ttname"><a href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411a0aa62d870174142f5c126b872882215b">OC12_ADM_CMD_SET_BB_TBL</a></div><div class="ttdeci">@ OC12_ADM_CMD_SET_BB_TBL</div><div class="ttdef"><b>Definition:</b> oc12.h:10</div></div>
<div class="ttc" id="astructOc12AddrF_html_ac8f3101533f75b6616ef523aedb61bb0"><div class="ttname"><a href="structOc12AddrF.html#ac8f3101533f75b6616ef523aedb61bb0">Oc12AddrF::blk_offset</a></div><div class="ttdeci">uint8_t blk_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:118</div></div>
<div class="ttc" id="astructOc12Params_html_a68db388373f6d0da613d531282d0b2bc"><div class="ttname"><a href="structOc12Params.html#a68db388373f6d0da613d531282d0b2bc">Oc12Params::total_units</a></div><div class="ttdeci">uint32_t total_units</div><div class="ttdef"><b>Definition:</b> oc12.h:202</div></div>
<div class="ttc" id="astructAddrBucket_html_a8ad87aa0dffdeb38c21341e2e869a957"><div class="ttname"><a href="structAddrBucket.html#a8ad87aa0dffdeb38c21341e2e869a957">AddrBucket::lun</a></div><div class="ttdeci">int lun</div><div class="ttdef"><b>Definition:</b> oc12.h:244</div></div>
<div class="ttc" id="astructOcCtrlParams_html_a9fd47e7ebc5ed9a791b3b5fa84b6cd99"><div class="ttname"><a href="structOcCtrlParams.html#a9fd47e7ebc5ed9a791b3b5fa84b6cd99">OcCtrlParams::max_sec_per_rq</a></div><div class="ttdeci">uint8_t max_sec_per_rq</div><div class="ttdef"><b>Definition:</b> nvme.h:1151</div></div>
<div class="ttc" id="aoc12_8c_html_a968e2bafefcfab11d1e90df7bc2284a8"><div class="ttname"><a href="oc12_8c.html#a968e2bafefcfab11d1e90df7bc2284a8">ppa2secidx</a></div><div class="ttdeci">static uint64_t ppa2secidx(Oc12Ctrl *ln, uint64_t ppa)</div><div class="ttdef"><b>Definition:</b> oc12.c:25</div></div>
<div class="ttc" id="aoc12_8h_html_ad5747debd7a5038339741a4a5c341411ad3e1914c959d0d1da19199c376b3e5a8"><div class="ttname"><a href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411ad3e1914c959d0d1da19199c376b3e5a8">OC12_ADM_CMD_GET_L2P_TBL</a></div><div class="ttdeci">@ OC12_ADM_CMD_GET_L2P_TBL</div><div class="ttdef"><b>Definition:</b> oc12.h:8</div></div>
<div class="ttc" id="adram_8c_html_a1ccbcf0c92b7b084afc9890f3a7e5799"><div class="ttname"><a href="dram_8c.html#a1ccbcf0c92b7b084afc9890f3a7e5799">backend_rw</a></div><div class="ttdeci">int backend_rw(SsdDramBackend *b, QEMUSGList *qsg, uint64_t *lbal, bool is_write)</div><div class="ttdef"><b>Definition:</b> dram.c:29</div></div>
<div class="ttc" id="anvme_8h_html_aef2bfc05ccbdba79aef90226efe46ad4"><div class="ttname"><a href="nvme_8h.html#aef2bfc05ccbdba79aef90226efe46ad4">femu_debug</a></div><div class="ttdeci">#define femu_debug(fmt,...)</div><div class="ttdef"><b>Definition:</b> nvme.h:1485</div></div>
<div class="ttc" id="anand_8h_html_aea24174b997828eb73fe8f0e7c83209e"><div class="ttname"><a href="nand_8h.html#aea24174b997828eb73fe8f0e7c83209e">get_page_type</a></div><div class="ttdeci">static uint8_t get_page_type(int flash_type, int pg)</div><div class="ttdef"><b>Definition:</b> nand.h:126</div></div>
<div class="ttc" id="anvme_8h_html_a06fc0c989e392cd0684a2bd82ac3b577"><div class="ttname"><a href="nvme_8h.html#a06fc0c989e392cd0684a2bd82ac3b577">NVME_ID_NS_LBAF_MS</a></div><div class="ttdeci">#define NVME_ID_NS_LBAF_MS(ns, lba_index)</div><div class="ttdef"><b>Definition:</b> nvme.h:31</div></div>
<div class="ttc" id="astructOc12RwCmd_html_a0489f3cd5053aaea3eb7fd83d9958122"><div class="ttname"><a href="structOc12RwCmd.html#a0489f3cd5053aaea3eb7fd83d9958122">Oc12RwCmd::opcode</a></div><div class="ttdeci">uint8_t opcode</div><div class="ttdef"><b>Definition:</b> oc12.h:66</div></div>
<div class="ttc" id="astructNvmeIdentity_html"><div class="ttname"><a href="structNvmeIdentity.html">NvmeIdentity</a></div><div class="ttdef"><b>Definition:</b> nvme.h:400</div></div>
<div class="ttc" id="anvme_8h_html_a2259ab6ad32aaf55b340159f4fb043f4a3268f6be90861f0c2270d86a44d5b09c"><div class="ttname"><a href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a3268f6be90861f0c2270d86a44d5b09c">NVME_SUCCESS</a></div><div class="ttdeci">@ NVME_SUCCESS</div><div class="ttdef"><b>Definition:</b> nvme.h:520</div></div>
<div class="ttc" id="astructNvmeNamespace_html_a0e6565e5bda500bf95530011731823c2"><div class="ttname"><a href="structNvmeNamespace.html#a0e6565e5bda500bf95530011731823c2">NvmeNamespace::tbl</a></div><div class="ttdeci">uint64_t * tbl</div><div class="ttdef"><b>Definition:</b> nvme.h:1072</div></div>
<div class="ttc" id="astructOc12IdGroup_html_ad3b28b73abc825d8a84366bea0239392"><div class="ttname"><a href="structOc12IdGroup.html#ad3b28b73abc825d8a84366bea0239392">Oc12IdGroup::trdm</a></div><div class="ttdeci">uint32_t trdm</div><div class="ttdef"><b>Definition:</b> oc12.h:138</div></div>
<div class="ttc" id="astructFemuCtrl_html_ae419c3a209fe0ffb9f6e04bc6ff3cd7e"><div class="ttname"><a href="structFemuCtrl.html#ae419c3a209fe0ffb9f6e04bc6ff3cd7e">FemuCtrl::bar</a></div><div class="ttdeci">NvmeBar bar</div><div class="ttdef"><b>Definition:</b> nvme.h:1174</div></div>
<div class="ttc" id="atiming_8c_html_a30a08fb995a730b58d87013dab3f010e"><div class="ttname"><a href="timing_8c.html#a30a08fb995a730b58d87013dab3f010e">advance_chip_timestamp</a></div><div class="ttdeci">int64_t advance_chip_timestamp(FemuCtrl *n, int lunid, uint64_t now, int opcode, uint8_t page_type)</div><div class="ttdef"><b>Definition:</b> timing.c:72</div></div>
<div class="ttc" id="astructOc12BbtSet_html"><div class="ttname"><a href="structOc12BbtSet.html">Oc12BbtSet</a></div><div class="ttdef"><b>Definition:</b> oc12.h:50</div></div>
<div class="ttc" id="aoc12_8c_html_aef55b0e79dd4659d66fc1d7d83b3a88a"><div class="ttname"><a href="oc12_8c.html#aef55b0e79dd4659d66fc1d7d83b3a88a">oc12_set_ctrl_str</a></div><div class="ttdeci">static void oc12_set_ctrl_str(FemuCtrl *n)</div><div class="ttdef"><b>Definition:</b> oc12.c:1061</div></div>
<div class="ttc" id="astructFemuCtrl_html_aa01c6604f4ef7eec3bfdcd0bdd6c43ac"><div class="ttname"><a href="structFemuCtrl.html#aa01c6604f4ef7eec3bfdcd0bdd6c43ac">FemuCtrl::chip_next_avail_time</a></div><div class="ttdeci">volatile int64_t chip_next_avail_time[FEMU_MAX_NUM_CHIPS]</div><div class="ttdef"><b>Definition:</b> nvme.h:1288</div></div>
<div class="ttc" id="astructOc12BbtGet_html_af1326dca27ade98f861c132d43f2eda0"><div class="ttname"><a href="structOc12BbtGet.html#af1326dca27ade98f861c132d43f2eda0">Oc12BbtGet::prp2</a></div><div class="ttdeci">uint64_t prp2</div><div class="ttdef"><b>Definition:</b> oc12.h:45</div></div>
<div class="ttc" id="astructOc12BbtGet_html"><div class="ttname"><a href="structOc12BbtGet.html">Oc12BbtGet</a></div><div class="ttdef"><b>Definition:</b> oc12.h:38</div></div>
<div class="ttc" id="anand_8h_html_a1d76007eb272ea57874f05dc798f9d99"><div class="ttname"><a href="nand_8h.html#a1d76007eb272ea57874f05dc798f9d99">PPA_PLN</a></div><div class="ttdeci">#define PPA_PLN(ln, ppa)</div><div class="ttdef"><b>Definition:</b> nand.h:115</div></div>
<div class="ttc" id="aoc12_8c_html_af8b73b03b7edcdc1740a24b053ce72a5"><div class="ttname"><a href="oc12_8c.html#af8b73b03b7edcdc1740a24b053ce72a5">oc12_write</a></div><div class="ttdeci">static uint16_t oc12_write(FemuCtrl *n, NvmeNamespace *ns, NvmeCmd *cmd, NvmeRequest *req)</div><div class="ttdef"><b>Definition:</b> oc12.c:493</div></div>
<div class="ttc" id="astructOc12Params_html_ac90b11508651ffc5ebc403c5caae8dc0"><div class="ttname"><a href="structOc12Params.html#ac90b11508651ffc5ebc403c5caae8dc0">Oc12Params::sec_per_lun</a></div><div class="ttdeci">uint32_t sec_per_lun</div><div class="ttdef"><b>Definition:</b> oc12.h:192</div></div>
<div class="ttc" id="astructOc12IdGroup_html_aa712d374e318d3d06fe5114f924db0e4"><div class="ttname"><a href="structOc12IdGroup.html#aa712d374e318d3d06fe5114f924db0e4">Oc12IdGroup::trdt</a></div><div class="ttdeci">uint32_t trdt</div><div class="ttdef"><b>Definition:</b> oc12.h:137</div></div>
<div class="ttc" id="adma_8c_html_a83e01cb3ebf3721ca1fd024940ed6aa6"><div class="ttname"><a href="dma_8c.html#a83e01cb3ebf3721ca1fd024940ed6aa6">dma_read_prp</a></div><div class="ttdeci">uint16_t dma_read_prp(FemuCtrl *n, uint8_t *ptr, uint32_t len, uint64_t prp1, uint64_t prp2)</div><div class="ttdef"><b>Definition:</b> dma.c:137</div></div>
<div class="ttc" id="astructNvmeNamespace_html"><div class="ttname"><a href="structNvmeNamespace.html">NvmeNamespace</a></div><div class="ttdef"><b>Definition:</b> nvme.h:1059</div></div>
<div class="ttc" id="aoc12_8h_html_ad5747debd7a5038339741a4a5c341411ad8bcdb8fdb03281ba3d0859cc42d0092"><div class="ttname"><a href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411ad8bcdb8fdb03281ba3d0859cc42d0092">OC12_ADM_CMD_GET_BB_TBL</a></div><div class="ttdeci">@ OC12_ADM_CMD_GET_BB_TBL</div><div class="ttdef"><b>Definition:</b> oc12.h:9</div></div>
<div class="ttc" id="astructNvmeNamespace_html_a0ed912de2d37b54d07b1f27deb7c5bb6"><div class="ttname"><a href="structNvmeNamespace.html#a0ed912de2d37b54d07b1f27deb7c5bb6">NvmeNamespace::start_block</a></div><div class="ttdeci">uint64_t start_block</div><div class="ttdef"><b>Definition:</b> nvme.h:1068</div></div>
<div class="ttc" id="anvme_8h_html_a01e3a918ff89282c841471f5d797fbf6af12c69a9bdf0ad418e4a144ef5424336"><div class="ttname"><a href="nvme_8h.html#a01e3a918ff89282c841471f5d797fbf6af12c69a9bdf0ad418e4a144ef5424336">NVME_CMD_WRITE</a></div><div class="ttdeci">@ NVME_CMD_WRITE</div><div class="ttdef"><b>Definition:</b> nvme.h:334</div></div>
<div class="ttc" id="astructAddrBucket_html_a61e6c99a9e481a5f5f5fd3916a933c9e"><div class="ttname"><a href="structAddrBucket.html#a61e6c99a9e481a5f5f5fd3916a933c9e">AddrBucket::cnt</a></div><div class="ttdeci">int cnt</div><div class="ttdef"><b>Definition:</b> oc12.h:247</div></div>
<div class="ttc" id="anvme_8h_html_a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1"><div class="ttname"><a href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a885e33aaef46f9a32806fd9d576167a1">NVME_DNR</a></div><div class="ttdeci">@ NVME_DNR</div><div class="ttdef"><b>Definition:</b> nvme.h:575</div></div>
<div class="ttc" id="astructOc12GetL2PTbl_html_a6ecce1c7263673a58df566158357196c"><div class="ttname"><a href="structOc12GetL2PTbl.html#a6ecce1c7263673a58df566158357196c">Oc12GetL2PTbl::prp1</a></div><div class="ttdeci">uint64_t prp1</div><div class="ttdef"><b>Definition:</b> oc12.h:31</div></div>
<div class="ttc" id="astructOc12Params_html_a25caa2793ab1badb2edaa4eccc1e40e1"><div class="ttname"><a href="structOc12Params.html#a25caa2793ab1badb2edaa4eccc1e40e1">Oc12Params::mtype</a></div><div class="ttdeci">uint8_t mtype</div><div class="ttdef"><b>Definition:</b> oc12.h:183</div></div>
<div class="ttc" id="astructOc12Bbt_html"><div class="ttname"><a href="structOc12Bbt.html">Oc12Bbt</a></div><div class="ttdef"><b>Definition:</b> oc12.h:161</div></div>
<div class="ttc" id="astructOcCtrlParams_html_a27781af8d2e57f6ac3baa763d639e3ac"><div class="ttname"><a href="structOcCtrlParams.html#a27781af8d2e57f6ac3baa763d639e3ac">OcCtrlParams::pgs_per_blk</a></div><div class="ttdeci">uint16_t pgs_per_blk</div><div class="ttdef"><b>Definition:</b> nvme.h:1150</div></div>
<div class="ttc" id="astructOc12Ctrl_html_a6d7412e0fab34605da6930167f43aa93"><div class="ttname"><a href="structOc12Ctrl.html#a6d7412e0fab34605da6930167f43aa93">Oc12Ctrl::ppaf</a></div><div class="ttdeci">Oc12AddrF ppaf</div><div class="ttdef"><b>Definition:</b> oc12.h:219</div></div>
<div class="ttc" id="aoc12_8c_html_a62b547738c301cdf347f2ce68659c93d"><div class="ttname"><a href="oc12_8c.html#a62b547738c301cdf347f2ce68659c93d">oc12_nvme_rw</a></div><div class="ttdeci">static uint16_t oc12_nvme_rw(FemuCtrl *n, NvmeNamespace *ns, NvmeCmd *cmd, NvmeRequest *req)</div><div class="ttdef"><b>Definition:</b> oc12.c:1036</div></div>
<div class="ttc" id="astructAddrBucket_html_a6067622337a90fb397b788a17d540af4"><div class="ttname"><a href="structAddrBucket.html#a6067622337a90fb397b788a17d540af4">AddrBucket::page_type</a></div><div class="ttdeci">uint8_t page_type</div><div class="ttdef"><b>Definition:</b> oc12.h:246</div></div>
<div class="ttc" id="astructOc12RwCmd_html_a0b80057273b661a4f0537c5c027d7f1e"><div class="ttname"><a href="structOc12RwCmd.html#a0b80057273b661a4f0537c5c027d7f1e">Oc12RwCmd::prp2</a></div><div class="ttdeci">uint64_t prp2</div><div class="ttdef"><b>Definition:</b> oc12.h:73</div></div>
<div class="ttc" id="anvme_8h_html_a2259ab6ad32aaf55b340159f4fb043f4a5157ff55aedb970b020e6602903bd46a"><div class="ttname"><a href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a5157ff55aedb970b020e6602903bd46a">NVME_UNRECOVERED_READ</a></div><div class="ttdeci">@ NVME_UNRECOVERED_READ</div><div class="ttdef"><b>Definition:</b> nvme.h:567</div></div>
<div class="ttc" id="astructNvmeRequest_html_a22a0c24be595ec2abed21073be01efd9"><div class="ttname"><a href="structNvmeRequest.html#a22a0c24be595ec2abed21073be01efd9">NvmeRequest::iov</a></div><div class="ttdeci">QEMUIOVector iov</div><div class="ttdef"><b>Definition:</b> nvme.h:979</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a5d709d4b4b3ddce6730de6673ed3f7ac"><div class="ttname"><a href="structOc12IdGroup.html#a5d709d4b4b3ddce6730de6673ed3f7ac">Oc12IdGroup::fpg_sz</a></div><div class="ttdeci">uint16_t fpg_sz</div><div class="ttdef"><b>Definition:</b> oc12.h:133</div></div>
<div class="ttc" id="aoc12_8c_html_a126a85634fc530e22284c185df8f5f81"><div class="ttname"><a href="oc12_8c.html#a126a85634fc530e22284c185df8f5f81">oc12_identity</a></div><div class="ttdeci">static uint16_t oc12_identity(FemuCtrl *n, NvmeCmd *cmd)</div><div class="ttdef"><b>Definition:</b> oc12.c:576</div></div>
<div class="ttc" id="aoc12_8h_html_ace152beca8789cab7f1e29d970ce8266"><div class="ttname"><a href="oc12_8h.html#ace152beca8789cab7f1e29d970ce8266">OC12_PBA_UNMAPPED</a></div><div class="ttdeci">#define OC12_PBA_UNMAPPED</div><div class="ttdef"><b>Definition:</b> oc12.h:253</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_a91100993590071ca1a4c18879bdabf14"><div class="ttname"><a href="structOc12IdAddrFormat.html#a91100993590071ca1a4c18879bdabf14">Oc12IdAddrFormat::lun_len</a></div><div class="ttdeci">uint8_t lun_len</div><div class="ttdef"><b>Definition:</b> oc12.h:96</div></div>
<div class="ttc" id="aoc12_8c_html_a7e3ff8c5923a54ae4b9167627877b7ba"><div class="ttname"><a href="oc12_8c.html#a7e3ff8c5923a54ae4b9167627877b7ba">oc12_read</a></div><div class="ttdeci">static uint16_t oc12_read(FemuCtrl *n, NvmeNamespace *ns, NvmeCmd *cmd, NvmeRequest *req)</div><div class="ttdef"><b>Definition:</b> oc12.c:419</div></div>
<div class="ttc" id="anand_8h_html_a61ca2e3531ba78a2d7f62cb9c077dbec"><div class="ttname"><a href="nand_8h.html#a61ca2e3531ba78a2d7f62cb9c077dbec">PPA_LUN</a></div><div class="ttdeci">#define PPA_LUN(ln, ppa)</div><div class="ttdef"><b>Definition:</b> nand.h:114</div></div>
<div class="ttc" id="aoc12_8c_html_aca64e4af4809cbee3d39390041608175"><div class="ttname"><a href="oc12_8c.html#aca64e4af4809cbee3d39390041608175">oc12_meta_state_set_written</a></div><div class="ttdeci">static int oc12_meta_state_set_written(Oc12Ctrl *ln, uint64_t ppa)</div><div class="ttdef"><b>Definition:</b> oc12.c:215</div></div>
<div class="ttc" id="astructNvmeRequest_html_ad267c178ee13ebb285604043925b5e78"><div class="ttname"><a href="structNvmeRequest.html#ad267c178ee13ebb285604043925b5e78">NvmeRequest::stime</a></div><div class="ttdeci">int64_t stime</div><div class="ttdef"><b>Definition:</b> nvme.h:981</div></div>
<div class="ttc" id="astructOcCtrlParams_html_ab57709c93e7f0281243ef23b2cbfa77b"><div class="ttname"><a href="structOcCtrlParams.html#ab57709c93e7f0281243ef23b2cbfa77b">OcCtrlParams::num_lun</a></div><div class="ttdeci">uint8_t num_lun</div><div class="ttdef"><b>Definition:</b> nvme.h:1153</div></div>
<div class="ttc" id="astructNvmeNamespace_html_ac5c0ddf3fd8b71e4387062b8a5e1075d"><div class="ttname"><a href="structNvmeNamespace.html#ac5c0ddf3fd8b71e4387062b8a5e1075d">NvmeNamespace::id_ns</a></div><div class="ttdeci">NvmeIdNs id_ns</div><div class="ttdef"><b>Definition:</b> nvme.h:1061</div></div>
<div class="ttc" id="astructNvmeBar_html_ad5910458ce9220c367e14c8482117018"><div class="ttname"><a href="structNvmeBar.html#ad5910458ce9220c367e14c8482117018">NvmeBar::cap</a></div><div class="ttdeci">uint64_t cap</div><div class="ttdef"><b>Definition:</b> nvme.h:34</div></div>
<div class="ttc" id="astructOc12Params_html_a1e9ac0caf8d4bc4999841b8dd729659e"><div class="ttname"><a href="structOc12Params.html#a1e9ac0caf8d4bc4999841b8dd729659e">Oc12Params::fmtype</a></div><div class="ttdeci">uint8_t fmtype</div><div class="ttdef"><b>Definition:</b> oc12.h:184</div></div>
<div class="ttc" id="astructOc12RwCmd_html_aa0ac0ee2111dc2dbfb5d1a7fd3aa6925"><div class="ttname"><a href="structOc12RwCmd.html#aa0ac0ee2111dc2dbfb5d1a7fd3aa6925">Oc12RwCmd::prp1</a></div><div class="ttdeci">uint64_t prp1</div><div class="ttdef"><b>Definition:</b> oc12.h:72</div></div>
<div class="ttc" id="astructOc12Ctrl_html_aff7d8b44a82ea05d3170d4aa2ebcc193"><div class="ttname"><a href="structOc12Ctrl.html#aff7d8b44a82ea05d3170d4aa2ebcc193">Oc12Ctrl::meta_tbytes</a></div><div class="ttdeci">int meta_tbytes</div><div class="ttdef"><b>Definition:</b> oc12.h:227</div></div>
<div class="ttc" id="anvme-util_8c_html_a9e84e8328646dcb1f24be9c79018e6a0"><div class="ttname"><a href="nvme-util_8c.html#a9e84e8328646dcb1f24be9c79018e6a0">nvme_set_ctrl_name</a></div><div class="ttdeci">void nvme_set_ctrl_name(FemuCtrl *n, const char *mn, const char *sn, int *dev_id)</div><div class="ttdef"><b>Definition:</b> nvme-util.c:282</div></div>
<div class="ttc" id="astructNvmeIdNs_html_aeeebe8821a3ff138cdd9bd4208b71a14"><div class="ttname"><a href="structNvmeIdNs.html#aeeebe8821a3ff138cdd9bd4208b71a14">NvmeIdNs::vs</a></div><div class="ttdeci">uint8_t vs[3712]</div><div class="ttdef"><b>Definition:</b> nvme.h:889</div></div>
<div class="ttc" id="astructOc12AddrF_html_a28de76535fbf770c0abd421c251cb906"><div class="ttname"><a href="structOc12AddrF.html#a28de76535fbf770c0abd421c251cb906">Oc12AddrF::pln_mask</a></div><div class="ttdeci">uint64_t pln_mask</div><div class="ttdef"><b>Definition:</b> oc12.h:111</div></div>
<div class="ttc" id="astructOc12Params_html_a5b41da7474672b8a43623b525e29a630"><div class="ttname"><a href="structOc12Params.html#a5b41da7474672b8a43623b525e29a630">Oc12Params::ch_units</a></div><div class="ttdeci">uint32_t ch_units</div><div class="ttdef"><b>Definition:</b> oc12.h:201</div></div>
<div class="ttc" id="astructOc12Bbt_html_af7cb982c83b1df8c9f6c86924e54bfc2"><div class="ttname"><a href="structOc12Bbt.html#af7cb982c83b1df8c9f6c86924e54bfc2">Oc12Bbt::tblid</a></div><div class="ttdeci">uint8_t tblid[4]</div><div class="ttdef"><b>Definition:</b> oc12.h:162</div></div>
<div class="ttc" id="aoc12_8c_html_a834f283bef0c838d4b075ba5cc5405b1"><div class="ttname"><a href="oc12_8c.html#a834f283bef0c838d4b075ba5cc5405b1">oc12_rw_check_req</a></div><div class="ttdeci">static uint16_t oc12_rw_check_req(FemuCtrl *n, NvmeNamespace *ns, NvmeCmd *cmd, NvmeRequest *req, uint64_t *psl, uint32_t nr_pages, uint32_t nlb, uint64_t data_size, uint64_t meta_size)</div><div class="ttdef"><b>Definition:</b> oc12.c:243</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_a80056747d5d7ccd2ff84a24e60ffd1de"><div class="ttname"><a href="structOc12IdAddrFormat.html#a80056747d5d7ccd2ff84a24e60ffd1de">Oc12IdAddrFormat::blk_offset</a></div><div class="ttdeci">uint8_t blk_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:99</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a0970921f80b409749a095631d55b76a8"><div class="ttname"><a href="structOc12IdGroup.html#a0970921f80b409749a095631d55b76a8">Oc12IdGroup::num_pln</a></div><div class="ttdeci">uint8_t num_pln</div><div class="ttdef"><b>Definition:</b> oc12.h:129</div></div>
<div class="ttc" id="astructOc12Params_html_aa0eb6efdc901760309f5486bc36c7377"><div class="ttname"><a href="structOc12Params.html#aa0eb6efdc901760309f5486bc36c7377">Oc12Params::pg_units</a></div><div class="ttdeci">uint32_t pg_units</div><div class="ttdef"><b>Definition:</b> oc12.h:198</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html"><div class="ttname"><a href="structOc12IdAddrFormat.html">Oc12IdAddrFormat</a></div><div class="ttdef"><b>Definition:</b> oc12.h:92</div></div>
<div class="ttc" id="aoc12_8c_html_a7c5fa0dc26c1d7334be3de1917e950f4"><div class="ttname"><a href="oc12_8c.html#a7c5fa0dc26c1d7334be3de1917e950f4">parse_ppa_list</a></div><div class="ttdeci">static void parse_ppa_list(FemuCtrl *n, NvmeNamespace *ns, NvmeCmd *cmd, NvmeRequest *req, AddrBucket *bucket, int *nr)</div><div class="ttdef"><b>Definition:</b> oc12.c:310</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a9acb718bf42389c90fd15bc003a04034"><div class="ttname"><a href="structOc12IdGroup.html#a9acb718bf42389c90fd15bc003a04034">Oc12IdGroup::tprt</a></div><div class="ttdeci">uint32_t tprt</div><div class="ttdef"><b>Definition:</b> oc12.h:139</div></div>
<div class="ttc" id="astructOc12IdGroup_html_ad4de9a793ea8301bcadc677d9524a6af"><div class="ttname"><a href="structOc12IdGroup.html#ad4de9a793ea8301bcadc677d9524a6af">Oc12IdGroup::num_blk</a></div><div class="ttdeci">uint16_t num_blk</div><div class="ttdef"><b>Definition:</b> oc12.h:131</div></div>
<div class="ttc" id="adma_8c_html_a0ac25a907651fbfbf9710b15dc45e484"><div class="ttname"><a href="dma_8c.html#a0ac25a907651fbfbf9710b15dc45e484">nvme_addr_read</a></div><div class="ttdeci">void nvme_addr_read(FemuCtrl *n, hwaddr addr, void *buf, int size)</div><div class="ttdef"><b>Definition:</b> dma.c:3</div></div>
<div class="ttc" id="aoc12_8c_html_a68620169de187b09e15ef18b52eb72c6"><div class="ttname"><a href="oc12_8c.html#a68620169de187b09e15ef18b52eb72c6">oc12_admin_cmd</a></div><div class="ttdeci">static uint16_t oc12_admin_cmd(FemuCtrl *n, NvmeCmd *cmd)</div><div class="ttdef"><b>Definition:</b> oc12.c:713</div></div>
<div class="ttc" id="aoc12_8c_html_aada1f75e02b085c6a43438e5ab1c81e0"><div class="ttname"><a href="oc12_8c.html#aada1f75e02b085c6a43438e5ab1c81e0">oc12_bbt_set</a></div><div class="ttdeci">static uint16_t oc12_bbt_set(FemuCtrl *n, NvmeCmd *cmd)</div><div class="ttdef"><b>Definition:</b> oc12.c:655</div></div>
<div class="ttc" id="astructOc12Params_html_a320d8e81b78d1ab64ff97e93b499e5e6"><div class="ttname"><a href="structOc12Params.html#a320d8e81b78d1ab64ff97e93b499e5e6">Oc12Params::pl_units</a></div><div class="ttdeci">uint32_t pl_units</div><div class="ttdef"><b>Definition:</b> oc12.h:197</div></div>
<div class="ttc" id="astructOc12AddrF_html_ae474e1c6b5b4bc9db7e1933b8d1bbacc"><div class="ttname"><a href="structOc12AddrF.html#ae474e1c6b5b4bc9db7e1933b8d1bbacc">Oc12AddrF::ch_offset</a></div><div class="ttdeci">uint8_t ch_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:115</div></div>
<div class="ttc" id="astructNvmeIdentity_html_a984de8dea6f880cd774b5c9883fcf12d"><div class="ttname"><a href="structNvmeIdentity.html#a984de8dea6f880cd774b5c9883fcf12d">NvmeIdentity::prp1</a></div><div class="ttdeci">uint64_t prp1</div><div class="ttdef"><b>Definition:</b> nvme.h:406</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a6936e76b6a4ca61a37d1bcbc3ea01b85"><div class="ttname"><a href="structOc12IdGroup.html#a6936e76b6a4ca61a37d1bcbc3ea01b85">Oc12IdGroup::tprm</a></div><div class="ttdeci">uint32_t tprm</div><div class="ttdef"><b>Definition:</b> oc12.h:140</div></div>
<div class="ttc" id="astructOc12Ctrl_html_a1a9ae7fad2a49762e7fbe454212d1e45"><div class="ttname"><a href="structOc12Ctrl.html#a1a9ae7fad2a49762e7fbe454212d1e45">Oc12Ctrl::int_meta_size</a></div><div class="ttdeci">uint8_t int_meta_size</div><div class="ttdef"><b>Definition:</b> oc12.h:229</div></div>
<div class="ttc" id="aoc12_8h_html_a191ef70a32f90a74e95fe996c572216ea735e25ebb849a49112ca05d70cf7c3bc"><div class="ttname"><a href="oc12_8h.html#a191ef70a32f90a74e95fe996c572216ea735e25ebb849a49112ca05d70cf7c3bc">Oc12PMODE_DUAL</a></div><div class="ttdeci">@ Oc12PMODE_DUAL</div><div class="ttdoc">Dual-plane (NVM_IO_DUAL_ACCESS)</div><div class="ttdef"><b>Definition:</b> oc12.h:207</div></div>
<div class="ttc" id="aoc12_8h_html_a62b8a1f2ddfa637c1d6bb86f80ebc9a0a8cfd84b1039b373a3cf3d86de795803f"><div class="ttname"><a href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a8cfd84b1039b373a3cf3d86de795803f">OC12_CMD_READ</a></div><div class="ttdeci">@ OC12_CMD_READ</div><div class="ttdef"><b>Definition:</b> oc12.h:15</div></div>
<div class="ttc" id="astructFemuCtrl_html_a5781992b7e6de772798e9802d20d8913"><div class="ttname"><a href="structFemuCtrl.html#a5781992b7e6de772798e9802d20d8913">FemuCtrl::oc12_ctrl</a></div><div class="ttdeci">Oc12Ctrl * oc12_ctrl</div><div class="ttdef"><b>Definition:</b> nvme.h:1287</div></div>
<div class="ttc" id="astructOcCtrlParams_html_accd37db57265d7c819ea71c8e9b7e722"><div class="ttname"><a href="structOcCtrlParams.html#accd37db57265d7c819ea71c8e9b7e722">OcCtrlParams::sos</a></div><div class="ttdeci">uint16_t sos</div><div class="ttdef"><b>Definition:</b> nvme.h:1155</div></div>
<div class="ttc" id="astructFemuCtrl_html_a48cf26e3440955b976f0b77c8677c15c"><div class="ttname"><a href="structFemuCtrl.html#a48cf26e3440955b976f0b77c8677c15c">FemuCtrl::chip_locks</a></div><div class="ttdeci">pthread_spinlock_t chip_locks[FEMU_MAX_NUM_CHIPS]</div><div class="ttdef"><b>Definition:</b> nvme.h:1289</div></div>
<div class="ttc" id="aoc12_8c_html_adb2f63023ff079bd918f3e0a2fc99c0a"><div class="ttname"><a href="oc12_8c.html#adb2f63023ff079bd918f3e0a2fc99c0a">oc12_exit</a></div><div class="ttdeci">static void oc12_exit(FemuCtrl *n)</div><div class="ttdef"><b>Definition:</b> oc12.c:1031</div></div>
<div class="ttc" id="astructOc12Params_html_a1d40ed4de65d5fa98f4ff9805cd82c04"><div class="ttname"><a href="structOc12Params.html#a1d40ed4de65d5fa98f4ff9805cd82c04">Oc12Params::sec_size</a></div><div class="ttdeci">uint16_t sec_size</div><div class="ttdef"><b>Definition:</b> oc12.h:179</div></div>
<div class="ttc" id="anand_8c_html_abf5d19b68122bdd6e7769c2d86d12e12"><div class="ttname"><a href="nand_8c.html#abf5d19b68122bdd6e7769c2d86d12e12">init_nand_flash</a></div><div class="ttdeci">int init_nand_flash(void *opaque)</div><div class="ttdef"><b>Definition:</b> nand.c:148</div></div>
<div class="ttc" id="astructNvmeIdCtrl_html_a7aa6155f605fdb78fab28db981e0c5c4"><div class="ttname"><a href="structNvmeIdCtrl.html#a7aa6155f605fdb78fab28db981e0c5c4">NvmeIdCtrl::mdts</a></div><div class="ttdeci">uint8_t mdts</div><div class="ttdef"><b>Definition:</b> nvme.h:695</div></div>
<div class="ttc" id="astructOc12Params_html_a1a4dabebac7d6a12bf17e5bf518698c2"><div class="ttname"><a href="structOc12Params.html#a1a4dabebac7d6a12bf17e5bf518698c2">Oc12Params::sec_per_ch</a></div><div class="ttdeci">uint32_t sec_per_ch</div><div class="ttdef"><b>Definition:</b> oc12.h:193</div></div>
<div class="ttc" id="astructNvmeRequest_html_a6f04006cddb851afcc919412c6e90b60"><div class="ttname"><a href="structNvmeRequest.html#a6f04006cddb851afcc919412c6e90b60">NvmeRequest::is_write</a></div><div class="ttdeci">uint16_t is_write</div><div class="ttdef"><b>Definition:</b> nvme.h:967</div></div>
<div class="ttc" id="adma_8c_html_a08f51254313a657c3826f77e6bd9a1b8"><div class="ttname"><a href="dma_8c.html#a08f51254313a657c3826f77e6bd9a1b8">nvme_addr_write</a></div><div class="ttdeci">void nvme_addr_write(FemuCtrl *n, hwaddr addr, void *buf, int size)</div><div class="ttdef"><b>Definition:</b> dma.c:13</div></div>
<div class="ttc" id="astructOc12Params_html_abfa9dc93828353063fc768dcaf10f57f"><div class="ttname"><a href="structOc12Params.html#abfa9dc93828353063fc768dcaf10f57f">Oc12Params::sec_per_pg</a></div><div class="ttdeci">uint8_t sec_per_pg</div><div class="ttdef"><b>Definition:</b> oc12.h:180</div></div>
<div class="ttc" id="astructOc12BbtSet_html_a1312aaa0b5e48450701addb06dd43a83"><div class="ttname"><a href="structOc12BbtSet.html#a1312aaa0b5e48450701addb06dd43a83">Oc12BbtSet::nsid</a></div><div class="ttdeci">uint32_t nsid</div><div class="ttdef"><b>Definition:</b> oc12.h:54</div></div>
<div class="ttc" id="astructOc12Params_html_a70b265aed071dd11efd5f0741d9b9e3d"><div class="ttname"><a href="structOc12Params.html#a70b265aed071dd11efd5f0741d9b9e3d">Oc12Params::total_secs</a></div><div class="ttdeci">uint32_t total_secs</div><div class="ttdef"><b>Definition:</b> oc12.h:194</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a14587b90e79e5a80b05c1e16ad70588a"><div class="ttname"><a href="structOc12IdGroup.html#a14587b90e79e5a80b05c1e16ad70588a">Oc12IdGroup::mccap</a></div><div class="ttdeci">uint32_t mccap</div><div class="ttdef"><b>Definition:</b> oc12.h:144</div></div>
<div class="ttc" id="astructNvmeIdentity_html_a00384fddea98b5e53fde34ddc53260be"><div class="ttname"><a href="structNvmeIdentity.html#a00384fddea98b5e53fde34ddc53260be">NvmeIdentity::nsid</a></div><div class="ttdeci">uint32_t nsid</div><div class="ttdef"><b>Definition:</b> nvme.h:404</div></div>
<div class="ttc" id="astructOc12IdGroup_html_afd2cafe94a33040426860a895c6d17af"><div class="ttname"><a href="structOc12IdGroup.html#afd2cafe94a33040426860a895c6d17af">Oc12IdGroup::sos</a></div><div class="ttdeci">uint16_t sos</div><div class="ttdef"><b>Definition:</b> oc12.h:135</div></div>
<div class="ttc" id="astructFemuCtrl_html_af13a4a3fc3667cdddbd181c34378b406"><div class="ttname"><a href="structFemuCtrl.html#af13a4a3fc3667cdddbd181c34378b406">FemuCtrl::id_ctrl</a></div><div class="ttdeci">NvmeIdCtrl id_ctrl</div><div class="ttdef"><b>Definition:</b> nvme.h:1271</div></div>
<div class="ttc" id="astructOc12BbtGet_html_a6815a8aa7f39ac3c2a04dac59e4963f9"><div class="ttname"><a href="structOc12BbtGet.html#a6815a8aa7f39ac3c2a04dac59e4963f9">Oc12BbtGet::prp1</a></div><div class="ttdeci">uint64_t prp1</div><div class="ttdef"><b>Definition:</b> oc12.h:44</div></div>
<div class="ttc" id="aoc12_8h_html_ad5747debd7a5038339741a4a5c341411a5f9e854fc81b79c50335c61b5ab33d32"><div class="ttname"><a href="oc12_8h.html#ad5747debd7a5038339741a4a5c341411a5f9e854fc81b79c50335c61b5ab33d32">OC12_ADM_CMD_IDENTITY</a></div><div class="ttdeci">@ OC12_ADM_CMD_IDENTITY</div><div class="ttdef"><b>Definition:</b> oc12.h:7</div></div>
<div class="ttc" id="astructOc12Ctrl_html_a9f385c3ce5b8f38b703b001d66bbc48f"><div class="ttname"><a href="structOc12Ctrl.html#a9f385c3ce5b8f38b703b001d66bbc48f">Oc12Ctrl::strict</a></div><div class="ttdeci">uint8_t strict</div><div class="ttdef"><b>Definition:</b> oc12.h:225</div></div>
<div class="ttc" id="anvme_8h_html_aa099d68673fc69a8ebeeffc9b00a06d1"><div class="ttname"><a href="nvme_8h.html#aa099d68673fc69a8ebeeffc9b00a06d1">FEMU_MAX_NUM_CHIPS</a></div><div class="ttdeci">#define FEMU_MAX_NUM_CHIPS</div><div class="ttdef"><b>Definition:</b> nvme.h:1145</div></div>
<div class="ttc" id="astructOc12Bbt_html_a5f4ffc91bc8fd86cb5ce97115c430fa7"><div class="ttname"><a href="structOc12Bbt.html#a5f4ffc91bc8fd86cb5ce97115c430fa7">Oc12Bbt::verid</a></div><div class="ttdeci">uint16_t verid</div><div class="ttdef"><b>Definition:</b> oc12.h:163</div></div>
<div class="ttc" id="astructOc12AddrF_html_a2e4f8916fc739ff8d205e6bcdeaf9a48"><div class="ttname"><a href="structOc12AddrF.html#a2e4f8916fc739ff8d205e6bcdeaf9a48">Oc12AddrF::sec_mask</a></div><div class="ttdeci">uint64_t sec_mask</div><div class="ttdef"><b>Definition:</b> oc12.h:114</div></div>
<div class="ttc" id="aoc12_8c_html_a0e77c275cce3ddf13e9092d72285d6f5"><div class="ttname"><a href="oc12_8c.html#a0e77c275cce3ddf13e9092d72285d6f5">oc12_init_misc</a></div><div class="ttdeci">static int oc12_init_misc(FemuCtrl *n)</div><div class="ttdef"><b>Definition:</b> oc12.c:836</div></div>
<div class="ttc" id="aoc12_8c_html_aa22cd7b8b8e5064da4267752f5f47016"><div class="ttname"><a href="oc12_8c.html#aa22cd7b8b8e5064da4267752f5f47016">oc12_init_meta</a></div><div class="ttdeci">static int oc12_init_meta(Oc12Ctrl *ln)</div><div class="ttdef"><b>Definition:</b> oc12.c:775</div></div>
<div class="ttc" id="astructOc12GetL2PTbl_html_a0778e8198dabca70c15f47bc5616082b"><div class="ttname"><a href="structOc12GetL2PTbl.html#a0778e8198dabca70c15f47bc5616082b">Oc12GetL2PTbl::prp2</a></div><div class="ttdeci">uint64_t prp2</div><div class="ttdef"><b>Definition:</b> oc12.h:32</div></div>
<div class="ttc" id="aoc12_8h_html_a1b0c7bd4d79798ef4e0ce23894c9aeb2"><div class="ttname"><a href="oc12_8h.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a></div><div class="ttdeci">uint32_t state</div><div class="ttdef"><b>Definition:</b> oc12.h:2</div></div>
<div class="ttc" id="aoc12_8c_html_ad73121a1527886888f077d49b5e599cd"><div class="ttname"><a href="oc12_8c.html#ad73121a1527886888f077d49b5e599cd">oc12_read_oob_meta</a></div><div class="ttdeci">static int oc12_read_oob_meta(Oc12Ctrl *ln, uint64_t ppa, void *meta)</div><div class="ttdef"><b>Definition:</b> oc12.c:84</div></div>
<div class="ttc" id="anvme_8h_html_a47af6344ba88ebc43f7a48a8845b57de"><div class="ttname"><a href="nvme_8h.html#a47af6344ba88ebc43f7a48a8845b57de">NVME_ID_NS_LBAF_DS</a></div><div class="ttdeci">#define NVME_ID_NS_LBAF_DS(ns, lba_index)</div><div class="ttdef"><b>Definition:</b> nvme.h:30</div></div>
<div class="ttc" id="astructOc12BbtSet_html_a31425c5146736dfb7d4da2adee768805"><div class="ttname"><a href="structOc12BbtSet.html#a31425c5146736dfb7d4da2adee768805">Oc12BbtSet::value</a></div><div class="ttdeci">uint8_t value</div><div class="ttdef"><b>Definition:</b> oc12.h:60</div></div>
<div class="ttc" id="aoc12_8c_html_a0caef7cdff7d502bdf678c7e8c57e35e"><div class="ttname"><a href="oc12_8c.html#a0caef7cdff7d502bdf678c7e8c57e35e">oc12_init</a></div><div class="ttdeci">static void oc12_init(FemuCtrl *n, Error **errp)</div><div class="ttdef"><b>Definition:</b> oc12.c:1070</div></div>
<div class="ttc" id="anvme_8h_html_a2259ab6ad32aaf55b340159f4fb043f4a778b8f53d6725ef86c455e2e55d46ce7"><div class="ttname"><a href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a778b8f53d6725ef86c455e2e55d46ce7">NVME_INVALID_OPCODE</a></div><div class="ttdeci">@ NVME_INVALID_OPCODE</div><div class="ttdef"><b>Definition:</b> nvme.h:521</div></div>
<div class="ttc" id="astructOc12RwCmd_html_ab43b0d732b299b53629be5e0120f2930"><div class="ttname"><a href="structOc12RwCmd.html#ab43b0d732b299b53629be5e0120f2930">Oc12RwCmd::nlb</a></div><div class="ttdeci">uint16_t nlb</div><div class="ttdef"><b>Definition:</b> oc12.h:75</div></div>
<div class="ttc" id="astructOc12AddrF_html_af563da7e6555efe854c0f363d3d7f8cd"><div class="ttname"><a href="structOc12AddrF.html#af563da7e6555efe854c0f363d3d7f8cd">Oc12AddrF::pln_offset</a></div><div class="ttdeci">uint8_t pln_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:117</div></div>
<div class="ttc" id="astructNvmeIdNs_html_a4a814e395ae6ea7b3b7c5cba1c22ad85"><div class="ttname"><a href="structNvmeIdNs.html#a4a814e395ae6ea7b3b7c5cba1c22ad85">NvmeIdNs::nsze</a></div><div class="ttdeci">uint64_t nsze</div><div class="ttdef"><b>Definition:</b> nvme.h:858</div></div>
<div class="ttc" id="astructAddrBucket_html"><div class="ttname"><a href="structAddrBucket.html">AddrBucket</a></div><div class="ttdef"><b>Definition:</b> oc12.h:242</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a169a6f5a02954d7021c84743344bdaa0"><div class="ttname"><a href="structOc12IdGroup.html#a169a6f5a02954d7021c84743344bdaa0">Oc12IdGroup::num_lun</a></div><div class="ttdeci">uint8_t num_lun</div><div class="ttdef"><b>Definition:</b> oc12.h:128</div></div>
<div class="ttc" id="aoc12_8c_html_a513d4b55522984724a7586103d0dccde"><div class="ttname"><a href="oc12_8c.html#a513d4b55522984724a7586103d0dccde">oc12_meta_blk_set_erased</a></div><div class="ttdeci">static int oc12_meta_blk_set_erased(NvmeNamespace *ns, Oc12Ctrl *ln, uint64_t *psl, int nr_ppas)</div><div class="ttdef"><b>Definition:</b> oc12.c:113</div></div>
<div class="ttc" id="astructOc12IdCtrl_html"><div class="ttname"><a href="structOc12IdCtrl.html">Oc12IdCtrl</a></div><div class="ttdef"><b>Definition:</b> oc12.h:149</div></div>
<div class="ttc" id="astructOc12AddrF_html_ae039cd10c2f3514fbce779e08d4f2a63"><div class="ttname"><a href="structOc12AddrF.html#ae039cd10c2f3514fbce779e08d4f2a63">Oc12AddrF::blk_mask</a></div><div class="ttdeci">uint64_t blk_mask</div><div class="ttdef"><b>Definition:</b> oc12.h:112</div></div>
<div class="ttc" id="astructNvmeNamespace_html_a95506f6c42f0b9bb0ef45bbc9d6a49be"><div class="ttname"><a href="structNvmeNamespace.html#a95506f6c42f0b9bb0ef45bbc9d6a49be">NvmeNamespace::bbtbl</a></div><div class="ttdeci">Oc12Bbt ** bbtbl</div><div class="ttdef"><b>Definition:</b> nvme.h:1073</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_a6a77c923124143b7015002fd8084cd78"><div class="ttname"><a href="structOc12IdAddrFormat.html#a6a77c923124143b7015002fd8084cd78">Oc12IdAddrFormat::pg_len</a></div><div class="ttdeci">uint8_t pg_len</div><div class="ttdef"><b>Definition:</b> oc12.h:102</div></div>
<div class="ttc" id="astructOc12RwCmd_html"><div class="ttname"><a href="structOc12RwCmd.html">Oc12RwCmd</a></div><div class="ttdef"><b>Definition:</b> oc12.h:65</div></div>
<div class="ttc" id="astructOcCtrlParams_html_a5fa8675fa2741984a2a9c3f735f5087b"><div class="ttname"><a href="structOcCtrlParams.html#a5fa8675fa2741984a2a9c3f735f5087b">OcCtrlParams::secs_per_pg</a></div><div class="ttdeci">uint8_t secs_per_pg</div><div class="ttdef"><b>Definition:</b> nvme.h:1149</div></div>
<div class="ttc" id="astructOc12Params_html_af14b526379f64a2d408b59dbb974fd79"><div class="ttname"><a href="structOc12Params.html#af14b526379f64a2d408b59dbb974fd79">Oc12Params::num_lun</a></div><div class="ttdeci">uint8_t num_lun</div><div class="ttdef"><b>Definition:</b> oc12.h:187</div></div>
<div class="ttc" id="astructOc12RwCmd_html_a24e2d0a72fbd34f3e31c0febf46c114d"><div class="ttname"><a href="structOc12RwCmd.html#a24e2d0a72fbd34f3e31c0febf46c114d">Oc12RwCmd::spba</a></div><div class="ttdeci">uint64_t spba</div><div class="ttdef"><b>Definition:</b> oc12.h:74</div></div>
<div class="ttc" id="anand_8h_html_a277eb77cc9a0d195f464a357430de968"><div class="ttname"><a href="nand_8h.html#a277eb77cc9a0d195f464a357430de968">PPA_PG</a></div><div class="ttdeci">#define PPA_PG(ln, ppa)</div><div class="ttdef"><b>Definition:</b> nand.h:117</div></div>
<div class="ttc" id="atiming_8c_html_aa8618254a23869568da186caca33e37b"><div class="ttname"><a href="timing_8c.html#aa8618254a23869568da186caca33e37b">set_latency</a></div><div class="ttdeci">void set_latency(FemuCtrl *n)</div><div class="ttdef"><b>Definition:</b> timing.c:3</div></div>
<div class="ttc" id="astructOcCtrlParams_html_afc98d43543e8564628abe9e7e2c6ef1e"><div class="ttname"><a href="structOcCtrlParams.html#afc98d43543e8564628abe9e7e2c6ef1e">OcCtrlParams::sec_size</a></div><div class="ttdeci">uint16_t sec_size</div><div class="ttdef"><b>Definition:</b> nvme.h:1148</div></div>
<div class="ttc" id="aoc12_8c_html_aaf02ace1750d8b7b40286e2c3fe33a23"><div class="ttname"><a href="oc12_8c.html#aaf02ace1750d8b7b40286e2c3fe33a23">oc12_advance_status</a></div><div class="ttdeci">static int oc12_advance_status(FemuCtrl *n, NvmeNamespace *ns, NvmeCmd *cmd, NvmeRequest *req)</div><div class="ttdef"><b>Definition:</b> oc12.c:345</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a3eb0edbddade2269ac3e9acd04fa2147"><div class="ttname"><a href="structOc12IdGroup.html#a3eb0edbddade2269ac3e9acd04fa2147">Oc12IdGroup::mpos</a></div><div class="ttdeci">uint32_t mpos</div><div class="ttdef"><b>Definition:</b> oc12.h:143</div></div>
<div class="ttc" id="aoc12_8c_html_a22cb229f7099e5695f0525b8b74ffa37"><div class="ttname"><a href="oc12_8c.html#a22cb229f7099e5695f0525b8b74ffa37">oc12_init_id_ctrl</a></div><div class="ttdeci">static void oc12_init_id_ctrl(Oc12Ctrl *ln)</div><div class="ttdef"><b>Definition:</b> oc12.c:750</div></div>
<div class="ttc" id="astructOc12IdGroup_html"><div class="ttname"><a href="structOc12IdGroup.html">Oc12IdGroup</a></div><div class="ttdef"><b>Definition:</b> oc12.h:123</div></div>
<div class="ttc" id="astructNvmeCmd_html_a2751bc2a772082d3af81124a1d120a0c"><div class="ttname"><a href="structNvmeCmd.html#a2751bc2a772082d3af81124a1d120a0c">NvmeCmd::opcode</a></div><div class="ttdeci">uint16_t opcode</div><div class="ttdef"><b>Definition:</b> nvme.h:291</div></div>
<div class="ttc" id="aoc12_8c_html_a8c8f07c03f101ab31074a64d1d430615"><div class="ttname"><a href="oc12_8c.html#a8c8f07c03f101ab31074a64d1d430615">oc12_meta_index</a></div><div class="ttdeci">static void * oc12_meta_index(Oc12Ctrl *ln, void *meta, uint32_t index)</div><div class="ttdef"><b>Definition:</b> oc12.c:238</div></div>
<div class="ttc" id="astructOc12IdCtrl_html_a4618892d39eb4490a15bf687b8be47e7"><div class="ttname"><a href="structOc12IdCtrl.html#a4618892d39eb4490a15bf687b8be47e7">Oc12IdCtrl::cgrps</a></div><div class="ttdeci">uint8_t cgrps</div><div class="ttdef"><b>Definition:</b> oc12.h:152</div></div>
<div class="ttc" id="astructOc12RwCmd_html_a2332402af048a5dd39fd8d96c75c93a3"><div class="ttname"><a href="structOc12RwCmd.html#a2332402af048a5dd39fd8d96c75c93a3">Oc12RwCmd::metadata</a></div><div class="ttdeci">uint64_t metadata</div><div class="ttdef"><b>Definition:</b> oc12.h:71</div></div>
<div class="ttc" id="astructOc12Ctrl_html_affd7e8afd4f05d2492e1f51717334630"><div class="ttname"><a href="structOc12Ctrl.html#affd7e8afd4f05d2492e1f51717334630">Oc12Ctrl::params</a></div><div class="ttdeci">Oc12Params params</div><div class="ttdef"><b>Definition:</b> oc12.h:217</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_acedafdfd6c6fec774bfed650d32bfbb5"><div class="ttname"><a href="structOc12IdAddrFormat.html#acedafdfd6c6fec774bfed650d32bfbb5">Oc12IdAddrFormat::ch_offset</a></div><div class="ttdeci">uint8_t ch_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:93</div></div>
<div class="ttc" id="aoc12_8c_html_aee96b1d201c8c59efdcf0ca09c94ae69"><div class="ttname"><a href="oc12_8c.html#aee96b1d201c8c59efdcf0ca09c94ae69">oc12_tbl_size</a></div><div class="ttdeci">static uint32_t oc12_tbl_size(NvmeNamespace *ns)</div><div class="ttdef"><b>Definition:</b> oc12.c:571</div></div>
<div class="ttc" id="astructOc12Params_html_a35c0b8bb1fc2cfa8d12a7495f5967b7c"><div class="ttname"><a href="structOc12Params.html#a35c0b8bb1fc2cfa8d12a7495f5967b7c">Oc12Params::sec_per_blk</a></div><div class="ttdeci">uint32_t sec_per_blk</div><div class="ttdef"><b>Definition:</b> oc12.h:191</div></div>
<div class="ttc" id="adma_8c_html_aff05c76845a6cc08d0131d2761153493"><div class="ttname"><a href="dma_8c.html#aff05c76845a6cc08d0131d2761153493">nvme_map_prp</a></div><div class="ttdeci">uint16_t nvme_map_prp(QEMUSGList *qsg, QEMUIOVector *iov, uint64_t prp1, uint64_t prp2, uint32_t len, FemuCtrl *n)</div><div class="ttdef"><b>Definition:</b> dma.c:23</div></div>
<div class="ttc" id="astructOc12Bbt_html_a35bb52c3ac4df4df161005835386c0f8"><div class="ttname"><a href="structOc12Bbt.html#a35bb52c3ac4df4df161005835386c0f8">Oc12Bbt::tblks</a></div><div class="ttdeci">uint32_t tblks</div><div class="ttdef"><b>Definition:</b> oc12.h:166</div></div>
<div class="ttc" id="aoc12_8c_html_a9a3ff44ce36ff8f6abba64c35bc5dc79"><div class="ttname"><a href="oc12_8c.html#a9a3ff44ce36ff8f6abba64c35bc5dc79">oc12_write_oob_meta</a></div><div class="ttdeci">static int oc12_write_oob_meta(Oc12Ctrl *ln, uint64_t ppa, void *meta)</div><div class="ttdef"><b>Definition:</b> oc12.c:71</div></div>
<div class="ttc" id="aoc12_8c_html_a42a412e9ba005df6611a73cfbb61ed85"><div class="ttname"><a href="oc12_8c.html#a42a412e9ba005df6611a73cfbb61ed85">oc12_release_locks</a></div><div class="ttdeci">static void oc12_release_locks(FemuCtrl *n)</div><div class="ttdef"><b>Definition:</b> oc12.c:821</div></div>
<div class="ttc" id="aoc12_8h_html_a191ef70a32f90a74e95fe996c572216eac21b2b4101dd7304f1ba640de6ead028"><div class="ttname"><a href="oc12_8h.html#a191ef70a32f90a74e95fe996c572216eac21b2b4101dd7304f1ba640de6ead028">Oc12PMODE_QUAD</a></div><div class="ttdeci">@ Oc12PMODE_QUAD</div><div class="ttdoc">Quad-plane (NVM_IO_QUAD_ACCESS)</div><div class="ttdef"><b>Definition:</b> oc12.h:208</div></div>
<div class="ttc" id="aoc12_8c_html_ad73b76922bf7b9ecd50de33ff112412a"><div class="ttname"><a href="oc12_8c.html#ad73b76922bf7b9ecd50de33ff112412a">oc12_read_ppa_list</a></div><div class="ttdeci">static void oc12_read_ppa_list(FemuCtrl *n, Oc12RwCmd *cmd, uint64_t *ppa_list)</div><div class="ttdef"><b>Definition:</b> oc12.c:291</div></div>
<div class="ttc" id="astructOc12IdCtrl_html_ac86b18f30c76fbe9a79c043a9fe34601"><div class="ttname"><a href="structOc12IdCtrl.html#ac86b18f30c76fbe9a79c043a9fe34601">Oc12IdCtrl::dom</a></div><div class="ttdeci">uint32_t dom</div><div class="ttdef"><b>Definition:</b> oc12.h:155</div></div>
<div class="ttc" id="astructOc12GetL2PTbl_html_a8bdab00db0890306bf991124b890290e"><div class="ttname"><a href="structOc12GetL2PTbl.html#a8bdab00db0890306bf991124b890290e">Oc12GetL2PTbl::slba</a></div><div class="ttdeci">uint64_t slba</div><div class="ttdef"><b>Definition:</b> oc12.h:33</div></div>
<div class="ttc" id="astructOc12GetL2PTbl_html"><div class="ttname"><a href="structOc12GetL2PTbl.html">Oc12GetL2PTbl</a></div><div class="ttdef"><b>Definition:</b> oc12.h:25</div></div>
<div class="ttc" id="aoc12_8c_html_a08d50fc7f025a0a40c4a68a76fd5a088"><div class="ttname"><a href="oc12_8c.html#a08d50fc7f025a0a40c4a68a76fd5a088">oc12_init_more</a></div><div class="ttdeci">static int oc12_init_more(FemuCtrl *n)</div><div class="ttdef"><b>Definition:</b> oc12.c:882</div></div>
<div class="ttc" id="aoc12_8c_html_a36ce2e77da3b587fd610f820a2613ca1"><div class="ttname"><a href="oc12_8c.html#a36ce2e77da3b587fd610f820a2613ca1">oc12_tbl_initialize</a></div><div class="ttdeci">static void oc12_tbl_initialize(NvmeNamespace *ns)</div><div class="ttdef"><b>Definition:</b> oc12.c:16</div></div>
<div class="ttc" id="astructOc12GetL2PTbl_html_a45e8a56cc4704da9bb9f677afa9debc4"><div class="ttname"><a href="structOc12GetL2PTbl.html#a45e8a56cc4704da9bb9f677afa9debc4">Oc12GetL2PTbl::nsid</a></div><div class="ttdeci">uint32_t nsid</div><div class="ttdef"><b>Definition:</b> oc12.h:29</div></div>
<div class="ttc" id="astructOc12IdGroup_html_a7909a44a554f357cca989384aaf2495a"><div class="ttname"><a href="structOc12IdGroup.html#a7909a44a554f357cca989384aaf2495a">Oc12IdGroup::num_pg</a></div><div class="ttdeci">uint16_t num_pg</div><div class="ttdef"><b>Definition:</b> oc12.h:132</div></div>
<div class="ttc" id="astructNvmeIdNs_html_ac2061ba91f1d2bf0282bfe22221f65a2"><div class="ttname"><a href="structNvmeIdNs.html#ac2061ba91f1d2bf0282bfe22221f65a2">NvmeIdNs::flbas</a></div><div class="ttdeci">uint8_t flbas</div><div class="ttdef"><b>Definition:</b> nvme.h:863</div></div>
<div class="ttc" id="astructOc12Bbt_html_a1e7e14a98fb0cc8e5ecb13b1ec6cac08"><div class="ttname"><a href="structOc12Bbt.html#a1e7e14a98fb0cc8e5ecb13b1ec6cac08">Oc12Bbt::blk</a></div><div class="ttdeci">uint8_t blk[0]</div><div class="ttdef"><b>Definition:</b> oc12.h:172</div></div>
<div class="ttc" id="astructAddrBucket_html_a605c129d45ea08a49ad1cb3acea6340f"><div class="ttname"><a href="structAddrBucket.html#a605c129d45ea08a49ad1cb3acea6340f">AddrBucket::pg</a></div><div class="ttdeci">int pg</div><div class="ttdef"><b>Definition:</b> oc12.h:245</div></div>
<div class="ttc" id="astructOcCtrlParams_html_ab3676d0517ea8d1e17392976cb95ea80"><div class="ttname"><a href="structOcCtrlParams.html#ab3676d0517ea8d1e17392976cb95ea80">OcCtrlParams::num_pln</a></div><div class="ttdeci">uint8_t num_pln</div><div class="ttdef"><b>Definition:</b> nvme.h:1154</div></div>
<div class="ttc" id="atiming_8c_html_a1e23cd59a19d5524e59e8a130a0318ca"><div class="ttname"><a href="timing_8c.html#a1e23cd59a19d5524e59e8a130a0318ca">advance_channel_timestamp</a></div><div class="ttdeci">int64_t advance_channel_timestamp(FemuCtrl *n, int ch, uint64_t now, int opcode)</div><div class="ttdef"><b>Definition:</b> timing.c:38</div></div>
<div class="ttc" id="astructNvmeRequest_html_a135bf3cba23f12bad28c20805a8f5d93"><div class="ttname"><a href="structNvmeRequest.html#a135bf3cba23f12bad28c20805a8f5d93">NvmeRequest::expire_time</a></div><div class="ttdeci">int64_t expire_time</div><div class="ttdef"><b>Definition:</b> nvme.h:984</div></div>
<div class="ttc" id="astructOc12IdGroup_html_ab1804f4795520f885926d84dda040ad9"><div class="ttname"><a href="structOc12IdGroup.html#ab1804f4795520f885926d84dda040ad9">Oc12IdGroup::tbem</a></div><div class="ttdeci">uint32_t tbem</div><div class="ttdef"><b>Definition:</b> oc12.h:142</div></div>
<div class="ttc" id="aoc12_8h_html_a62b8a1f2ddfa637c1d6bb86f80ebc9a0a0db13c046f3cdc7a4a59f1f3456c95c6"><div class="ttname"><a href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a0db13c046f3cdc7a4a59f1f3456c95c6">OC12_CMD_WRITE</a></div><div class="ttdeci">@ OC12_CMD_WRITE</div><div class="ttdef"><b>Definition:</b> oc12.h:14</div></div>
<div class="ttc" id="astructOc12GetL2PTbl_html_ad22a0ce2375f771970212ed240433cc3"><div class="ttname"><a href="structOc12GetL2PTbl.html#ad22a0ce2375f771970212ed240433cc3">Oc12GetL2PTbl::nlb</a></div><div class="ttdeci">uint32_t nlb</div><div class="ttdef"><b>Definition:</b> oc12.h:34</div></div>
<div class="ttc" id="astructOc12AddrF_html_a9f4b8857afe5ec3d69c0c88a5cf150a2"><div class="ttname"><a href="structOc12AddrF.html#a9f4b8857afe5ec3d69c0c88a5cf150a2">Oc12AddrF::pg_offset</a></div><div class="ttdeci">uint8_t pg_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:119</div></div>
<div class="ttc" id="aoc12_8c_html_a6edf286a27463261b9a975ee1eeefcc8"><div class="ttname"><a href="oc12_8c.html#a6edf286a27463261b9a975ee1eeefcc8">oc12_get_l2p_tbl</a></div><div class="ttdeci">static uint16_t oc12_get_l2p_tbl(FemuCtrl *n, NvmeCmd *cmd)</div><div class="ttdef"><b>Definition:</b> oc12.c:591</div></div>
<div class="ttc" id="astructOc12BbtSet_html_aec594183763aa14fd735ad04dbe63830"><div class="ttname"><a href="structOc12BbtSet.html#aec594183763aa14fd735ad04dbe63830">Oc12BbtSet::prp2</a></div><div class="ttdeci">uint64_t prp2</div><div class="ttdef"><b>Definition:</b> oc12.h:57</div></div>
<div class="ttc" id="astructFemuCtrl_html_a337abc6776202efbda3ad932da7e020d"><div class="ttname"><a href="structFemuCtrl.html#a337abc6776202efbda3ad932da7e020d">FemuCtrl::chnl_next_avail_time</a></div><div class="ttdeci">volatile int64_t chnl_next_avail_time[FEMU_MAX_NUM_CHNLS]</div><div class="ttdef"><b>Definition:</b> nvme.h:1290</div></div>
<div class="ttc" id="aoc12_8h_html_a627180406cdc1216617f35e42e13b256a728141cb94f3f887265095f22d0cd0b7"><div class="ttname"><a href="oc12_8h.html#a627180406cdc1216617f35e42e13b256a728141cb94f3f887265095f22d0cd0b7">OC12_SEC_ERASED</a></div><div class="ttdeci">@ OC12_SEC_ERASED</div><div class="ttdef"><b>Definition:</b> oc12.h:22</div></div>
<div class="ttc" id="astructOc12Params_html_a6c9f6dc12e991d1bf1846f884ae63c77"><div class="ttname"><a href="structOc12Params.html#a6c9f6dc12e991d1bf1846f884ae63c77">Oc12Params::num_ch</a></div><div class="ttdeci">uint8_t num_ch</div><div class="ttdef"><b>Definition:</b> oc12.h:185</div></div>
<div class="ttc" id="astructFemuCtrl_html_a8bd3f2107e1a59779f7d6a669e29b5af"><div class="ttname"><a href="structFemuCtrl.html#a8bd3f2107e1a59779f7d6a669e29b5af">FemuCtrl::num_namespaces</a></div><div class="ttdeci">uint32_t num_namespaces</div><div class="ttdef"><b>Definition:</b> nvme.h:1218</div></div>
<div class="ttc" id="astructOc12IdGroup_html_aa85ed70c5e53ba20ef52a4cd57a71ce5"><div class="ttname"><a href="structOc12IdGroup.html#aa85ed70c5e53ba20ef52a4cd57a71ce5">Oc12IdGroup::fmtype</a></div><div class="ttdeci">uint8_t fmtype</div><div class="ttdef"><b>Definition:</b> oc12.h:125</div></div>
<div class="ttc" id="astructOc12Params_html_a7a9dd0f60d13cd9027ee190ee1e98ef9"><div class="ttname"><a href="structOc12Params.html#a7a9dd0f60d13cd9027ee190ee1e98ef9">Oc12Params::max_sec_per_rq</a></div><div class="ttdeci">uint8_t max_sec_per_rq</div><div class="ttdef"><b>Definition:</b> oc12.h:181</div></div>
<div class="ttc" id="astructFemuCtrl_html_ab4f555e0b42bfe51c089ab004c88ff48"><div class="ttname"><a href="structFemuCtrl.html#ab4f555e0b42bfe51c089ab004c88ff48">FemuCtrl::mbe</a></div><div class="ttdeci">SsdDramBackend * mbe</div><div class="ttdef"><b>Definition:</b> nvme.h:1308</div></div>
<div class="ttc" id="astructOc12BbtGet_html_a186a1b618ba8bc55d3ebccd43f04bc60"><div class="ttname"><a href="structOc12BbtGet.html#a186a1b618ba8bc55d3ebccd43f04bc60">Oc12BbtGet::spba</a></div><div class="ttdeci">uint64_t spba</div><div class="ttdef"><b>Definition:</b> oc12.h:46</div></div>
<div class="ttc" id="astructOc12Params_html_a25fa157b3a26a5970d5715a9602064b6"><div class="ttname"><a href="structOc12Params.html#a25fa157b3a26a5970d5715a9602064b6">Oc12Params::sos</a></div><div class="ttdeci">uint16_t sos</div><div class="ttdef"><b>Definition:</b> oc12.h:188</div></div>
<div class="ttc" id="astructFemuExtCtrlOps_html_a5a0b55a8db93619bd96e347ed4c7a930"><div class="ttname"><a href="structFemuExtCtrlOps.html#a5a0b55a8db93619bd96e347ed4c7a930">FemuExtCtrlOps::state</a></div><div class="ttdeci">void * state</div><div class="ttdef"><b>Definition:</b> nvme.h:1160</div></div>
<div class="ttc" id="astructppa_html"><div class="ttname"><a href="structppa.html">ppa</a></div><div class="ttdef"><b>Definition:</b> ftl.h:56</div></div>
<div class="ttc" id="aoc12_8c_html_a3bfb4ee5498ee9493ea2965fb44074dc"><div class="ttname"><a href="oc12_8c.html#a3bfb4ee5498ee9493ea2965fb44074dc">qemu_fls</a></div><div class="ttdeci">static int qemu_fls(int i)</div><div class="ttdef"><b>Definition:</b> oc12.c:3</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_a6e9de9b4a4237b3b503a4233b67d254c"><div class="ttname"><a href="structOc12IdAddrFormat.html#a6e9de9b4a4237b3b503a4233b67d254c">Oc12IdAddrFormat::pln_offset</a></div><div class="ttdeci">uint8_t pln_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:97</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_aab081cf0b7c3a3e3e39bb2bb5c8f2dc5"><div class="ttname"><a href="structOc12IdAddrFormat.html#aab081cf0b7c3a3e3e39bb2bb5c8f2dc5">Oc12IdAddrFormat::pg_offset</a></div><div class="ttdeci">uint8_t pg_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:101</div></div>
<div class="ttc" id="astructOc12Ctrl_html_afb36938720a7bbc5e46796beca65ed79"><div class="ttname"><a href="structOc12Ctrl.html#afb36938720a7bbc5e46796beca65ed79">Oc12Ctrl::read_l2p_tbl</a></div><div class="ttdeci">uint8_t read_l2p_tbl</div><div class="ttdef"><b>Definition:</b> oc12.h:220</div></div>
<div class="ttc" id="anvme_8h_html_a01e3a918ff89282c841471f5d797fbf6a13421e16e166f06ef616c86258232336"><div class="ttname"><a href="nvme_8h.html#a01e3a918ff89282c841471f5d797fbf6a13421e16e166f06ef616c86258232336">NVME_CMD_READ</a></div><div class="ttdeci">@ NVME_CMD_READ</div><div class="ttdef"><b>Definition:</b> nvme.h:335</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_a8dd7964ba2028ca75799d5b34414400b"><div class="ttname"><a href="structOc12IdAddrFormat.html#a8dd7964ba2028ca75799d5b34414400b">Oc12IdAddrFormat::ch_len</a></div><div class="ttdeci">uint8_t ch_len</div><div class="ttdef"><b>Definition:</b> oc12.h:94</div></div>
<div class="ttc" id="astructNvmeRequest_html_a35d73ae4b2cd7c17e55d20320ac2b1ea"><div class="ttname"><a href="structNvmeRequest.html#a35d73ae4b2cd7c17e55d20320ac2b1ea">NvmeRequest::slba</a></div><div class="ttdeci">uint64_t slba</div><div class="ttdef"><b>Definition:</b> nvme.h:966</div></div>
<div class="ttc" id="aoc12_8c_html_a9ad0ccde984b0ad5434da3622acc0389"><div class="ttname"><a href="oc12_8c.html#a9ad0ccde984b0ad5434da3622acc0389">oc12_bbt_get</a></div><div class="ttdeci">static uint16_t oc12_bbt_get(FemuCtrl *n, NvmeCmd *cmd)</div><div class="ttdef"><b>Definition:</b> oc12.c:621</div></div>
<div class="ttc" id="astructOc12BbtSet_html_a09a420ca0359bea94fa880b9e6dfe577"><div class="ttname"><a href="structOc12BbtSet.html#a09a420ca0359bea94fa880b9e6dfe577">Oc12BbtSet::spba</a></div><div class="ttdeci">uint64_t spba</div><div class="ttdef"><b>Definition:</b> oc12.h:58</div></div>
<div class="ttc" id="astructOc12Params_html_a18ad0f64dda473a2e3dfe44563b8f20b"><div class="ttname"><a href="structOc12Params.html#a18ad0f64dda473a2e3dfe44563b8f20b">Oc12Params::blk_units</a></div><div class="ttdeci">uint32_t blk_units</div><div class="ttdef"><b>Definition:</b> oc12.h:199</div></div>
<div class="ttc" id="astructNvmeIdentity_html_af864ba765f00bea6fb319733be440384"><div class="ttname"><a href="structNvmeIdentity.html#af864ba765f00bea6fb319733be440384">NvmeIdentity::prp2</a></div><div class="ttdeci">uint64_t prp2</div><div class="ttdef"><b>Definition:</b> nvme.h:407</div></div>
<div class="ttc" id="anvme_8h_html_aa10d8964216c470eeb0846d68305dc86"><div class="ttname"><a href="nvme_8h.html#aa10d8964216c470eeb0846d68305dc86">NVME_CAP_SET_OC</a></div><div class="ttdeci">#define NVME_CAP_SET_OC(cap, val)</div><div class="ttdef"><b>Definition:</b> nvme.h:111</div></div>
<div class="ttc" id="anvme_8h_html_a2259ab6ad32aaf55b340159f4fb043f4a4c080463e158441c5b7b4000da2ed3e4"><div class="ttname"><a href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a4c080463e158441c5b7b4000da2ed3e4">NVME_INVALID_NSID</a></div><div class="ttdeci">@ NVME_INVALID_NSID</div><div class="ttdef"><b>Definition:</b> nvme.h:531</div></div>
<div class="ttc" id="aoc12_8h_html_a627180406cdc1216617f35e42e13b256af74448337374176cd70950690b2a1ead"><div class="ttname"><a href="oc12_8h.html#a627180406cdc1216617f35e42e13b256af74448337374176cd70950690b2a1ead">OC12_SEC_WRITTEN</a></div><div class="ttdeci">@ OC12_SEC_WRITTEN</div><div class="ttdef"><b>Definition:</b> oc12.h:21</div></div>
<div class="ttc" id="astructFemuCtrl_html_a98ca6ff3bc65ccc7f98a589e018b7d71"><div class="ttname"><a href="structFemuCtrl.html#a98ca6ff3bc65ccc7f98a589e018b7d71">FemuCtrl::namespaces</a></div><div class="ttdeci">NvmeNamespace * namespaces</div><div class="ttdef"><b>Definition:</b> nvme.h:1265</div></div>
<div class="ttc" id="astructOc12Params_html"><div class="ttname"><a href="structOc12Params.html">Oc12Params</a></div><div class="ttdef"><b>Definition:</b> oc12.h:176</div></div>
<div class="ttc" id="aoc12_8c_html_a3c41a58559ee2c92463ac4f25dab0a08"><div class="ttname"><a href="oc12_8c.html#a3c41a58559ee2c92463ac4f25dab0a08">oc12_io_cmd</a></div><div class="ttdeci">static uint16_t oc12_io_cmd(FemuCtrl *n, NvmeNamespace *ns, NvmeCmd *cmd, NvmeRequest *req)</div><div class="ttdef"><b>Definition:</b> oc12.c:1043</div></div>
<div class="ttc" id="astructOc12BbtSet_html_adcd963607738b6b16dcc474a9ea6ba77"><div class="ttname"><a href="structOc12BbtSet.html#adcd963607738b6b16dcc474a9ea6ba77">Oc12BbtSet::nlb</a></div><div class="ttdeci">uint16_t nlb</div><div class="ttdef"><b>Definition:</b> oc12.h:59</div></div>
<div class="ttc" id="astructOc12IdCtrl_html_add69cfd7b5a15e11c89be87f2d71644c"><div class="ttname"><a href="structOc12IdCtrl.html#add69cfd7b5a15e11c89be87f2d71644c">Oc12IdCtrl::cap</a></div><div class="ttdeci">uint32_t cap</div><div class="ttdef"><b>Definition:</b> oc12.h:154</div></div>
<div class="ttc" id="astructOc12Ctrl_html_ad73b7957a8be1fb41bff6175916f73df"><div class="ttname"><a href="structOc12Ctrl.html#ad73b7957a8be1fb41bff6175916f73df">Oc12Ctrl::meta_buf</a></div><div class="ttdeci">uint8_t * meta_buf</div><div class="ttdef"><b>Definition:</b> oc12.h:226</div></div>
<div class="ttc" id="aoc12_8c_html_aab1abde67fc0b44326b1772846549abf"><div class="ttname"><a href="oc12_8c.html#aab1abde67fc0b44326b1772846549abf">oc12_erase_async</a></div><div class="ttdeci">static uint16_t oc12_erase_async(FemuCtrl *n, NvmeNamespace *ns, NvmeCmd *cmd, NvmeRequest *req)</div><div class="ttdef"><b>Definition:</b> oc12.c:733</div></div>
<div class="ttc" id="aoc12_8h_html_a191ef70a32f90a74e95fe996c572216ea0ab7f30a89bd03f2cb81e3214e610db9"><div class="ttname"><a href="oc12_8h.html#a191ef70a32f90a74e95fe996c572216ea0ab7f30a89bd03f2cb81e3214e610db9">Oc12PMODE_SNGL</a></div><div class="ttdeci">@ Oc12PMODE_SNGL</div><div class="ttdoc">Single-plane</div><div class="ttdef"><b>Definition:</b> oc12.h:206</div></div>
<div class="ttc" id="astructFemuCtrl_html_ab1733fec286bf747df6e0e65c8f10e50"><div class="ttname"><a href="structFemuCtrl.html#ab1733fec286bf747df6e0e65c8f10e50">FemuCtrl::oc_params</a></div><div class="ttdeci">OcCtrlParams oc_params</div><div class="ttdef"><b>Definition:</b> nvme.h:1285</div></div>
<div class="ttc" id="astructNvmeNamespace_html_ad0b627e5006c33450b452a995b5c4704"><div class="ttname"><a href="structNvmeNamespace.html#ad0b627e5006c33450b452a995b5c4704">NvmeNamespace::ns_blks</a></div><div class="ttdeci">uint64_t ns_blks</div><div class="ttdef"><b>Definition:</b> nvme.h:1067</div></div>
<div class="ttc" id="astructOc12AddrF_html_ade7c31f1d074dbbecce98d67d1219ec4"><div class="ttname"><a href="structOc12AddrF.html#ade7c31f1d074dbbecce98d67d1219ec4">Oc12AddrF::ch_mask</a></div><div class="ttdeci">uint64_t ch_mask</div><div class="ttdef"><b>Definition:</b> oc12.h:109</div></div>
<div class="ttc" id="astructFemuCtrl_html_a6d0418e38e888b2b8980a34198bfd463"><div class="ttname"><a href="structFemuCtrl.html#a6d0418e38e888b2b8980a34198bfd463">FemuCtrl::page_size</a></div><div class="ttdeci">uint16_t page_size</div><div class="ttdef"><b>Definition:</b> nvme.h:1210</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_a29706826c796b39de0fc7d49568c6feb"><div class="ttname"><a href="structOc12IdAddrFormat.html#a29706826c796b39de0fc7d49568c6feb">Oc12IdAddrFormat::sect_offset</a></div><div class="ttdeci">uint8_t sect_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:103</div></div>
<div class="ttc" id="astructOc12AddrF_html_ad274fcae4d9fa630a186d4640d1fdd4b"><div class="ttname"><a href="structOc12AddrF.html#ad274fcae4d9fa630a186d4640d1fdd4b">Oc12AddrF::sec_offset</a></div><div class="ttdeci">uint8_t sec_offset</div><div class="ttdef"><b>Definition:</b> oc12.h:120</div></div>
<div class="ttc" id="anvme_8h_html_a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c"><div class="ttname"><a href="nvme_8h.html#a2259ab6ad32aaf55b340159f4fb043f4a8b85ba3cbcb57ab6be06fdced051d11c">NVME_INVALID_FIELD</a></div><div class="ttdeci">@ NVME_INVALID_FIELD</div><div class="ttdef"><b>Definition:</b> nvme.h:522</div></div>
<div class="ttc" id="anvme_8h_html_ad687b13a8721e862fd66459c865669e6"><div class="ttname"><a href="nvme_8h.html#ad687b13a8721e862fd66459c865669e6">FEMU_MAX_NUM_CHNLS</a></div><div class="ttdeci">#define FEMU_MAX_NUM_CHNLS</div><div class="ttdef"><b>Definition:</b> nvme.h:1144</div></div>
<div class="ttc" id="aoc12_8c_html_ae5be918e6cb93b49cf43fcc2c6a36d94"><div class="ttname"><a href="oc12_8c.html#ae5be918e6cb93b49cf43fcc2c6a36d94">oc12_meta_state_get</a></div><div class="ttdeci">static int oc12_meta_state_get(Oc12Ctrl *ln, uint64_t ppa, uint32_t *state)</div><div class="ttdef"><b>Definition:</b> oc12.c:96</div></div>
<div class="ttc" id="anvme_8h_html_a91333268a64e669e088f20aaf0bfd9b7"><div class="ttname"><a href="nvme_8h.html#a91333268a64e669e088f20aaf0bfd9b7">NVME_ID_NS_FLBAS_INDEX</a></div><div class="ttdeci">#define NVME_ID_NS_FLBAS_INDEX(flbas)</div><div class="ttdef"><b>Definition:</b> nvme.h:914</div></div>
<div class="ttc" id="astructOc12IdAddrFormat_html_abeba883866c7686c68c4c4fa17875c09"><div class="ttname"><a href="structOc12IdAddrFormat.html#abeba883866c7686c68c4c4fa17875c09">Oc12IdAddrFormat::pln_len</a></div><div class="ttdeci">uint8_t pln_len</div><div class="ttdef"><b>Definition:</b> oc12.h:98</div></div>
<div class="ttc" id="aoc12_8h_html_a62b8a1f2ddfa637c1d6bb86f80ebc9a0a520122b673211f2705a64edebc5f4d61"><div class="ttname"><a href="oc12_8h.html#a62b8a1f2ddfa637c1d6bb86f80ebc9a0a520122b673211f2705a64edebc5f4d61">OC12_CMD_ERASE</a></div><div class="ttdeci">@ OC12_CMD_ERASE</div><div class="ttdef"><b>Definition:</b> oc12.h:16</div></div>
<div class="ttc" id="anand_8h_html_adfbaba29b1f26d638ba0358de7aec107"><div class="ttname"><a href="nand_8h.html#adfbaba29b1f26d638ba0358de7aec107">PPA_CH</a></div><div class="ttdeci">#define PPA_CH(ln, ppa)</div><div class="ttdef"><b>Definition:</b> nand.h:113</div></div>
<div class="ttc" id="anvme_8h_html_a50171c329ed9567d9e35cd7bade09800"><div class="ttname"><a href="nvme_8h.html#a50171c329ed9567d9e35cd7bade09800">femu_err</a></div><div class="ttdeci">#define femu_err(fmt,...)</div><div class="ttdef"><b>Definition:</b> nvme.h:1489</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_ad892e836c73e5208e2498cac9e78f70.html">ocssd</a></li><li class="navelem"><a class="el" href="oc12_8c.html">oc12.c</a></li>
    <li class="footer">制作者
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
